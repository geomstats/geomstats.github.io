<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spider &mdash; Geomstats latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
    <link rel="canonical" href="geomstats.github.io/notebooks/17_foundation_stratified_spaces.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Geomstats
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../first-steps.html">First steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Code Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsod.html">Google Season of Docs: Project Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="00_foundations__introduction_to_geomstats.html">What is the motivation for analyzing data on manifolds?</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_foundations__introduction_to_geomstats.html#What-will-you-learn-in-these-tutorials?">What will you learn in these tutorials?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html#2.-What-is-a-Manifold?">2. What is a Manifold?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html#3.-Why-do-we-care-about-manifolds?">3. Why do we care about manifolds?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html#4.-What-does-the-Manifold-class-do?">4. What does the <code class="docutils literal notranslate"><span class="pre">Manifold</span></code> class do?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html#5.-How-is-the-Manifold-class-structured?">5. How is the <code class="docutils literal notranslate"><span class="pre">Manifold</span></code> class structured?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_foundations__manifolds.html#Conclusion">Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_practical_methods__data_on_manifolds.html">Tutorial: Data on Manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_practical_methods__from_vector_spaces_to_manifolds.html">Tutorial: From vector spaces to manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_practical_methods__simple_machine_learning_on_tangent_spaces.html">Tutorial: Learning on Tangent Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_practical_methods__riemannian_frechet_mean_and_tangent_pca.html">Tutorial: Fréchet Mean and Tangent PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_practical_methods__riemannian_kmeans.html">Tutorial: K-Means clustering on a Riemannian Manifold</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_practical_methods__information_geometry.html">Tutorial: Information geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_practical_methods__implement_your_own_riemannian_geometry.html">Tutorial: Implement your own Riemannian Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_practical_methods__shape_analysis.html">Tutorial: Shape analysis of curves with the Square Root Velocity metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html">Shape Analysis of Cancer Cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#1.-Introduction-and-Motivation">1. Introduction and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#2.-Dataset-Description">2. Dataset Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#3.-Preprocessing">3. Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#4-Data-Analysis">4 Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#Analyze-Distances-to-the-&quot;Global&quot;-Mean-Shape">Analyze Distances to the “Global” Mean Shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#Changing-the-Metric-on-the-Space-of-Cell-Shapes">Changing the Metric on the Space of Cell Shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#Hypothesis-Testing-on-Equality-of-Means">Hypothesis Testing on Equality of Means</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#Visualization-of-the-Mean-of-each-Treatment">Visualization of the Mean of each Treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html#Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape">Distance of the Cell Shapes to their Own Mean Shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html">Tutorial: Hand gesture classification with EMG data using Riemannian metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_real_world_applications__graph_embedding_and_clustering_in_hyperbolic_space.html">Tutorial: Hyperbolic Embedding of Graphs and Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_real_world_applications__hand_poses_analysis_in_kendall_shape_space.html">Tutorial: Classifying hands poses with Kendall shape spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_real_world_applications__optic_nerve_heads_analysis_in_kendall_shape_space.html">Tutorial: Computing with shapes of landmarks in Kendall shape spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html">Tutorial : Computing with triangular shapes in Kendall framework</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Geomstats</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Spider</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/17_foundation_stratified_spaces.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/notebooks/17_foundation_stratified_spaces.ipynb">notebooks/17_foundation_stratified_spaces.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=notebooks/17_foundation_stratified_spaces.ipynb"><img alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>
  </p>
</div><p><span class="math notranslate nohighlight">\(\textbf{Lead Author: Anna Calissano}\)</span></p>
<p>Dear lerner, the aim of the current notebook is to introduce stratified spaces and its implementation within geomstats.</p>
<div class="section" id="Spider">
<h1>Spider<a class="headerlink" href="#Spider" title="Permalink to this headline"></a></h1>
<p>The <span class="math notranslate nohighlight">\(k\)</span>-Spider consists of <span class="math notranslate nohighlight">\(k\)</span> copies of the positive real line <span class="math notranslate nohighlight">\(\mathbb{R}_{\geq 0}\)</span> glued together at the origin. Within geomstats, we defined the following: 1. Spider Point: a point object defining the ray and the value 2. Spider: the space defined by the number of rays 3. Spider Geometry: by chosing a metric on the rays, we can define a metric on the whole space</p>
<p><img alt="96689d55872345029caacf8d7d43e588" class="no-scaled-link" src="../_images/tripod.png" style="width: 200px;" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>

<span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2020</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">geomstats.geometry.stratified.spider</span> <span class="kn">import</span> <span class="n">Spider</span><span class="p">,</span> <span class="n">SpiderPoint</span><span class="p">,</span> <span class="n">SpiderMetric</span>
<span class="kn">from</span> <span class="nn">geomstats.geometry.euclidean</span> <span class="kn">import</span> <span class="n">EuclideanMetric</span>
</pre></div>
</div>
</div>
<p>We can define a spider with <span class="math notranslate nohighlight">\(k=3\)</span> rays (strata) and sample two points from it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span><span class="o">=</span> <span class="n">Spider</span><span class="p">(</span><span class="n">n_rays</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">n_rays</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_points</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">random_point</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sp_points</span>
<br/></pre></div>
</div>
</div>
<p>The points are represented into the SpiderPoint format, where the first input is the stratum and the second input is the value along the stratum.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stratum</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stratum_coord</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Given a metric <span class="math notranslate nohighlight">\(d_{rays}\)</span> on the strata (the rays), we can extend it to the whole space by</p>
<div class="math notranslate nohighlight">
\[d_{Spider}(s_1,s_2)=d_{rays}(s_1,0) + d_{rays}(0,s_2)\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_metric</span><span class="o">=</span><span class="n">SpiderMetric</span><span class="p">(</span><span class="n">ray_metric</span><span class="o">=</span><span class="n">EuclideanMetric</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">space</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Given two points on the Spider, we can compute the distance between the two points as well as the geodesic between the two.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_metric</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp_points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_geo</span><span class="o">=</span><span class="n">sp_metric</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp_points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp_geo</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">sp_geo</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">sp_geo</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Graph-Space">
<h1>Graph Space<a class="headerlink" href="#Graph-Space" title="Permalink to this headline"></a></h1>
<p>Graph Space is a space defined to describe set of graphs with a finite number of nodes which can be both node labelled or node unlabelled.</p>
<p>Inspired by: A. Calissano, A. Feragen, S. Vantini, Populations of unlabeled networks: Graph space geometry and geodesic principal components, MOX Report (2020)</p>
<p>We consider graphs as triples <span class="math notranslate nohighlight">\(G=(V,E,a)\)</span>, where the node set <span class="math notranslate nohighlight">\(V\)</span> has at most <span class="math notranslate nohighlight">\(n\)</span> elements, and the edge set <span class="math notranslate nohighlight">\(E \subset V^2\)</span> has maximal size <span class="math notranslate nohighlight">\(n^2\)</span>. The nodes and edges are attributed with elements of an attribute space <span class="math notranslate nohighlight">\(A\)</span>, which is considered to be Euclidean, via an attribute map <span class="math notranslate nohighlight">\(a \colon E \rightarrow A\)</span>. Here, the map <span class="math notranslate nohighlight">\(a\)</span> allows us to describe attributes on both edges and nodes, as we use self loop edges (diagonal elements in the graphs
adjacency matrix) to assign attributes to nodes. A graph with scalar attributes is completely specified by a weighted adjacency matrix of dimension <span class="math notranslate nohighlight">\(n\times n\)</span>, residing in a space <span class="math notranslate nohighlight">\(X=\mathbb{R}^{n^2}\)</span> of flattened adjacency matrices. If the attributes are vectors of dimension <span class="math notranslate nohighlight">\(d\)</span>, the graph is represented by a tensor of dimension <span class="math notranslate nohighlight">\(n\times n\times d\)</span>, residing in a space <span class="math notranslate nohighlight">\(X=\mathbb{R}^{n\times n\times d}\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.geometry.stratified.graph_space</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">GraphSpace</span><span class="p">,</span> <span class="n">GraphSpaceMetric</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="section" id="Graph">
<h2>Graph<a class="headerlink" href="#Graph" title="Permalink to this headline"></a></h2>
<p>Consider a graph with <span class="math notranslate nohighlight">\(n=3\)</span> nodes and <span class="math notranslate nohighlight">\(A=\mathbb{R}\)</span> scalar attributes on nodes and edges. The class Graph describe a single graph via its adjecency matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adj</span><span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="n">gr</span><span class="o">=</span><span class="n">Graph</span><span class="p">(</span><span class="n">adj</span><span class="o">=</span><span class="n">adj</span><span class="p">)</span>
<span class="n">gr</span><span class="o">.</span><span class="n">adj</span>
</pre></div>
</div>
</div>
<p>To simplify the visualization and the access to different methods, the Graph object can be turned into a networkx graph.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_nx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_networkx</span><span class="p">()</span>
<span class="n">edges</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">,</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Set-of-Graphs:-GraphSpace">
<h2>Set of Graphs: GraphSpace<a class="headerlink" href="#Set-of-Graphs:-GraphSpace" title="Permalink to this headline"></a></h2>
<p>Graphs can have different numbers of nodes and different node labels or order. We assume the existence across the populations of at most <span class="math notranslate nohighlight">\(n\)</span> distinct nodes and we add fictionally null nodes to smaller networks, so that all graphs can be described by a fixed-size adjacency matrix. Graph Space is initalized by the maximal number of nodes in the set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_s</span> <span class="o">=</span> <span class="n">GraphSpace</span><span class="p">(</span><span class="n">n_nodes</span><span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">g_s</span><span class="o">.</span><span class="n">n_nodes</span>
</pre></div>
</div>
</div>
<p>Within GraphSpace, we can sample points from random adjecency matrices, we can check if the points belongs and we can return a set of adjecency matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_sampled</span><span class="o">=</span><span class="n">g_s</span><span class="o">.</span><span class="n">random_point</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_s</span><span class="o">.</span><span class="n">belongs</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Labelled-or-Unlabelled?">
<h2>Labelled or Unlabelled?<a class="headerlink" href="#Labelled-or-Unlabelled?" title="Permalink to this headline"></a></h2>
<p>Graphs can be considered labelled or unlablled, meaning that the observation in the set can share the same nodes (labelled) or not (unlabelled). We can describe both cases into Graph Space by using a little trick.</p>
<p>To deal with unlabelled nodes, matching two graphs corresponds to finding optimal permutations of their nodes. By allowing node permutation, a concept of equivalence class is introduces (i.e., every network is associated to the set of networks obtained by permuting the original one). In geometrical terms, this can be described as a quotient space obtained by applying a permutation action to the set of adjacency matrix.</p>
<p>In details, the group of node permutations <span class="math notranslate nohighlight">\(T\)</span> can be represented via permutation matrices, acting on <span class="math notranslate nohighlight">\(X\)</span> through matrix multiplication. The binary operation:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}  \cdot \colon T \times X \rightarrow X, (T,x)\mapsto Tx\\thus defines an action of the group :math:`T` on :math:`X`. The obtained quotient space :math:`X/T` is called graph space, and each element of :math:`X/T` is an unlabelled graph :math:`G`, represented as an equivalence class :math:`[x]=Tx` which contains all the flattened adjacency matrices in :math:`X` which can be obtained from :math:`x` by permuting nodes. The map :math:`\pi \colon X \to X/T` given by :math:`\pi(x) = [x]` can be thought of as a projection of the Euclidean total space\end{aligned}\end{align} \]</div>
<p><span class="math notranslate nohighlight">\(X\)</span> onto the graph space <span class="math notranslate nohighlight">\(X/T\)</span>, and the total space <span class="math notranslate nohighlight">\(X\)</span> plays a similar role relative to graph space, as the tangent space does for manifolds, by providing a Euclidean space in which approximate computations can be carried out and projected back onto the space of interest – in our case the graph space <span class="math notranslate nohighlight">\(X/T\)</span>.</p>
<p>To deal with labelled nodes, we restrict the set of permutation matrices to the identity: <span class="math notranslate nohighlight">\(T=\{I\}\)</span></p>
</div>
<div class="section" id="Graph-Space-Metric">
<h2>Graph Space Metric<a class="headerlink" href="#Graph-Space-Metric" title="Permalink to this headline"></a></h2>
<p>To define a metric on graph space, we need to chose a metric on the total space. Any metric <span class="math notranslate nohighlight">\(d_X\)</span> on <span class="math notranslate nohighlight">\(X\)</span> defines a quotient pseudo-metric</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}  d_{X/T}([x_1],[x_2])=\min_{t\in T}d_X(x_1,t^Tx_2t)\\on :math:`X/T`. Since the permutation group :math:`T` is finite, :math:`d_{X/T}` is a metric, and the graph space :math:`X/T` is a geodesic space. In the implementation, we suppose that the default metric in the total space is the Frobenious norm between adjecency matrix.\end{aligned}\end{align} \]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">=</span> <span class="n">GraphSpaceMetric</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="n">g_s</span><span class="p">)</span>
<span class="n">gs_m</span><span class="o">.</span><span class="n">total_space_metric</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Graph-Matching">
<h2>Graph Matching<a class="headerlink" href="#Graph-Matching" title="Permalink to this headline"></a></h2>
<p>The metric on Graph Space relies on the optimization along the quotient fibers. In this context the optimization problem is known as graph matching (or graph alignment) and corresponds in finding a match between the two sents of nodes which minimize the distance between the corresponing adjecnecy matrices. The distance function needs a matcher input, which solve the minimization problem by returning an optimal permutation of the second input graph. Two matchers are called:</p>
<ol class="arabic simple">
<li><p>‘ID’ the identity matching returning the same node order which corresponds to work with labelled graphs;</p></li>
<li><p>‘FAQ’ the Fast Quadratic Assignment Matching implemented in scipy.optimize.quadratic assignment which is the state of the art in the matching literature based on the Frobenious norm.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">graph_a</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph_b</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">matcher</span><span class="o">=</span> <span class="s1">&#39;ID&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">graph_a</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph_b</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">matcher</span><span class="o">=</span> <span class="s1">&#39;FAQ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">matching</span><span class="p">(</span><span class="n">gr_sampled</span><span class="p">,</span> <span class="n">gr_sampled</span><span class="p">,</span> <span class="n">matcher</span><span class="o">=</span><span class="s1">&#39;FAQ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Geomstats, Inc..
      <span class="lastupdated">Last updated on May 20, 2022, 4:11:36 PM.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>