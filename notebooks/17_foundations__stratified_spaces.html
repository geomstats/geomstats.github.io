
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Stratified spaces &#8212; Geomstats latest documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="geomstats.github.io/notebooks/17_foundations__stratified_spaces.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials/index.html" />
    <link rel="prev" title="1. Introduction" href="01_foundations__manifolds.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Geomstats latest documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../explanation/index.html">
  Explanation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing/index.html">
  Contributing Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../roadmap.html">
  Roadmap
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../governance.html">
  Governance
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gsod.html">
  Google Season of Docs
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../hackathons.html">
  Hackathons
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00_foundations__introduction_to_geomstats.html">
   What is the motivation for analyzing data on manifolds?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01_foundations__manifolds.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Stratified spaces
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Spider">
   Spider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Graph-Space">
   Graph Space
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Graph">
     Graph
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Set-of-Graphs:-GraphSpace">
     Set of Graphs: GraphSpace
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Labelled-or-Unlabelled?">
     Labelled or Unlabelled?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Graph-Space-Metric">
     Graph Space Metric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Graph-Matching">
     Graph Matching
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/notebooks/17_foundations__stratified_spaces.ipynb">notebooks/17_foundations__stratified_spaces.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=notebooks/17_foundations__stratified_spaces.ipynb"><img alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>
  </p>
</div><section id="Stratified-spaces">
<h1>Stratified spaces<a class="headerlink" href="#Stratified-spaces" title="Permalink to this heading">#</a></h1>
<p><span class="math notranslate nohighlight">\(\textbf{Lead Author: Anna Calissano}\)</span></p>
<p>Dear lerner, the aim of the current notebook is to introduce stratified spaces and its implementation within geomstats.</p>
<section id="Spider">
<h2>Spider<a class="headerlink" href="#Spider" title="Permalink to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(k\)</span>-Spider consists of <span class="math notranslate nohighlight">\(k\)</span> copies of the positive real line <span class="math notranslate nohighlight">\(\mathbb{R}_{\geq 0}\)</span> glued together at the origin. Within geomstats, we defined the following: 1. Spider Point: a point object defining the ray and the value 2. Spider: the space defined by the number of rays 3. Spider Geometry: by chosing a metric on the rays, we can define a metric on the whole space</p>
<p><img alt="557dccc66021492486c69d89ea6c1e8f" class="no-scaled-link" src="../_images/tripod.png" style="width: 200px;" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>

<span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2020</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">geomstats.geometry.stratified.spider</span> <span class="kn">import</span> <span class="n">Spider</span><span class="p">,</span> <span class="n">SpiderPoint</span><span class="p">,</span> <span class="n">SpiderMetric</span>
<span class="kn">from</span> <span class="nn">geomstats.geometry.euclidean</span> <span class="kn">import</span> <span class="n">EuclideanMetric</span>
</pre></div>
</div>
</div>
<p>We can define a spider with <span class="math notranslate nohighlight">\(k=3\)</span> rays (strata) and sample two points from it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span><span class="o">=</span> <span class="n">Spider</span><span class="p">(</span><span class="n">n_rays</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">n_rays</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_points</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">random_point</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sp_points</span>
<br/></pre></div>
</div>
</div>
<p>The points are represented into the SpiderPoint format, where the first input is the stratum and the second input is the value along the stratum.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stratum</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stratum_coord</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Given a metric <span class="math notranslate nohighlight">\(d_{rays}\)</span> on the strata (the rays), we can extend it to the whole space by</p>
<div class="math notranslate nohighlight">
\[d_{Spider}(s_1,s_2)=d_{rays}(s_1,0) + d_{rays}(0,s_2)\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_metric</span><span class="o">=</span><span class="n">SpiderMetric</span><span class="p">(</span><span class="n">ray_metric</span><span class="o">=</span><span class="n">EuclideanMetric</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">space</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Given two points on the Spider, we can compute the distance between the two points as well as the geodesic between the two.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_metric</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp_points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sp_geo</span><span class="o">=</span><span class="n">sp_metric</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">sp_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp_points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp_geo</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">sp_geo</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">sp_geo</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="Graph-Space">
<h2>Graph Space<a class="headerlink" href="#Graph-Space" title="Permalink to this heading">#</a></h2>
<p>Graph Space is a space defined to describe set of graphs with a finite number of nodes which can be both node labelled or node unlabelled.</p>
<p>Inspired by: A. Calissano, A. Feragen, S. Vantini, Populations of unlabeled networks: Graph space geometry and geodesic principal components, MOX Report (2020)</p>
<p>We consider graphs as triples <span class="math notranslate nohighlight">\(G=(V,E,a)\)</span>, where the node set <span class="math notranslate nohighlight">\(V\)</span> has at most <span class="math notranslate nohighlight">\(n\)</span> elements, and the edge set <span class="math notranslate nohighlight">\(E \subset V^2\)</span> has maximal size <span class="math notranslate nohighlight">\(n^2\)</span>. The nodes and edges are attributed with elements of an attribute space <span class="math notranslate nohighlight">\(A\)</span>, which is considered to be Euclidean, via an attribute map <span class="math notranslate nohighlight">\(a \colon E \rightarrow A\)</span>. Here, the map <span class="math notranslate nohighlight">\(a\)</span> allows us to describe attributes on both edges and nodes, as we use self loop edges (diagonal elements in the graphs
adjacency matrix) to assign attributes to nodes. A graph with scalar attributes is completely specified by a weighted adjacency matrix of dimension <span class="math notranslate nohighlight">\(n\times n\)</span>, residing in a space <span class="math notranslate nohighlight">\(X=\mathbb{R}^{n^2}\)</span> of flattened adjacency matrices. If the attributes are vectors of dimension <span class="math notranslate nohighlight">\(d\)</span>, the graph is represented by a tensor of dimension <span class="math notranslate nohighlight">\(n\times n\times d\)</span>, residing in a space <span class="math notranslate nohighlight">\(X=\mathbb{R}^{n\times n\times d}\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.geometry.stratified.graph_space</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">GraphSpace</span><span class="p">,</span> <span class="n">GraphSpaceMetric</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<section id="Graph">
<h3>Graph<a class="headerlink" href="#Graph" title="Permalink to this heading">#</a></h3>
<p>Consider a graph with <span class="math notranslate nohighlight">\(n=3\)</span> nodes and <span class="math notranslate nohighlight">\(A=\mathbb{R}\)</span> scalar attributes on nodes and edges. The class Graph describe a single graph via its adjecency matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adj</span><span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="n">gr</span><span class="o">=</span><span class="n">Graph</span><span class="p">(</span><span class="n">adj</span><span class="o">=</span><span class="n">adj</span><span class="p">)</span>
<span class="n">gr</span><span class="o">.</span><span class="n">adj</span>
</pre></div>
</div>
</div>
<p>To simplify the visualization and the access to different methods, the Graph object can be turned into a networkx graph.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_nx</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">to_networkx</span><span class="p">()</span>
<span class="n">edges</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">,</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">gr_nx</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Set-of-Graphs:-GraphSpace">
<h3>Set of Graphs: GraphSpace<a class="headerlink" href="#Set-of-Graphs:-GraphSpace" title="Permalink to this heading">#</a></h3>
<p>Graphs can have different numbers of nodes and different node labels or order. We assume the existence across the populations of at most <span class="math notranslate nohighlight">\(n\)</span> distinct nodes and we add fictionally null nodes to smaller networks, so that all graphs can be described by a fixed-size adjacency matrix. Graph Space is initalized by the maximal number of nodes in the set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_s</span> <span class="o">=</span> <span class="n">GraphSpace</span><span class="p">(</span><span class="n">n_nodes</span><span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">g_s</span><span class="o">.</span><span class="n">n_nodes</span>
</pre></div>
</div>
</div>
<p>Within GraphSpace, we can sample points from random adjecency matrices, we can check if the points belongs and we can return a set of adjecency matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gr_sampled</span><span class="o">=</span><span class="n">g_s</span><span class="o">.</span><span class="n">random_point</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_s</span><span class="o">.</span><span class="n">belongs</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Labelled-or-Unlabelled?">
<h3>Labelled or Unlabelled?<a class="headerlink" href="#Labelled-or-Unlabelled?" title="Permalink to this heading">#</a></h3>
<p>Graphs can be considered labelled or unlablled, meaning that the observation in the set can share the same nodes (labelled) or not (unlabelled). We can describe both cases into Graph Space by using a little trick.</p>
<p>To deal with unlabelled nodes, matching two graphs corresponds to finding optimal permutations of their nodes. By allowing node permutation, a concept of equivalence class is introduces (i.e., every network is associated to the set of networks obtained by permuting the original one). In geometrical terms, this can be described as a quotient space obtained by applying a permutation action to the set of adjacency matrix.</p>
<p>In details, the group of node permutations <span class="math notranslate nohighlight">\(T\)</span> can be represented via permutation matrices, acting on <span class="math notranslate nohighlight">\(X\)</span> through matrix multiplication. The binary operation:</p>
<div class="math notranslate nohighlight">
\[\cdot \colon T \times X \rightarrow X, (T,x)\mapsto Tx\]</div>
<p>thus defines an action of the group <span class="math notranslate nohighlight">\(T\)</span> on <span class="math notranslate nohighlight">\(X\)</span>. The obtained quotient space <span class="math notranslate nohighlight">\(X/T\)</span> is called graph space, and each element of <span class="math notranslate nohighlight">\(X/T\)</span> is an unlabelled graph <span class="math notranslate nohighlight">\(G\)</span>, represented as an equivalence class <span class="math notranslate nohighlight">\([x]=Tx\)</span> which contains all the flattened adjacency matrices in <span class="math notranslate nohighlight">\(X\)</span> which can be obtained from <span class="math notranslate nohighlight">\(x\)</span> by permuting nodes. The map <span class="math notranslate nohighlight">\(\pi \colon X \to X/T\)</span> given by <span class="math notranslate nohighlight">\(\pi(x) = [x]\)</span> can be thought of as a projection of the Euclidean total space
<span class="math notranslate nohighlight">\(X\)</span> onto the graph space <span class="math notranslate nohighlight">\(X/T\)</span>, and the total space <span class="math notranslate nohighlight">\(X\)</span> plays a similar role relative to graph space, as the tangent space does for manifolds, by providing a Euclidean space in which approximate computations can be carried out and projected back onto the space of interest – in our case the graph space <span class="math notranslate nohighlight">\(X/T\)</span>.</p>
<p>To deal with labelled nodes, we restrict the set of permutation matrices to the identity: <span class="math notranslate nohighlight">\(T=\{I\}\)</span></p>
</section>
<section id="Graph-Space-Metric">
<h3>Graph Space Metric<a class="headerlink" href="#Graph-Space-Metric" title="Permalink to this heading">#</a></h3>
<p>To define a metric on graph space, we need to chose a metric on the total space. Any metric <span class="math notranslate nohighlight">\(d_X\)</span> on <span class="math notranslate nohighlight">\(X\)</span> defines a quotient pseudo-metric</p>
<div class="math notranslate nohighlight">
\[d_{X/T}([x_1],[x_2])=\min_{t\in T}d_X(x_1,t^Tx_2t)\]</div>
<p>on <span class="math notranslate nohighlight">\(X/T\)</span>. Since the permutation group <span class="math notranslate nohighlight">\(T\)</span> is finite, <span class="math notranslate nohighlight">\(d_{X/T}\)</span> is a metric, and the graph space <span class="math notranslate nohighlight">\(X/T\)</span> is a geodesic space. In the implementation, we suppose that the default metric in the total space is the Frobenious norm between adjecency matrix.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">=</span> <span class="n">GraphSpaceMetric</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="n">g_s</span><span class="p">)</span>
<span class="n">gs_m</span><span class="o">.</span><span class="n">total_space_metric</span>
</pre></div>
</div>
</div>
</section>
<section id="Graph-Matching">
<h3>Graph Matching<a class="headerlink" href="#Graph-Matching" title="Permalink to this heading">#</a></h3>
<p>The metric on Graph Space relies on the optimization along the quotient fibers. In this context the optimization problem is known as graph matching (or graph alignment) and corresponds in finding a match between the two sents of nodes which minimize the distance between the corresponing adjecnecy matrices. The distance function needs a matcher input, which solve the minimization problem by returning an optimal permutation of the second input graph. Two matchers are called:</p>
<ol class="arabic simple">
<li><p>‘ID’ the identity matching returning the same node order which corresponds to work with labelled graphs;</p></li>
<li><p>‘FAQ’ the Fast Quadratic Assignment Matching implemented in scipy.optimize.quadratic assignment which is the state of the art in the matching literature based on the Frobenious norm.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">graph_a</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph_b</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">matcher</span><span class="o">=</span> <span class="s1">&#39;ID&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">graph_a</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">graph_b</span><span class="o">=</span> <span class="n">gr_sampled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">matcher</span><span class="o">=</span> <span class="s1">&#39;FAQ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_m</span><span class="o">.</span><span class="n">matching</span><span class="p">(</span><span class="n">gr_sampled</span><span class="p">,</span> <span class="n">gr_sampled</span><span class="p">,</span> <span class="n">matcher</span><span class="o">=</span><span class="s1">&#39;FAQ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="01_foundations__manifolds.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">1. Introduction</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../tutorials/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Tutorials</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022-2023, Geomstats, Inc..<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>