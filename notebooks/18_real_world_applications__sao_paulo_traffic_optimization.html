
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Optimization of Sao Paulo traffic &#8212; Geomstats latest documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/18_real_world_applications__sao_paulo_traffic_optimization';</script>
    <link rel="canonical" href="geomstats.github.io/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing Guide" href="../contributing/index.html" />
    <link rel="prev" title="Computing with triangular shapes in Kendall framework" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">Geomstats latest documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../explanation/index.html">
                        Explanation
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../tutorials/index.html">
                        Tutorials
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../contributing/index.html">
                        Contributing Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api/index.html">
                        API Reference
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../roadmap.html">
                        Roadmap
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../governance.html">
                        Geomstats governance and decision-making
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../gsod.html">
                        Google Season of Docs: Project Page
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../hackathons.html">
                        Hackathons
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../getting_started/index.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../explanation/index.html">
                        Explanation
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../tutorials/index.html">
                        Tutorials
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../contributing/index.html">
                        Contributing Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api/index.html">
                        API Reference
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../roadmap.html">
                        Roadmap
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../governance.html">
                        Geomstats governance and decision-making
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../gsod.html">
                        Google Season of Docs: Project Page
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../hackathons.html">
                        Hackathons
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="03_practical_methods__data_on_manifolds.html">
   Data on Manifolds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_practical_methods__from_vector_spaces_to_manifolds.html">
   From vector spaces to manifolds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_practical_methods__simple_machine_learning_on_tangent_spaces.html">
   Learning on Tangent Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_practical_methods__riemannian_frechet_mean_and_tangent_pca.html">
   Fréchet Mean and Tangent PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_practical_methods__riemannian_kmeans.html">
   K-Means clustering on a Riemannian Manifold
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_practical_methods__information_geometry.html">
   Information geometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_practical_methods__implement_your_own_riemannian_geometry.html">
   Implement your own Riemannian Geometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_practical_methods__shape_analysis.html">
   Shape analysis of curves with the Square Root Velocity metric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_practical_methods__aac.html">
   Align all and Compute for Graphs
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="11_real_world_applications__cell_shapes_analysis.html">
   Shape Analysis of Cancer Cells
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html">
   Hand gesture classification with EMG data using Riemannian metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_real_world_applications__graph_embedding_and_clustering_in_hyperbolic_space.html">
   Hyperbolic Embedding of Graphs and Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_real_world_applications__hand_poses_analysis_in_kendall_shape_space.html">
   Classifying hands poses with Kendall shape spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_real_world_applications__optic_nerve_heads_analysis_in_kendall_shape_space.html">
   Computing with shapes of landmarks in Kendall shape spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html">
   Computing with triangular shapes in Kendall framework
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Optimization of Sao Paulo traffic
  </a>
 </li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb">notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb"><img alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>
  </p>
</div><section id="Optimization-of-Sao-Paulo-traffic">
<h1>Optimization of Sao Paulo traffic<a class="headerlink" href="#Optimization-of-Sao-Paulo-traffic" title="Permalink to this heading">#</a></h1>
<p>Lead author: Jules Deschamps.</p>
<p>This notebook presents a simple use case of <em>information geometry</em>, in the context of <em>traffic optimization</em> in Sao Paulo. We rely on a dataset listing all traffic jams in Sao Paulo for the past two decades (their location, date, their size, their duration, i.e. how long the traffic was jammed) to propose a solution involving information geometry.</p>
<p>This analysis relies heavily on the geometry of the <em>Gamma manifold</em>, which is particularly adapted to addressing this situation, as seen later on.</p>
<center><p><img alt="7d907d54e6ec4153a5010de579b45e14" class="no-scaled-link" src="../_images/sao_paulo_traffic.jpg" style="width: 600px;" /></p>
</center><center><p>Figure 1: Sao Paulo: A city with 180km traffic jams – BBC News</p>
</center></section>
<section id="1.-Introduction-and-Motivation">
<h1>1. Introduction and Motivation<a class="headerlink" href="#1.-Introduction-and-Motivation" title="Permalink to this heading">#</a></h1>
<p>40% of São Paulo residents own a motor vehicle. While this is lower than cities in the United States, it is still higher than most other Latin American cities and São Paulo’s infrastructure was not built to accommodate such a large number of private vehicles. As The Urban Mobility Research Network of São Paulo found, some São Paulo residents spend one month per year in traffic, or 2.4 hours per day. As car ownership increases, and with it further congestion, this time spent in traffic will only
grow. In that regard, considering the increase in car ownership and air pollution, even though widening roads only brings a temporary solution, it can alleviate Brazilians of the absurd amount of time they spend in traffic.</p>
<p>In the role of Sao Paulo’s city planners, we have been granted a certain amount of resources to solve the congestion problem of Sao Paulo. The issue at hand becomes that of choosing which roads to renovate. More formally, the goal is eventually to reduce the mean expected congestion time in traffic.</p>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">geomstats_gitroot_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--show-toplevel&quot;</span><span class="p">],</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">geomstats_gitroot_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Working directory: &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Working directory:  C:\Users\Jules\Documents\geomstats
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="2.-Dataset-description">
<h1>2. Dataset description<a class="headerlink" href="#2.-Dataset-description" title="Permalink to this heading">#</a></h1>
<p>We have at our disposal a dataset (accessible <a class="reference external" href="https://www.kaggle.com/datasets/danlessa/sao-paulo-traffic-jams-since-2001">here</a>) containing traffic jam size measurements by CET at several locations on São Paulo between 2001 and 2019, with more than 5M entries.</p>
<p>Available columns: - passage (str) - Name of the passage - direction (str) - type (str) - Indicates if the passage is an expressway (E) - region (str) - São Paulo region - timestamp (datetime) - When the traffic jam was measured (UTC-4) - jam_size (int) - Traffic jam in meters - segment (str) - Where the passage is located</p>
<p>Our modeling will not take into account the fact that many of the passages/roads must have been renovated between 2001 and 2019. Similarly, the dataset does not offer information on the width of given roads (even though we could base it off of the type of the road), and therefore on their flow rate: this is an obvious flaw in our analysis but it is easy to fix if the relevant data can be accessed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.datasets.utils</span> <span class="kn">import</span> <span class="n">load_sao_paulo</span>
<span class="n">df</span><span class="p">,</span> <span class="n">jam_count</span> <span class="o">=</span> <span class="n">load_sao_paulo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Data has already been downloaded... using cached file (&#39;C:\Users\Jules\.geomstats_data\jam.zip&#39;).
</pre></div></div>
</div>
<p>Some of the columns of the dataset are not necessary for our study: let alone <strong>index</strong>, <strong>type</strong> and <strong>segment</strong> do not seem to add any value to the table in our case. In addition, the times (<strong>timestamp</strong>) at which jams are occurring are not relevant in that specific format: it would make much more sense to have the duration of given jam. We also decide to drop the <strong>jam_size</strong> column.</p>
<p>Additionally, we would want to transform the original dataset so as to access a more relevant table, with features: - name of the road (primary key = passage + direction for instance, segments are regrouped within same key) - date (day only) - duration of the traffic jam (in h)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>date</th>
      <th>duration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abraão Ribeiro, Av Dr (F)               Bairro...</td>
      <td>2005-01-12</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Abraão Ribeiro, Av Dr (F)               Bairro...</td>
      <td>2005-01-20</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Abraão Ribeiro, Av Dr (F)               Bairro...</td>
      <td>2005-01-21</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Abraão Ribeiro, Av Dr (F)               Bairro...</td>
      <td>2005-02-24</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Abraão Ribeiro, Av Dr (F)               Bairro...</td>
      <td>2005-02-28</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>650519</th>
      <td>Xangai, Vd                              unico/...</td>
      <td>2004-01-16</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>650520</th>
      <td>Xangai, Vd                              unico/...</td>
      <td>2004-03-24</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>650521</th>
      <td>Xangai, Vd                              unico/...</td>
      <td>2004-03-26</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>650522</th>
      <td>Xangai, Vd                              unico/...</td>
      <td>2004-04-29</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>650523</th>
      <td>Xangai, Vd                              unico/...</td>
      <td>2004-06-01</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
<p>650524 rows × 3 columns</p>
</div></div>
</div>
<p>Above is the table <strong>df</strong> of all traffic jams and their durations, for each day.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jam_count</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Abraão Ribeiro, Av Dr (F)               Bairro/Centro                           &#39;: 185,
 &#39;Abraão Ribeiro, Av Dr (F)               Centro/Bairro                           &#39;: 28,
 &#39;Abraão de Morais, Av Prof/Imig          Santos/São Paulo                        &#39;: 1870,
 &#39;Abraão de Morais, Av Prof/Imig          São Paulo/Santos                        &#39;: 852,
 &#39;Abraão de Morais, Av Prof/Imigrantes (F)Santos/São Paulo                        &#39;: 396,
 &#39;Abraão de Morais, Av Prof/Imigrantes (F)São Paulo/Santos                        &#39;: 107,
 &#39;Adolfo Pinheiro e Lgo 13/05             Bairro/Centro                           &#39;: 391,
 &#39;Adolfo Pinheiro e Lgo 13/05             Centro/Bairro                           &#39;: 657,
 &#39;Aliomar Baleeiro, Vd Min                Anchieta/Imigrantes                     &#39;: 3831,
 &#39;Aliomar Baleeiro, Vd Min                Imigrantes/Anchieta                     &#39;: 3191,
 &#39;Aliomar Baleeiro, Vd Min (F)            Anchieta/Imigrantes                     &#39;: 1,
 &#39;Alvarenga, R                            único//                                 &#39;: 1919,
 &#39;Amaro, Al  Sto                          único//                                 &#39;: 1000,
 &#39;Amaro, Av  Sto  (F)                     Bairro/Centro                           &#39;: 647,
 &#39;Amaro, Av  Sto  (F)                     Centro/Bairro                           &#39;: 316,
 &#39;Amaro, Av Sto (Pavao/Nebraska) (F)      Bairro/Centro                           &#39;: 41,
 &#39;Amaro, Av Sto (Pavao/Nebraska) (F)      Centro/Bairro                           &#39;: 23,
 &#39;Amaro, Av Sto - DEC SA (F)              Bairro/Centro                           &#39;: 6,
 &#39;Amaro, Av Sto - DEC SA (F)              Centro/Bairro                           &#39;: 8,
 &#39;Amaro, Av Sto DEC IB                    Bairro/Centro                           &#39;: 1814,
 &#39;Amaro, Av Sto DEC IB                    Centro/Bairro                           &#39;: 1280,
 &#39;Amaro, Av Sto DEC SA                    Bairro/Centro                           &#39;: 830,
 &#39;Amaro, Av Sto DEC SA                    Centro/Bairro                           &#39;: 803,
 &#39;Anchieta, Via                           Santos/São Paulo                        &#39;: 836,
 &#39;Anchieta, Via                           São Paulo/Santos                        &#39;: 1293,
 &#39;Angélica, Av                            Bairro/Centro                           &#39;: 19,
 &#39;Angélica, Av                            Centro/Bairro                           &#39;: 29,
 &#39;Angélica, Av (F)                        Centro/Bairro                           &#39;: 6,
 &#39;Antonio Nakashima, Vd                   único//                                 &#39;: 1432,
 &#39;Antártica, Vd                           Limão/Sumaré                            &#39;: 1331,
 &#39;Antártica, Vd                           Sumaré/Limão                            &#39;: 1308,
 &#39;Antônio Joaquim de Moura Andrade, Av    Ibirapuera/Marginal                     &#39;: 7071,
 &#39;Antônio Joaquim de Moura Andrade, Av    Marginal/Ibirapuera                     &#39;: 2428,
 &#39;Arcoverde, R Card                       //unico                                 &#39;: 238,
 &#39;Arcoverde, R Cardeal (F)                único//                                 &#39;: 1270,
 &#39;Aricanduva, Av/Elev/Pt                  Itaquera/Marginal                       &#39;: 4929,
 &#39;Aricanduva, Av/Elev/Pt                  Marginal/Itaquera                       &#39;: 3891,
 &#39;Aricanduva/Elevado/Ponte( F)            Itaquera/Marginal                       &#39;: 2258,
 &#39;Aricanduva/Elevado/Ponte( F)            Marginal/Itaquera                       &#39;: 1315,
 &#39;Arnaldo,  Av Dr                         Consolação/Sumare                       &#39;: 2596,
 &#39;Arnaldo,  Av Dr                         Sumare/Consolação                       &#39;: 5998,
 &#39;Arthur da Costa e Silva, Elev Pres      Lapa/Penha                              &#39;: 4972,
 &#39;Arthur da Costa e Silva, Elev Pres      Penha/Lapa                              &#39;: 3743,
 &#39;Ary Torres, Eng. Pte                    único//                                 &#39;: 3517,
 &#39;Asc.Reis/R.Berta(Local)                 Bairro/Centro                           &#39;: 2614,
 &#39;Asc.Reis/R.Berta(Local)                 Centro/Bairro                           &#39;: 998,
 &#39;Ataliba Leonel, Av. Gal.                Bairro/Centro                           &#39;: 56,
 &#39;Ataliba Leonel, Av. Gal.                Centro/Bairro                           &#39;: 110,
 &#39;Atilio Fontana, Pte                     Capital/Interior                        &#39;: 71,
 &#39;Atilio Fontana, Pte                     Interior/Capital                        &#39;: 3640,
 &#39;Atlantica, AV                           Bairro/Centro                           &#39;: 485,
 &#39;Atlantica, AV                           Centro/Bairro                           &#39;: 24,
 &#39;Ayrton Senna I, Tn (NÃO USAR)           Centro/Bairro                           &#39;: 2,
 &#39;Ayrton Senna I, Túnel                   unico//                                 &#39;: 7159,
 &#39;Ayrton Senna II,  Túnel                 unico//                                 &#39;: 3815,
 &#39;Bandeirantes, Av dos                    Imigrantes/Marginal                     &#39;: 7714,
 &#39;Bandeirantes, Av dos                    Marginal/Imigrantes                     &#39;: 6796,
 &#39;Bento, Lgo São                          //unico                                 &#39;: 9,
 &#39;Bernardino/Verg/Noe/Domingos/Jabaquara  Bairro/Centro                           &#39;: 2153,
 &#39;Bernardino/Verg/Noe/Domingos/Jabaquara  Centro/Bairro                           &#39;: 519,
 &#39;Bernardo Goldfarb, Pte                  Bairro/Centro                           &#39;: 1079,
 &#39;Bernardo Goldfarb, Pte                  Centro/Bairro                           &#39;: 174,
 &#39;Brasil, Av                              Ibirapuera/Pinheiros                    &#39;: 246,
 &#39;Brasil, Av                              Pinheiros/Ibirapuera                    &#39;: 537,
 &#39;Brás Leme, Av / Pte Casa Verde          Bairro/Centro                           &#39;: 2002,
 &#39;Brás Leme, Av / Pte Casa Verde          Centro/Bairro                           &#39;: 419,
 &#39;Butantã, R                              //unico                                 &#39;: 206,
 &#39;Butantã, R  (F)                         unico//                                 &#39;: 2032,
 &#39;CJardim/Europa, Av/Colômbia, R (F)      Bairro/Centro                           &#39;: 1,
 &#39;Caetano Alvares, Av. Eng.               Bairro/Centro                           &#39;: 26,
 &#39;Caetano Alvares, Av. Eng.               Centro/Bairro                           &#39;: 85,
 &#39;Camargo, R                              único//                                 &#39;: 1430,
 &#39;Carlos Caldeira Filho, Av               Bairro/Centro                           &#39;: 1209,
 &#39;Carlos Caldeira Filho, Av               Centro/Bairro                           &#39;: 345,
 &#39;Carrão,  Av Cons   (F)                  Bairro/Centro                           &#39;: 488,
 &#39;Carrão,  Av Cons   (F)                  Centro/Bairro                           &#39;: 61,
 &#39;Carrão, Av Cons                         Bairro/Centro                           &#39;: 264,
 &#39;Carrão, Av Cons                         Centro/Bairro                           &#39;: 116,
 &#39;Casa Verde, Pte e Av Bras Leme (F)      Bairro/Centro                           &#39;: 874,
 &#39;Casa Verde, Pte e Av Bras Leme (F)      Centro/Bairro                           &#39;: 324,
 &#39;Catiguá, R / Melo Peixoto, R (F)        Bairro/Centro                           &#39;: 1339,
 &#39;Catiguá, R / Melo Peixoto, R (F)        Centro/Bairro                           &#39;: 21,
 &#39;Celso Garcia, Av                        Bairro/Centro                           &#39;: 124,
 &#39;Celso Garcia, Av                        Centro/Bairro                           &#39;: 549,
 &#39;Chucri Zaidan, Av Dr                    Bandeirantes/Morumbi                    &#39;: 1706,
 &#39;Chucri Zaidan, Av Dr                    Morumbi/Bandeirantes                    &#39;: 285,
 &#39;Chucri Zaidan, Av Dr  (F)               Bandeirantes/Morumbi                    &#39;: 461,
 &#39;Chucri Zaidan, Av Dr  (F)               Morumbi/Bandeirantes                    &#39;: 380,
 &#39;Cidade Jardim / Europa / Colômbia       Bairro/Centro                           &#39;: 6013,
 &#39;Cidade Jardim / Europa / Colômbia       Centro/Bairro                           &#39;: 5448,
 &#39;Cidade Universitária, Pt                PanAmericana/USP                        &#39;: 3050,
 &#39;Cidade Universitária, Pt                USP/PanAmericana                        &#39;: 179,
 &#39;Cidade Universitária, Pte (F)           PanAmericana/USP                        &#39;: 1744,
 &#39;Cidade Universitária, Pte (F)           USP/PanAmericana                        &#39;: 116,
 &#39;Clelia, R (F)                           único//                                 &#39;: 172,
 &#39;Clélia, R                               //unico                                 &#39;: 391,
 &#39;Consolação, R da                        Bairro/Centro                           &#39;: 3618,
 &#39;Consolação, R da                        Centro/Bairro                           &#39;: 3679,
 &#39;Consolação, R da   (F)                  Bairro/Centro                           &#39;: 2257,
 &#39;Consolação, R da   (F)                  Centro/Bairro                           &#39;: 2784,
 &#39;Copa-Afonso de S. Souza/Harry DannembergAricanduva/Itaquera                     &#39;: 1,
 &#39;Copa-Aguia de Haia                      A Alvim/S Miguel                        &#39;: 11,
 &#39;Copa-Aguia de Haia                      S Miguel/A Alvim                        &#39;: 4,
 &#39;Copa-Aguia de Haia (F)                  S Miguel/A Alvim                        &#39;: 1,
 &#39;Copa-Campanella                         Bairro/Centro                           &#39;: 10,
 &#39;Copa-Campanella                         Centro/Bairro                           &#39;: 11,
 &#39;Copa-Itaquera/Lider                     Itaquera/Vila Formosa                   &#39;: 6,
 &#39;Copa-Itaquera/Lider                     Vila Formosa/Itaquera                   &#39;: 14,
 &#39;Copa-Jacu Pessêgo-N. Trabalhadores      A Senna/Maua                            &#39;: 4,
 &#39;Copa-Jacu Pessêgo-N. Trabalhadores      Maua/A Senna                            &#39;: 8,
 &#39;Copa-Luiz Ayres                         Bairro/Centro                           &#39;: 2,
 &#39;Copa-Luiz Ayres                         Centro/Bairro                           &#39;: 11,
 &#39;Copa-Pires do Rio                       Bairro/Centro                           &#39;: 7,
 &#39;Copa-Pires do Rio                       Centro/Bairro                           &#39;: 8,
 &#39;Corifeu de A Marques, Av                Bairro/Centro                           &#39;: 663,
 &#39;Corifeu de A Marques, Av                Centro/Bairro                           &#39;: 141,
 &#39;Corifeu de Azevedo Marques, Av  (F)     Bairro/Centro                           &#39;: 73,
 &#39;Corifeu de Azevedo Marques, Av  (F)     Centro/Bairro                           &#39;: 4,
 &#39;Cruzeiro do Sul, Pt e Av                Ipiranga/Santana                        &#39;: 1377,
 &#39;Cruzeiro do Sul, Pt e Av                Santana/Ipiranga                        &#39;: 2409,
 &#39;Cruzeiro do Sul, Pte e Av  (F)          Ipiranga/Santana                        &#39;: 397,
 &#39;Cruzeiro do Sul, Pte e Av  (F)          Santana/Ipiranga                        &#39;: 421,
 &#39;Dianópolis, Av                          //unico                                 &#39;: 395,
 &#39;Dianópolis, Av  (F)                     unico//                                 &#39;: 181,
 &#39;Diário Popular, Vd                      único//                                 &#39;: 189,
 &#39;Dom Pedro (Av Exterior) Pq              //unico                                 &#39;: 15,
 &#39;Dom Pedro (Av do Exterior), Parque (F)  unico//                                 &#39;: 43,
 &#39;Edgar Facó, Av.                         Bairro/Centro                           &#39;: 1197,
 &#39;Edgar Facó, Av.                         Centro/Bairro                           &#39;: 160,
 &#39;Eliseu de Almeida, Av                   Bairro/Centro                           &#39;: 821,
 &#39;Eliseu de Almeida, Av                   Centro/Bairro                           &#39;: 75,
 &#39;Ermano Marchetti, Av                    Barra Funda/Lapa                        &#39;: 710,
 &#39;Ermano Marchetti, Av                    Lapa/Barra Funda                        &#39;: 606,
 &#39;Escola Politécnica, Av                  Bairro/Centro                           &#39;: 752,
 &#39;Escola Politécnica, Av                  Centro/Bairro                           &#39;: 39,
 &#39;Estado, Av do - DEC CT                  Ipiranga/Santana                        &#39;: 7017,
 &#39;Estado, Av do - DEC CT                  Santana/Ipiranga                        &#39;: 4633,
 &#39;Estado, Av do - DEC VILA PRUDENTE       Ipiranga/Santana                        &#39;: 3409,
 &#39;Estado, Av do - DEC VILA PRUDENTE       Santana/Ipiranga                        &#39;: 3920,
 &#39;Estela, R                               unico//                                 &#39;: 41,
 &#39;Eusébio M/Francisco Morato, Av Prof     Bairro/Centro                           &#39;: 5021,
 &#39;Eusébio M/Francisco Morato, Av Prof     Centro/Bairro                           &#39;: 2887,
 &#39;Eusébio Stevaux, Vd                     único//                                 &#39;: 1445,
 &#39;F1 - Jacinto Júlio, Av                  Bairro/Centro                           &#39;: 1,
 &#39;F1 - Jacinto Júlio, Av                  Centro/Bairro                           &#39;: 3,
 &#39;F1 - Jangadeiro, Av                     Bairro/Centro                           &#39;: 4,
 &#39;F1 - Jangadeiro, Av                     Centro/Bairro                           &#39;: 2,
 &#39;F1 - João Paulo da Silva, Av            Bairro/Centro                           &#39;: 2,
 &#39;F1 - Miguel Yunes/Pte Vitorino Goulart  Interlagos/Marginal                     &#39;: 2,
 &#39;F1 - Papini, Av Prof                    Centro/Bairro                           &#39;: 3,
 &#39;F1 - Rio Bonito, Av                     Bairro/Centro                           &#39;: 2,
 &#39;F1 - Rio Bonito, Av                     Centro/Bairro                           &#39;: 1,
 &#39;F1 - Rubens Montanaro de Borba, Av      Bairro/Centro                           &#39;: 1,
 &#39;F1 - Teotonio Vilela, Av Sen            Bairro/Centro                           &#39;: 3,
 &#39;F1 - Teotonio Vilela, Av Sen            Centro/Bairro                           &#39;: 3,
 &#39;Faria Lima,  Av Brig                    Itaim/Pinheiros                         &#39;: 3606,
 &#39;Faria Lima,  Av Brig                    Pinheiros/Itaim                         &#39;: 5154,
 &#39;Fernando Vieira de Mello Túnel(Reboucas)Bairro/Centro                           &#39;: 5663,
 &#39;Fernando Vieira de Mello Túnel(Reboucas)Centro/Bairro                           &#39;: 5516,
 &#39;Ferradura                               unico//                                 &#39;: 698,
 &#39;Figueira, R da                          unico//                                 &#39;: 802,
 &#39;Francisco Matarazzo, Av                 Bairro/Centro                           &#39;: 1170,
 &#39;Francisco Matarazzo, Av                 Centro/Bairro                           &#39;: 1316,
 &#39;Francisco Matarazzo, Av  (F)            Bairro/Centro                           &#39;: 1895,
 &#39;Francisco Matarazzo, Av  (F)            Centro/Bairro                           &#39;: 2070,
 &#39;Francisco Mesquita, Av Dr               S. Caetano/Sao Paulo                    &#39;: 2214,
 &#39;Francisco Mesquita, Av Dr               Sao Paulo/S. Caetano                    &#39;: 168,
 &#39;Francisco Morato, Av Prof               Bairro/Centro                           &#39;: 1751,
 &#39;Francisco Morato, Av Prof               Centro/Bairro                           &#39;: 1145,
 &#39;Frederico Eduardo Mayr, Vd              unico//                                 &#39;: 861,
 &#39;Freguesia, Pte                          Freguesia/Lapa                          &#39;: 775,
 &#39;Freguesia, Pte                          Lapa/Freguesia                          &#39;: 323,
 &#39;Freguesia/Com Martinelli, Pte  (F)      Freguesia/Lapa                          &#39;: 507,
 &#39;Freguesia/Com Martinelli, Pte  (F)      Lapa/Freguesia                          &#39;: 110,
 &#39;Gabriel,  Av São (F)                    Bairro/Centro                           &#39;: 127,
 &#39;Gabriel,  Av São (F)                    Centro/Bairro                           &#39;: 271,
 &#39;Gabriel, Av São                         Bairro/Centro                           &#39;: 114,
 &#39;Gabriel, Av São                         Centro/Bairro                           &#39;: 428,
 &#39;Gastão Vidigal, Av Dr                   Marginal/Pinheiros                      &#39;: 804,
 &#39;Gastão Vidigal, Av Dr                   Pinheiros/Marginal                      &#39;: 670,
 &#39;Gastão Vidigal, Av Dr (F)               Lapa/Pinheiros                          &#39;: 163,
 &#39;Gastão Vidigal, Av Dr (F)               Pinheiros/Lapa                          &#39;: 132,
 &#39;Gasômetro, R e Vd                       único//                                 &#39;: 1324,
 &#39;Gazeta do Ipiranga, Vd                  unico//                                 &#39;: 301,
 &#39;Grande Sao Paulo, Vd                    Ipiranga/Vila Prudente                  &#39;: 3851,
 &#39;Grande Sao Paulo, Vd                    Vila Prudente/Ipiranga                  &#39;: 1965,
 &#39;Groenlandia, R                          unico//                                 &#39;: 2879,
 &#39;Guadalajara, Vd                         Belem/Mooca                             &#39;: 50,
 &#39;Guadalajara, Vd                         Mooca/Belem                             &#39;: 20,
 &#39;Guaicurus, R                            //unico                                 &#39;: 143,
 &#39;Guaicurus, R (F)                        unico//                                 &#39;: 111,
 &#39;Guarapiranga, Av                        Bairro/Centro                           &#39;: 755,
 &#39;Guarapiranga, Av                        Centro/Bairro                           &#39;: 751,
 &#39;Guido Caloi, Av                         Bairro/Centro                           &#39;: 292,
 &#39;Guido Caloi, Av                         Centro/Bairro                           &#39;: 423,
 &#39;Guilherme Dumont Vilares, Av Dr         Campo Limpo/Morato                      &#39;: 16,
 &#39;Guilherme Dumont Vilares, Av Dr         Morato/Campo Limpo                      &#39;: 7,
 &#39;Heitor Penteado, R                      Bairro/Centro                           &#39;: 202,
 &#39;Heitor Penteado, R                      Centro/Bairro                           &#39;: 179,
 &#39;Ibirapuera, Av                          Bairro/Centro                           &#39;: 2225,
 &#39;Ibirapuera, Av                          Centro/Bairro                           &#39;: 3705,
 &#39;Ibirapuera, Av  (F)                     Bairro/Centro                           &#39;: 2433,
 &#39;Ibirapuera, Av  (F)                     Centro/Bairro                           &#39;: 2911,
 &#39;Ibitirama, R                            unico//                                 &#39;: 171,
 &#39;Iguatemi, R                             //unico                                 &#39;: 336,
 &#39;Iguatemi, R  (F)                        único//                                 &#39;: 437,
 &#39;Inajar de Souza, Av                     Freguesia/Lapa                          &#39;: 794,
 &#39;Inajar de Souza, Av                     Lapa/Freguesia                          &#39;: 34,
 &#39;Inajar de Souza, Av (F)                 Freguesia/Lapa                          &#39;: 16,
 &#39;Interlagos, Av  I                       Bairro/Centro                           &#39;: 2008,
 &#39;Interlagos, Av  I                       Centro/Bairro                           &#39;: 1110,
 &#39;Ipiranga, Av                            unico//                                 &#39;: 1523,
 &#39;Itapecerica, Est de                     Bairro/Centro                           &#39;: 871,
 &#39;Itapecerica, Est de                     Centro/Bairro                           &#39;: 145,
 &#39;Itapecirica, Est de  (F)                Bairro/Centro                           &#39;: 274,
 &#39;Itapecirica, Est de  (F)                Centro/Bairro                           &#39;: 86,
 &#39;Itápolis, R                             //unico                                 &#39;: 6,
 &#39;Jacinto Júlio, Av                       Bairro/Centro                           &#39;: 2,
 &#39;Jaguare, Av                             Bairro/Centro                           &#39;: 353,
 &#39;Jaguare, Av                             Centro/Bairro                           &#39;: 287,
 &#39;Jaguaré, Pte                            Jaguaré/Lapa                            &#39;: 314,
 &#39;Jaguaré, Pte                            Lapa/Jaguaré                            &#39;: 828,
 &#39;Jangadeiro, Av                          Bairro/Centro                           &#39;: 1,
 &#39;Jangadeiro, Av                          Centro/Bairro                           &#39;: 4,
 &#39;Jose Colassuono, Vd                     unico//                                 &#39;: 1534,
 &#39;Jose Felix, R                           Campo Limpo/Morato                      &#39;: 6,
 &#39;Jose Felix, R                           Morato/Campo Limpo                      &#39;: 2,
 &#39;José Diniz,  Av Ver  (F)                Bairro/Centro                           &#39;: 915,
 &#39;José Diniz,  Av Ver  (F)                Centro/Bairro                           &#39;: 1726,
 &#39;José Diniz, Av Ver                      Bairro/Centro                           &#39;: 2743,
 &#39;José Diniz, Av Ver                      Centro/Bairro                           &#39;: 3017,
 &#39;José Garzotti, Av. Pe                   Teotônio/Batista Botelho                &#39;: 1,
 &#39;José Maria,  Av Pe                      Bairro/Centro                           &#39;: 267,
 &#39;José Maria,  Av Pe                      Centro/Bairro                           &#39;: 18,
 &#39;João De Luca, Ver                       Diadema/Marginal                        &#39;: 122,
 &#39;João De Luca, Ver                       Marginal/Diadema                        &#39;: 68,
 &#39;João Dias, Av                           Bairro/Centro                           &#39;: 2689,
 &#39;João Dias, Av                           Centro/Bairro                           &#39;: 2667,
 &#39;João Dias, Av (F)                       Bairro/Centro                           &#39;: 1580,
 &#39;João Dias, Av (F)                       Centro/Bairro                           &#39;: 1350,
 &#39;João Goulart, Elev Pres                 Lapa/Penha                              &#39;: 173,
 &#39;João Goulart, Elev Pres                 Penha/Lapa                              &#39;: 95,
 &#39;João Jorge Saad,Vd (Cebolinha)          Centro/Bairro                           &#39;: 384,
 &#39;João Mendes, Pça                        //unico                                 &#39;: 642,
 &#39;João Paulo da Silva, Av                 Bairro/Centro                           &#39;: 5,
 &#39;João Paulo da Silva, Av                 Centro/Bairro                           &#39;: 2,
 &#39;João, Av São                            único//                                 &#39;: 185,
 &#39;Julio de Mesquita, Pte                  Lapa/Piqueri                            &#39;: 29,
 &#39;Julio de Mesquita, Pte                  Limão/Pompéia                           &#39;: 667,
 &#39;Julio de Mesquita, Pte                  Piqueri/Lapa                            &#39;: 77,
 &#39;Julio de Mesquita, Pte                  Pompéia/Limão                           &#39;: 55,
 &#39;Juntas Provisórias, R das               Ipiranga/Vila Prudente                  &#39;: 2782,
 &#39;Juntas Provisórias, R das               Vila Prudente/Ipiranga                  &#39;: 1425,
 &#39;Juscelino Kubitschek, Av Pres           Ibirapuera/Pinheiros                    &#39;: 7635,
 &#39;Juscelino Kubitschek, Av Pres           Pinheiros/Ibirapuera                    &#39;: 8411,
 &#39;Jânio Quadros, Pres. Pte (Vila Maria)   Bairro/Centro                           &#39;: 114,
 &#39;Jânio Quadros, Pres. Pte (Vila Maria)   Centro/Bairro                           &#39;: 68,
 &#39;Jânio Quadros, Túnel                    unico//                                 &#39;: 4050,
 &#39;Lapa, Vd                                Lapa/Piqueri                            &#39;: 306,
 &#39;Lapa, Vd                                Piqueri/Lapa                            &#39;: 684,
 &#39;Liberdade/ Vergueiro, Av                Bairro/Centro                           &#39;: 841,
 &#39;Liberdade/ Vergueiro, Av                Centro/Bairro                           &#39;: 735,
 &#39;Ligação - Dec HG (F)                    Lapa/Penha                              &#39;: 2672,
 &#39;Ligação - Dec HG (F)                    Penha/Lapa                              &#39;: 2958,
 &#39;Ligação Leste-Oeste                     Lapa/Penha                              &#39;: 4424,
 &#39;Ligação Leste-Oeste                     Penha/Lapa                              &#39;: 4357,
 &#39;Limão / Av. Ordem e Progresso, Pte      Limão/Sumaré                            &#39;: 3797,
 &#39;Limão / Av. Ordem e Progresso, Pte      Sumaré/Limão                            &#39;: 182,
 &#39;Limão, Pt/Ordem e Progresso, Av (N USAR)Limão/Sumaré                            &#39;: 3,
 &#39;Lineu de Paula Machado, Av              Bairro/Centro                           &#39;: 1190,
 &#39;Lineu de Paula Machado, Av              Butanta/Morumbi                         &#39;: 849,
 &#39;Lineu de Paula Machado, Av              Centro/Bairro                           &#39;: 70,
 &#39;Lineu de Paula Machado, Av              Joquei/USP                              &#39;: 62,
 &#39;Lineu de Paula Machado, Av              Morumbi/Butanta                         &#39;: 79,
 &#39;Lineu de Paula Machado, Av              USP/Joquei                              &#39;: 597,
 &#39;Luis Antonio, Av Brig                   Bairro/Centro                           &#39;: 433,
 &#39;Luis Antonio, Av Brig                   Centro/Bairro                           &#39;: 171,
 &#39;Luis Antonio, Av Brig.   Dec-PA  (F)    Bairro/Centro                           &#39;: 357,
 &#39;Luis Antonio, Av Brig.   Dec-PA  (F)    Centro/Bairro                           &#39;: 20,
 &#39;Luis Carlos Berrini, Av Eng             Bandeirantes/Morumbi                    &#39;: 1593,
 &#39;Luis Carlos Berrini, Av Eng             Morumbi/Bandeirantes                    &#39;: 967,
 &#39;Luis Carlos Berrini,Eng Av (F)          Bandeirantes/Morumbi                    &#39;: 1514,
 &#39;Luis Carlos Berrini,Eng Av (F)          Morumbi/Bandeirantes                    &#39;: 906,
 &#39;Luis, Av. São                           //unico                                 &#39;: 195,
 &#39;Luiz Ignácio de Anhaia Mello, Av Prof   Bairro/Centro                           &#39;: 4055,
 &#39;Luiz Ignácio de Anhaia Mello, Av Prof   Centro/Bairro                           &#39;: 2964,
 &#39;Luiz Ignácio de Anhaia Mello, Av Prof   Sapopem./Vila Prudente                  &#39;: 706,
 &#39;Luiz Ignácio de Anhaia Mello, Av Prof   Vila Prudente/Sapopem.                  &#39;: 360,
 &#39;M Paula, R/Jacarei/n Julho, Vd (F)      //unico                                 &#39;: 2,
 &#39;M.M.D.C, R                              único//                                 &#39;: 1597,
 &#39;Manuel de Teffé, R                      Bairro/Centro                           &#39;: 7,
 &#39;Marginal Pinheiros                      Castelo/Interlagos                      &#39;: 10332,
 &#39;Marginal Pinheiros                      Interlagos/Castelo                      &#39;: 9675,
 &#39;Marginal Tietê                          A.Senna/Castelo Branco                  &#39;: 10776,
 &#39;Marginal Tietê                          Castelo/A.Senna                         &#39;: 9885,
 &#39;Marginal Tietê - Pista Central          A.Senna/Castelo Branco                  &#39;: 2883,
 &#39;Marginal Tietê - Pista Central          Castelo/A.Senna                         &#39;: 2974,
 &#39;Maria Coelho Aguiar, Av                 Bairro/Centro                           &#39;: 746,
 &#39;Maria Coelho Aguiar, Av                 Centro/Bairro                           &#39;: 2554,
 &#39;Maria Maluf, CV                         Anchieta/Imigrantes                     &#39;: 4512,
 &#39;Maria Maluf, CV                         Imigrantes/Anchieta                     &#39;: 5019,
 &#39;Maria Paula/Vd Jacareí/Vd 9 de Julho    único//                                 &#39;: 2778,
 &#39;Matriz, R da                            unico//                                 &#39;: 14,
 &#39;Max Feffer Túnel (Cidade Jardim)        Bairro/Centro                           &#39;: 4793,
 &#39;Max Feffer Túnel (Cidade Jardim)        Centro/Bairro                           &#39;: 2667,
 &#39;Melo Peixoto, R                         Bairro/Centro                           &#39;: 1244,
 &#39;Melo Peixoto, R                         Centro/Bairro                           &#39;: 1352,
 &#39;Melo Peixoto, R (F)                     Bairro/Centro                           &#39;: 286,
 &#39;Melo Peixoto, R (F)                     Centro/Bairro                           &#39;: 126,
 &#39;Mercúrio, Av                            único//                                 &#39;: 3250,
 &#39;Miguel Estefano,VD                      Abraão de Morais/Cursino                &#39;: 26,
 &#39;Miguel Estefano,VD                      Cursino/Abraão de Morais                &#39;: 10,
 &#39;Miguel Yunes/Pte Vitorino Goulart       Interlagos/Marginal                     &#39;: 6,
 &#39;Miguel Yunes/Pte Vitorino Goulart       Marginal/Interlagos                     &#39;: 3,
 &#39;Morumbi, Av                             Campo Limpo/Santo Amaro                 &#39;: 194,
 &#39;Morumbi, Av                             Morumbi/Santo Amaro                     &#39;: 1134,
 &#39;Morumbi, Av                             Santo Amaro/Campo Limpo                 &#39;: 196,
 &#39;Morumbi, Av                             Santo Amaro/Morumbi                     &#39;: 358,
 &#39;Morumbi, Av. e Pte                      Aeroporto/Marginal                      &#39;: 2175,
 &#39;Morumbi, Av. e Pte                      Marginal/Aeroporto                      &#39;: 2632,
 &#39;M´Boi Mirim, Est                        Bairro/Centro                           &#39;: 8,
 &#39;M´Boi Mirim, Est                        Centro/Bairro                           &#39;: 1,
 &#39;Natanael,  R Mj (F)                     Estadio/Jardins                         &#39;: 279,
 &#39;Nova Morumbi, Pte (F)                   unico//                                 &#39;: 1026,
 &#39;Nove de Julho, Av                       Bairro/Centro                           &#39;: 4115,
 &#39;Nove de Julho, Av                       Centro/Bairro                           &#39;: 5088,
 &#39;Nove de Julho, Av (F)                   Bairro/Centro                           &#39;: 2488,
 &#39;Nove de Julho, Av (F)                   Centro/Bairro                           &#39;: 2439,
 &#39;Nove de Julho, Av - DEC PA  (F)         Bairro/Centro                           &#39;: 297,
 &#39;Nove de Julho, Av - DEC PA  (F)         Centro/Bairro                           &#39;: 719,
 &#39;Olivia Guedes Penteado, R               Bairro/Centro                           &#39;: 2,
 &#39;Oscar Americano, R Eng                  Bairro/Centro                           &#39;: 2037,
 &#39;Oscar Americano, R Eng                  Centro/Bairro                           &#39;: 1767,
 &#39;Oscar Americano, R Eng  (F)             Bairro/Centro                           &#39;: 445,
 &#39;Oscar Americano, R Eng  (F)             Centro/Bairro                           &#39;: 62,
 &#39;Outeiro, Av NSra do                     Batista Botelho/Teotônio                &#39;: 1,
 &#39;Pacaembu / Mj Natanael / Abraao Ribeiro Estádio/Marginal                        &#39;: 1390,
 &#39;Pacaembu / Mj Natanael / Abraao Ribeiro Marginal/Estádio                        &#39;: 4199,
 &#39;Pacaembu, Vd (F)                        Bairro/Centro                           &#39;: 330,
 &#39;Pacaembu, Vd (F)                        Centro/Bairro                           &#39;: 279,
 &#39;Pacheco e Chaves, Cap. Vd               Ipiranga/Vila Prudente                  &#39;: 188,
 &#39;Pacheco e Chaves, Cap. Vd               Vila Prudente/Ipiranga                  &#39;: 1791,
 &#39;Pacheco e Chaves, R Cap                 Bairro/Centro                           &#39;: 310,
 &#39;Pacheco e Chaves, R Cap                 Centro/Bairro                           &#39;: 36,
 &#39;Papini, Av Prof                         Bairro/Centro                           &#39;: 5,
 &#39;Papini, Av Prof                         Centro/Bairro                           &#39;: 20,
 &#39;Paulina, Vd Dona                        //unico                                 &#39;: 2644,
 &#39;Paulina, Vd Dona  (F)                   único//                                 &#39;: 1935,
 &#39;Paulista, Av                            Consolação/Paraiso                      &#39;: 6247,
 &#39;Paulista, Av                            Paraiso/Consolação                      &#39;: 9888,
 &#39;Paulo Eiró, R                           único//                                 &#39;: 2,
 &#39;Paulo VI, Av                            Limão/Sumaré                            &#39;: 72,
 &#39;Paulo VI, Av                            Sumaré/Limão                            &#39;: 36,
 &#39;Pedro Alvares Cabral, Av                Pinheiros/Vila Mariana                  &#39;: 680,
 &#39;Pedro Alvares Cabral, Av                Vila Mariana/Pinheiros                  &#39;: 1231,
 &#39;Pedro Alvares Cabral, Av  (F)           Pinheiros/Vila Mariana                  &#39;: 791,
 &#39;Pedro Alvares Cabral, Av  (F)           Vila Mariana/Pinheiros                  &#39;: 1975,
 &#39;Pedro I, Av. Dom                        Bairro/Centro                           &#39;: 13,
 &#39;Pedro I, Av. Dom                        Centro/Bairro                           &#39;: 18,
 &#39;Pinedo, Av de                           unico//                                 &#39;: 1,
 &#39;Piqueri, Pt                             Lapa/Piqueri                            &#39;: 579,
 &#39;Piqueri, Pt                             Piqueri/Lapa                            &#39;: 903,
 &#39;Piqueri, Pte (F)                        Lapa/Piqueri                            &#39;: 278,
 &#39;Piqueri, Pte (F)                        Piqueri/Lapa                            &#39;: 1054,
 &#39;Pirajussara, Av                         Bairro/Centro                           &#39;: 17,
 &#39;Pirajussara, Av                         Centro/Bairro                           &#39;: 53,
 &#39;Pompeia, Vd                             Marginal/Pompeia                        &#39;: 2452,
 &#39;Pompeia, Vd                             Pompeia/Marginal                        &#39;: 384,
 &#39;Queiroz Filho /Jaguaré, Pte             Bairro/Centro                           &#39;: 554,
 &#39;Queiroz Filho /Jaguaré, Pte             Centro/Bairro                           &#39;: 1276,
 &#39;Queiroz, Av. Sen.                       //unico                                 &#39;: 956,
 &#39;Radial Leste - DEC BR                   Bairro/Centro                           &#39;: 6210,
 &#39;Radial Leste - DEC BR                   Centro/Bairro                           &#39;: 4474,
 &#39;Radial Leste - DEC MO                   Bairro/Centro                           &#39;: 7150,
 &#39;Radial Leste - DEC MO                   Centro/Bairro                           &#39;: 4722,
 &#39;Raimundo Pereira Magalhaes, Av          Bairro/Centro                           &#39;: 47,
 &#39;Raimundo Pereira Magalhaes, Av          Centro/Bairro                           &#39;: 5,
 &#39;Raimundo Pereira de Magalhães - Norte   Bairro/Centro                           &#39;: 12,
 &#39;Raimundo Pereira de Magalhães - Norte   Centro/Bairro                           &#39;: 3,
 &#39;Raimundo Pereira de Magalhães - Sul     Bairro/Centro                           &#39;: 4,
 &#39;Raimundo Pereira de Magalhães - Sul     Centro/Bairro                           &#39;: 5,
 &#39;Rangel Pestana, Av (F)                  unico//                                 &#39;: 163,
 &#39;Rangel Pestana, Av DEC BR               //unico                                 &#39;: 1134,
 &#39;Rangel Pestana, Av DEC CT               Bairro/Centro                           &#39;: 548,
 &#39;Rangel Pestana, Av DEC CT               Centro/Bairro                           &#39;: 66,
 &#39;Raposo Tavares, Via                     Capital/Interior                        &#39;: 632,
 &#39;Raposo Tavares, Via                     Interior/Capital                        &#39;: 3652,
 &#39;Reação, R                               único//                                 &#39;: 1388,
 &#39;Rebouças/ Eusébio Matoso,  Av           Bairro/Centro                           &#39;: 8167,
 &#39;Rebouças/ Eusébio Matoso,  Av           Centro/Bairro                           &#39;: 8720,
 &#39;Remédios, Pte                           Lapa/Remédios                           &#39;: 1471,
 &#39;Remédios, Pte                           Remédios/Lapa                           &#39;: 1965,
 &#39;Republica da Armenia, Vd                único//                                 &#39;: 4197,
 &#39;República do Líbano, Av                 Bairro/Centro                           &#39;: 750,
 &#39;República do Líbano, Av                 Centro/Bairro                           &#39;: 788,
 &#39;República do Líbano, Av  (F)            Bairro/Centro                           &#39;: 248,
 &#39;República do Líbano, Av  (F)            Centro/Bairro                           &#39;: 129,
 &#39;Ribeiro Lacerda, R                      Abraão de Morais/Cursino                &#39;: 2,
 &#39;Ribeiro Lacerda, R                      Cursino/Abraão de Morais                &#39;: 21,
 &#39;Ricardo Jafet, Av                       Bairro/Centro                           &#39;: 159,
 &#39;Ricardo Jafet, Av                       Centro/Bairro                           &#39;: 228,
 &#39;Rio Bonito, Av                          Centro/Bairro                           &#39;: 1,
 &#39;Rio Branco,  Br do                      unico//                                 &#39;: 122,
 &#39;Rio Branco, Av                          Bairro/Centro                           &#39;: 195,
 &#39;Rio Branco, Av                          Centro/Bairro                           &#39;: 342,
 &#39;Robert Kennedy, Av                      Bairro/Centro                           &#39;: 164,
 &#39;Robert Kennedy, Av                      Centro/Bairro                           &#39;: 37,
 &#39;Roberto Abreu Sodré, Vd                 Bairro/Centro                           &#39;: 2243,
 &#39;Roberto Abreu Sodré, Vd                 Centro/Bairro                           &#39;: 169,
 &#39;Roque Petroni Júnior, Av                Diadema/Marginal                        &#39;: 1253,
 &#39;Roque Petroni Júnior, Av                Marginal/Diadema                        &#39;: 683,
 &#39;Roque Petroni Júnior, Av (F)            Diadema/Marginal                        &#39;: 881,
 &#39;Roque Petroni Júnior, Av (F)            Marginal/Diadema                        &#39;: 496,
 &#39;Rudge, Av/Orlando Murgel, Vd            Bairro/Centro                           &#39;: 484,
 &#39;Rudge, Av/Orlando Murgel, Vd            Centro/Bairro                           &#39;: 541,
 &#39;Rudge, Av/Orlando Murgel, Vd (F)        Bairro/Centro                           &#39;: 233,
 &#39;Rudge, Av/Orlando Murgel, Vd (F)        Centro/Bairro                           &#39;: 232,
 &#39;S.Vicente, Av Marques de (F)            Barra Funda/Lapa                        &#39;: 90,
 &#39;S.Vicente, Av Marques de (F)            Lapa/Barra Funda                        &#39;: 526,
 &#39;Sabará, Av NSra do                      Bairro/Centro                           &#39;: 6,
 &#39;Sabará, Av NSra do                      Centro/Bairro                           &#39;: 1,
 &#39;Salim F Maluf, Av/Tatuapé, Pt (N USAR)  Marginal/Vila Prudente                  &#39;: 1,
 &#39;Salim Farah Maluf, Av/Tatuapé, Pte      Marginal/Vila Prudente                  &#39;: 5335,
 &#39;Salim Farah Maluf, Av/Tatuapé, Pte      Vila Prudente/Marginal                  &#39;: 3669,
 &#39;Sapetuba, R                             único//                                 &#39;: 1637,
 &#39;Sebastião Camargo, Túnel                unico//                                 &#39;: 4718,
 &#39;Socorro, Pte                            Bairro/Centro                           &#39;: 1365,
 &#39;Socorro, Pte                            Centro/Bairro                           &#39;: 1640,
 &#39;Sumaré, Av                              Limão/Sumaré                            &#39;: 149,
 &#39;Sumaré, Av                              Sumaré/Limão                            &#39;: 255,
 &#39;Susana Rodrigues, R                     unico//                                 &#39;: 444,
 &#39;São Vicente, Av Marq de                 Barra Funda/Lapa                        &#39;: 856,
 &#39;São Vicente, Av Marq de                 Lapa/Barra Funda                        &#39;: 1933,
 &#39;Sé, Pça da                              //unico                                 &#39;: 205,
 &#39;Tabapua,R  (F)                          unico//                                 &#39;: 196,
 &#39;Tabapuã, R                              //unico                                 &#39;: 39,
 &#39;Tabapuã, R                              único//                                 &#39;: 482,
 &#39;Tajurás, Av dos                         Bairro/Centro                           &#39;: 2201,
 &#39;Tajurás, Av dos                         Centro/Bairro                           &#39;: 297,
 &#39;Tancredo Neves, Av                      Anchieta/Imigrantes                     &#39;: 395,
 &#39;Tancredo Neves, Av                      Imigrantes/Anchieta                     &#39;: 336,
 &#39;Teodoro Sampaio, R                      unico//                                 &#39;: 1651,
 &#39;Teotonio Vilela, Av Sen                 Bairro/Centro                           &#39;: 41,
 &#39;Teotonio Vilela, Av Sen                 Centro/Bairro                           &#39;: 7,
 &#39;Transamérica, Pte                       unico//                                 &#39;: 1208,
 &#39;Trib de Justiça, Túnel                  Ibirapuera/Marginal                     &#39;: 6386,
 &#39;Trib de Justiça, Túnel                  Marginal/Ibirapuera                     &#39;: 3397,
 &#39;Trinta e Um de Março, Vd                unico//                                 &#39;: 1540,
 &#39;Vale/P.Maia/Tirad/S.Dumont              Aeroporto/Santana                       &#39;: 5988,
 &#39;Vale/P.Maia/Tirad/S.Dumont              Santana/Aeroporto                       &#39;: 9089,
 &#39;Vale/P.Maia/Tirad/S.Dumont  (NÃO USAR)  Santana/Aeroporto                       &#39;: 1,
 &#39;Valerio, Av São                         Bairro/Centro                           &#39;: 1471,
 &#39;Valerio, Av São                         Centro/Bairro                           &#39;: 24,
 &#39;Vicente Rao, Av Prof                    Diadema/Marginal                        &#39;: 362,
 &#39;Vicente Rao, Av Prof                    Marginal/Diadema                        &#39;: 245,
 &#39;Vicente Rao, Av Prof  (F)               Diadema/Marginal                        &#39;: 5,
 &#39;Vicente Rao, Av Prof  (F)               Marginal/Diadema                        &#39;: 2,
 &#39;Vila Guilherme, Pte                     Bairro/Centro                           &#39;: 211,
 &#39;Vila Guilherme, Pte                     Centro/Bairro                           &#39;: 92,
 &#39;Vila Matilde, Vd                        Penha/Vl Matilde                        &#39;: 19,
 &#39;Vila Matilde, Vd                        Vl Matilde/Penha                        &#39;: 32,
 &#39;Vinte Três/R Berta/M Guim (NÃO USAR)    Aeroporto/Santana                       &#39;: 2,
 &#39;Vinte Três/R Berta/M Guimarães          Aeroporto/Santana                       &#39;: 9678,
 &#39;Vinte Três/R Berta/M Guimarães          Santana/Aeroporto                       &#39;: 10112,
 &#39;Vinte e Cinco de Março, Vd              único//                                 &#39;: 140,
 &#39;Vital Brasil, Av                        Bairro/Centro                           &#39;: 2983,
 &#39;Vital Brasil, Av                        Centro/Bairro                           &#39;: 459,
 &#39;Vitor Manzini, Av                       Bairro/Centro                           &#39;: 199,
 &#39;Vitor Manzini, Av                       Centro/Bairro                           &#39;: 806,
 &#39;Washington Luis, Av                     Bairro/Centro                           &#39;: 3511,
 &#39;Washington Luis, Av                     Centro/Bairro                           &#39;: 2900,
 &#39;XXX                                     Campo Limpo/Morato                      &#39;: 7,
 &#39;XXX                                     Morato/Campo Limpo                      &#39;: 5,
 &#39;Xangai, Vd                              unico//                                 &#39;: 84}
</pre></div></div>
</div>
<p><strong>jam_count</strong> is the dictionary listing all counts of traffic jams for each road.</p>
<p>The following graph plots the distribution of traffic jam counts between 2001 and 2019 for each and every road. It might seem more adapted to focus our renovations on the roads more likely to be impacted by traffic jams, and for that we may drop the roads with a small jam count.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorted_jam_count</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">jam_count</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">jam_count</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">jam_count</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;road n°&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;number of traffic jams between 2001 and 2019&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of traffic jams between 2001 and 2019 for each road in increasing order&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_20_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_20_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_jam_count</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">jam_count</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_jam_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_jam_count</span><span class="p">)):</span>
    <span class="n">cdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_jam_count</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">cdf</span> <span class="o">=</span> <span class="n">cdf</span> <span class="o">/</span> <span class="n">cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cdf</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;road n°&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cumulative distribution function of traffic jams in SP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_22_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_22_0.png" />
</div>
</div>
<p>The 180 most congestioned roads make up for 90% of all traffic jams in Sao Paulo between 2001 and 2019. That is where we will focus our renovation efforts.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roads_to_renovate</span> <span class="o">=</span> <span class="n">sorted_jam_count</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</section>
<section id="3.-Mathematical-modeling">
<h1>3. Mathematical modeling<a class="headerlink" href="#3.-Mathematical-modeling" title="Permalink to this heading">#</a></h1>
<p>In the following 2 sections, we establish a precise framework, listing the hypotheses and simplifications supporting our model. In particular: - 3.1. gives an introduction to the Gamma manifold and explains how each road can be represented by a point on it. - 3.2. justifies the use of information geometry to tackle the problem at hand, by seeing a renovation effort on a given road as a tangent vector based at its associated point.</p>
<p>The modeling of the study relies heavily on the representation of a traffic jam as a random variable. In fact, the waiting time in a given traffic jam can be predicted by a Gamma distribution.</p>
<section id="3.1.1.-Hypotheses">
<h2>3.1.1. Hypotheses<a class="headerlink" href="#3.1.1.-Hypotheses" title="Permalink to this heading">#</a></h2>
<p>We consider that a traffic jam has a fixed exit rate, meaning that on average, in a given unit of time the same count of cars will exit the jam. The waiting time to exit the traffic jam once a car is ahead of the lane is independent of other cars and depends on the road only.</p>
<p>In addition, switching lanes rarely helps, and if so, to a negligible extent; furthermore a car entering the traffic jam will almost always choose the least crowded lane (all drivers are a priori mentally sane). These two observations allow to reduce the modeling of a whole traffic jam to that of a single lane, although only in representation, because cars next to each other will have the same behavior. This means that in our modelling the width of the road is not taken into account, as
mentioned in the introduction.</p>
<p>Both of these hypotheses are central to the model.</p>
</section>
<section id="3.1.2.-Model">
<h2>3.1.2. Model<a class="headerlink" href="#3.1.2.-Model" title="Permalink to this heading">#</a></h2>
<p>In a traffic jam, you wait until every car in front of you has exited the traffic jam, meaning that the waiting time for a car entering the jam is merely the sum of the exit times of all the cars in front.</p>
<p>As a <span class="math notranslate nohighlight">\(\nu\)</span>-exponential process predicts the waiting time until one very first event (where <span class="math notranslate nohighlight">\(\nu\)</span> is a rate of a unit of time), a <span class="math notranslate nohighlight">\((k,\, \nu)\)</span>-Gamma process will predict the waiting time until the <span class="math notranslate nohighlight">\(k\)</span>-th event: mathematically, it is the sum of <span class="math notranslate nohighlight">\(k\)</span> i.i.d. <span class="math notranslate nohighlight">\(\nu\)</span>-exponential processes. In the context of congestion time in a traffic jam, we are summing exit times, hence the connection between waiting time and Gamma disribution.</p>
<p>Therefore, the congestion time of the jam follows a Gamma distribution associated to the road. Its parameters are: - <span class="math notranslate nohighlight">\(k\)</span>, the length of the car lane (jam size) in arbitrary units; - <span class="math notranslate nohighlight">\(\nu\)</span>, the exit time rate of the traffic jam, i.e. the number of cars (in the same arbitrary unit) that exit the traffic jam in a given amount of time, so essentially the speed of the traffic jam.</p>
<p>By arbitrary units we mean that there exists a number <span class="math notranslate nohighlight">\(n\)</span> of cars, common to every road, such that <span class="math notranslate nohighlight">\(n\)</span> cars will exit the jam every <span class="math notranslate nohighlight">\(\frac{1}{\nu}\)</span> (depending on the road) unit of time on average. From this we draw that a road with car length <span class="math notranslate nohighlight">\(k\)</span> is in fact as long as <span class="math notranslate nohighlight">\(kn\)</span> cars.</p>
<p>For a given road <span class="math notranslate nohighlight">\(r\)</span>, we note <span class="math notranslate nohighlight">\(T_r\)</span> the congestion time that cars will have to wait in the case the traffic is jammed: <span class="math notranslate nohighlight">\(T_r \rightsquigarrow G(k_r, \nu_r)\)</span>, with distribution:</p>
<div class="math notranslate nohighlight">
\[\forall t&gt;0, \, \mathbb{f}(t) = \frac{\nu_r^{k_r}}{\Gamma(k_r)} t^{k_r-1} e^{-\nu_r t}.\]</div>
<center><p><img alt="7d4493438eba49cdbe0013989b72e70d" class="no-scaled-link" src="../_images/car_lane.png" style="width: 600px;" /></p>
</center><p>As a road <span class="math notranslate nohighlight">\(x_r\)</span> can be represented by two parameters <span class="math notranslate nohighlight">\(k_r\)</span> and <span class="math notranslate nohighlight">\(\nu_r\)</span>, we can consider our space of study to be the space of such parameters (i.e. <span class="math notranslate nohighlight">\(\mathbb{(R_+^*)^2}\)</span>).</p>
<p>For the following, we denote Gamma distributions’ parameters by <span class="math notranslate nohighlight">\((\kappa_r, \gamma_r)\)</span>, where <span class="math notranslate nohighlight">\(\kappa_r\)</span>=<span class="math notranslate nohighlight">\(k_r\)</span> (expected jam size) and <span class="math notranslate nohighlight">\(\gamma_r\)</span>=<span class="math notranslate nohighlight">\(\frac{k_r}{\nu_r}\)</span> is the expected congestion time (mean of the Gamma distribution). The space of study is still <span class="math notranslate nohighlight">\(\mathbb{(R_+^*)^2}\)</span>, and we are instantiating it in the next cell.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">geomstats.information_geometry.gamma</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">space</span> <span class="o">=</span> <span class="n">GammaDistributions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>For instance, on the following graph we are representing 3 roads.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">road1</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">road2</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">road3</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">kappa$ (expected jam size)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma$ (expected time spent in traffic)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;3 roads subject to traffic jams, represented as points on the Gamma manifold.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_37_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_37_0.png" />
</div>
</div>
<p>Here: - road 1 is <span class="math notranslate nohighlight">\((\kappa_1=1,\gamma_1=1)\)</span>; - road 2 is <span class="math notranslate nohighlight">\((\kappa_2=2,\gamma_2=1)\)</span>; - road 3 is <span class="math notranslate nohighlight">\((\kappa_3=1,\gamma_3=2)\)</span>.</p>
<p>This means that cars on road 1 will spend half as much time as cars on road 3 in the case of a traffic jam, on average. On the other hand, cars on road 1 and road 2 will spend the same time in traffic on average, but the line is twice as long on road 2.</p>
<section id="3.2.-Mathematical-representation-of-renovation-efforts">
<h3>3.2. Mathematical representation of renovation efforts<a class="headerlink" href="#3.2.-Mathematical-representation-of-renovation-efforts" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="3.2.1.-Hypotheses">
<h2>3.2.1. Hypotheses<a class="headerlink" href="#3.2.1.-Hypotheses" title="Permalink to this heading">#</a></h2>
<p>Renovating a road initially aims at reducing the expected time spent in traffic. This means that for a given road <span class="math notranslate nohighlight">\(x_r = (\kappa_r, \gamma_r)\)</span>, we want to reduce <span class="math notranslate nohighlight">\(\gamma_r\)</span> as efficiently as possible. But, the efficiency of the renovation in that regard heavily depends on the road: one can argue that it is more efficient to renovate a road where traffic jams are frequent than a road on which the traffic is almost fluid. This is where information geometry comes in handy: as a
riemannian manifold, the metric of the Gamma manifold is point-dependent.</p>
<p>By seeing renovation as an effort in reducing the expected time in traffic, we can model the advancement of the renovation as the geodesic departing from the point representation of the road, and with initial tangent vector in the direction and orientation <span class="math notranslate nohighlight">\(-\gamma\)</span>. This reflects the fact that the advancement of the renovation will follow the most natural path, i.e. the distribution of the waiting time of the associated road will change as little as possible throughout the renovation.</p>
</section>
<section id="3.2.2.-Model">
<h2>3.2.2. Model<a class="headerlink" href="#3.2.2.-Model" title="Permalink to this heading">#</a></h2>
<p>We decide to model a renovation effort of budget/effort <span class="math notranslate nohighlight">\(r_i\)</span> on road <span class="math notranslate nohighlight">\(x_r\)</span> as the tangent vector <span class="math notranslate nohighlight">\(r_i \left(\begin{array}{c} 0 \\ -1 \end{array}\right)_{x_r}\)</span>, where <span class="math notranslate nohighlight">\(\left(\begin{array}{c} 0 \\ -1 \end{array}\right)_{x}\)</span> is the unit tangent vector at <span class="math notranslate nohighlight">\(x\)</span> with direction and orientation <span class="math notranslate nohighlight">\(-\gamma\)</span>. The amount of effort/resources invested in the renovation of a given road is directly represented by the norm of the tangent vector.</p>
<p>Investing as much as <span class="math notranslate nohighlight">\(r_i\)</span> renovation resources on road <span class="math notranslate nohighlight">\(x_r\)</span> will result in having the renovated road <span class="math notranslate nohighlight">\(x_r' = \exp_{x_r} \left( r_i \times \left(\begin{array}{c} 0 \\ -1 \end{array}\right)_{x_r} \right)\)</span>, where <span class="math notranslate nohighlight">\(\exp_{x}\)</span> is the exponential map at <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>The following plot shows a comparison of similar renovations undertaken on the roads in the previous example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 3&#39;</span><span class="p">)</span>

<span class="n">effort</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>

<span class="n">effort1</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">effort</span><span class="p">,</span> <span class="n">road1</span><span class="p">)</span>
<span class="n">renovation1</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">initial_point</span><span class="o">=</span><span class="n">road1</span><span class="p">,</span> <span class="n">initial_tangent_vec</span><span class="o">=</span><span class="n">effort1</span><span class="p">)</span>
<span class="n">renovation1</span> <span class="o">=</span> <span class="n">renovation1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation1</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 1&#39;</span><span class="p">)</span>

<span class="n">effort2</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">effort</span><span class="p">,</span> <span class="n">road2</span><span class="p">)</span>
<span class="n">renovation2</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">initial_point</span><span class="o">=</span><span class="n">road2</span><span class="p">,</span> <span class="n">initial_tangent_vec</span><span class="o">=</span><span class="n">effort2</span><span class="p">)</span>
<span class="n">renovation2</span> <span class="o">=</span> <span class="n">renovation2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation2</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 2&#39;</span><span class="p">)</span>

<span class="n">effort3</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">effort</span><span class="p">,</span> <span class="n">road3</span><span class="p">)</span>
<span class="n">renovation3</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">initial_point</span><span class="o">=</span><span class="n">road3</span><span class="p">,</span> <span class="n">initial_tangent_vec</span><span class="o">=</span><span class="n">effort3</span><span class="p">)</span>
<span class="n">renovation3</span> <span class="o">=</span> <span class="n">renovation3</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation3</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 3&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">kappa$ (expected jam size)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma$ (expected time spent in traffic)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of different renovation efforts&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Road 1 renovation: expected waiting time has decreased from </span><span class="si">{</span><span class="n">road1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">, expected jam size has increased from </span><span class="si">{</span><span class="n">road1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Road 2 renovation: expected waiting time has decreased from </span><span class="si">{</span><span class="n">road2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">, expected jam size has increased from </span><span class="si">{</span><span class="n">road2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Road 3 renovation: expected waiting time has decreased from </span><span class="si">{</span><span class="n">road3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">, expected jam size has increased from </span><span class="si">{</span><span class="n">road3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">renovation3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_45_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_45_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Road 1 renovation: expected waiting time has decreased from 1.0 to 0.409, expected jam size has increased from 1.0 to 1.443.
Road 2 renovation: expected waiting time has decreased from 1.0 to 0.536, expected jam size has increased from 2.0 to 2.995.
Road 3 renovation: expected waiting time has decreased from 2.0 to 0.818, expected jam size has increased from 1.0 to 1.443.
</pre></div></div>
</div>
<p>We observe that it is much more efficient to renovate road 3 rather than road 1 in terms of gained expected waiting time. This was expected given road 1 is much more fluid than road 3. In terms of relative time gain however, the result is the same: this is specific to Gamma distributions. In addition, renovating road 3 is more efficient than renovating road 2, either in absolute or relative time gain. We observe furthermore that investing similar efforts in renovating roads 3 and 2 result in
different evolutions regarding the expected jam size: it increases by 44% in the first case and by as much as 50% in the second one. This becomes delicate especially considering the expected car line on road 2 was already long.</p>
<p>We notice that renovations increase the expected jam size: this can be interpreted as the fact that a renovated roads allows drivers to go faster and the lane becomes longer, in a sense the traffic becomes more diluted. This can be observed in the following plot: renovations increase at once the expected jam size and the expected exit time rate, rendering the road open to much more traffic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">road1</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">natural_to_standard</span><span class="p">(</span><span class="n">road1</span><span class="p">)</span>
<span class="n">road2</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">natural_to_standard</span><span class="p">(</span><span class="n">road2</span><span class="p">)</span>
<span class="n">road3</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">natural_to_standard</span><span class="p">(</span><span class="n">road3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">road3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;road 3&#39;</span><span class="p">)</span>

<span class="n">renovation1</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">standard_to_natural</span><span class="p">(</span><span class="n">renovation1</span><span class="p">)</span>
<span class="n">renovation2</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">standard_to_natural</span><span class="p">(</span><span class="n">renovation2</span><span class="p">)</span>
<span class="n">renovation3</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">standard_to_natural</span><span class="p">(</span><span class="n">renovation3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation1</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation2</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">renovation3</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;advancement of renovation effort on road 3&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">kappa$ (expected jam size)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">nu$ (expected exit time rate in traffic)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of different renovation efforts in natural coordinates&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_47_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_47_0.png" />
</div>
</div>
<p>The fact that these results validate our observations and expected consequences of renovations legitimates the use of information geometry to model the situation. For instance, a euclidean modeling of the situation would make no sense: all renovations would have the same impact although applied to different roads, because the norm of a tangent vector (i.e. the renovation effort) would be independent of its base point (the road).</p>
<p>Therefore, the key to optimizing Sao Paulo’s traffic obviously lies in maximizing the efficiency of the renovation, with limited renovation resources.</p>
<section id="3.3.-Optimization-problem">
<h3>3.3. Optimization problem<a class="headerlink" href="#3.3.-Optimization-problem" title="Permalink to this heading">#</a></h3>
<p>The aim is to minimize the mean expected congestion time in Sao Paulo, weighted by the frequencies <span class="math notranslate nohighlight">\(f_i\)</span> of traffic jams <span class="math notranslate nohighlight">\(1 \leq i \leq n\)</span>, under the constraint of a total quantity of resources <span class="math notranslate nohighlight">\(r\)</span>. This reads:</p>
<p><span class="math">\begin{equation}
\begin{cases}
\min_{(r_i)}  \sum_{i=1}^n f_i \times \exp_{x_i} \left( r_i \times \left(\begin{array}{c} 0 \\ -1 \end{array}\right)_{x_i} \right)_{\gamma} \\
\forall i \in \{1,...,n\}, r_i \geq 0 \\
\sum_{1 \leq i \leq n} r_i = r \\
\end{cases},
\end{equation}</span></p>
<p>where: - <span class="math notranslate nohighlight">\((x_i)\)</span> are the roads; - <span class="math notranslate nohighlight">\(\left(\begin{array}{c} 0 \\ -1 \end{array}\right)_{x_i}\)</span> is the unit tangent vector at <span class="math notranslate nohighlight">\(x_i\)</span> with direction and orientation <span class="math notranslate nohighlight">\(-\gamma\)</span>; - <span class="math notranslate nohighlight">\(\exp_{x_i}\)</span> is the exponential map at <span class="math notranslate nohighlight">\(x_i\)</span>; - for <span class="math notranslate nohighlight">\(x \in G\)</span> (the Gamma manifold), <span class="math notranslate nohighlight">\(x_{\gamma}\)</span> is its <span class="math notranslate nohighlight">\(\gamma\)</span> coordinate; - <span class="math notranslate nohighlight">\(r_i\)</span> is the resource allocated for renovating road <span class="math notranslate nohighlight">\(i\)</span>.</p>
<section id="Remark">
<h4>Remark<a class="headerlink" href="#Remark" title="Permalink to this heading">#</a></h4>
<p>We could rewrite the problem in a simpler way analytically, making use of the following results: - the relative efficiency of renovation (i.e. the ratio of expected congestion times) does not depend on the original expected congestion time of the road (<span class="math notranslate nohighlight">\(\gamma\)</span>); - similarly, the length of the car lane of the renovated road does not depend on the original expected congestion time of the road (<span class="math notranslate nohighlight">\(\gamma\)</span>).</p>
<p>However, we will not use these results to make way for a better computational solution of the problem.</p>
</section>
</section>
</section>
</section>
<section id="4.-Dataset-processing">
<h1>4. Dataset processing<a class="headerlink" href="#4.-Dataset-processing" title="Permalink to this heading">#</a></h1>
<p>First, we associate to each of the roads eligible for renovation its parameters for a Gamma distribution, through a maximum likelihood fit of the durations of traffic jams: <strong>jam_table</strong> gives, for each road <span class="math notranslate nohighlight">\(r\)</span>, a sample of size <span class="math notranslate nohighlight">\(n_r\)</span> of all the traffic jams and their durations from 2001 to 2019.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span><span class="p">,</span> <span class="n">kappas</span><span class="p">,</span> <span class="n">gammas</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">road</span> <span class="ow">in</span> <span class="n">roads_to_renovate</span><span class="p">:</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">road</span><span class="p">]</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">kappa</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">maximum_likelihood_fit</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">([</span><span class="n">kappa</span><span class="p">,</span> <span class="n">gamma</span><span class="p">]))):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">road</span><span class="p">)</span>
            <span class="n">kappas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
            <span class="n">gammas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
</pre></div>
</div>
</div>
<p>Having focused on the 180 most congestioned roads makes sense now, as the estimations for the Gamma parameters of the roads are much more relevant. Accounting for all the roads would result in having outliers in our set of roads, rendering the computation far more complex. In addition, roads with a negligible count of traffic jams in such a long time span do not necessarily call for renovation.</p>
<p>That is why, for the following and for the problem at hand, we can consider the following simplification: the roads eligible for renovation represent SP’s roads subject to traffic jams, i.e. the exact dataset we want to be working on.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">:</span> <span class="n">kappas</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gammas</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dict_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To each of the roads eligible for renovation we associate a weight proportional to the number of traffic jams between 2001 and 2019.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">good_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
<span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">jam_count</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">good_points</span><span class="p">))</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">/</span> <span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The 180 most congestioned roads of SP can be represented as follows on the Gamma manifold.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;kappa&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="n">kappa</span><span class="p">),</span> <span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="n">gamma</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;road eligible for renovation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">mean</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean road eligible for renovation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">kappa$ (number of cars in arbitrary units)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma$ (expected time spent in traffic in hours)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sao Paulo&#39;s roads most subject to traffic jams, as represented as points on the Gamma manifold.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_63_0.png" src="../_images/notebooks_18_real_world_applications__sao_paulo_traffic_optimization_63_0.png" />
</div>
</div>
<p>We observe that the vast majority of traffic jams in SP can take from 2 to 6+ hours of congestion time. On the most impactful roads (eligible for renovation), the mean waiting time is 3h 24min.</p>
</section>
<section id="5.-Solving-the-problem-at-hand">
<h1>5. Solving the problem at hand<a class="headerlink" href="#5.-Solving-the-problem-at-hand" title="Permalink to this heading">#</a></h1>
<p>Arbitrarily (and for computational purposes), we are allocated a total of 10 resources to allocate on the renovations. It might seem like the amount of total resources should not matter that much as the original aim is simply knowing how to allocate the total quantity of resources between all the roads eligible for renovation, but renovations are not linear.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_resources</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">kappa</span><span class="p">,</span> <span class="n">gamma</span><span class="p">]))</span>
<span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We optimize the allocation of resources for renovation here:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_SP</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...,...j-&gt;...j&quot;</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rebuilding</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">resources</span><span class="p">):</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">])],</span> <span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">resources</span> <span class="o">*</span> <span class="n">total_resources</span>
    <span class="n">tangent_vec</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...,...j-&gt;...j&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
    <span class="n">end_point</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">tangent_vec</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">end_point</span>

<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">resources</span><span class="p">):</span>
    <span class="n">end_points</span> <span class="o">=</span> <span class="n">rebuilding</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">resources</span><span class="p">)</span>
    <span class="n">gammas</span> <span class="o">=</span> <span class="n">end_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">gs</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="n">gammas</span><span class="p">)</span>

<span class="n">objective_with_grad</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">autodiff</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">resources</span> <span class="o">=</span> <span class="n">total_resources</span> <span class="o">*</span> <span class="n">weights</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">objective_with_grad</span><span class="p">,</span>
    <span class="n">resources</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;SLSQP&quot;</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">total_resources</span> <span class="o">-</span> <span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()},</span>
    <span class="p">),</span>
    <span class="n">jac</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="n">tol</span><span class="o">=</span><span class="n">gs</span><span class="o">.</span><span class="n">atol</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">resources</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

<span class="n">new_points</span> <span class="o">=</span> <span class="n">rebuilding</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">resources</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;original points&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">original_SP</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;original SP&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">new_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;points after renovation&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">new_points</span> <span class="o">-</span> <span class="n">points</span><span class="p">)[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">new_points</span> <span class="o">-</span> <span class="n">points</span><span class="p">)[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">length_includes_head</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentage</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">total_resources</span>
    <span class="k">if</span> <span class="n">percentage</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">percentage</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

<span class="n">new_SP</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;...,...j-&gt;...j&quot;</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">new_points</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">new_SP</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;SP after renovation&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="o">*</span><span class="n">original_SP</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">new_SP</span> <span class="o">-</span> <span class="n">original_SP</span><span class="p">),</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">length_includes_head</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">kappa$ (expected jam size)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma$ (expected time spent in traffic in hours)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Optimization of SP&#39;s traffic&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">c:\Users\Jules\Documents\Geomstats\notebooks\18_real_world_applications__sao_paulo_traffic_optimization.ipynb Cell 71&#39;</span> in <span class="ansi-cyan-fg">&lt;cell line: 16&gt;</span><span class="ansi-blue-intense-fg ansi-bold">()</span>
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=12&#39;&gt;13&lt;/a&gt;</span>     gammas = end_points[:,1]
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=13&#39;&gt;14&lt;/a&gt;</span>     return gs.mean(weights*gammas)
<span class="ansi-green-intense-fg ansi-bold">---&gt; &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=15&#39;&gt;16&lt;/a&gt;</span> objective_with_grad = gs.autodiff.value_and_grad(objective, to_numpy=True)
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=17&#39;&gt;18&lt;/a&gt;</span> resources = total_resources * weights
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=19&#39;&gt;20&lt;/a&gt;</span> res = minimize(
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=20&#39;&gt;21&lt;/a&gt;</span>     objective_with_grad,
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=21&#39;&gt;22&lt;/a&gt;</span>     resources,
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=28&#39;&gt;29&lt;/a&gt;</span>     tol=gs.atol,
<span class="ansi-green-fg">     &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/Jules/Documents/Geomstats/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb#ch0000070?line=29&#39;&gt;30&lt;/a&gt;</span> )

File <span class="ansi-green-intense-fg ansi-bold">~\Documents\geomstats\geomstats\_backend\numpy\autodiff.py:23</span>, in <span class="ansi-cyan-fg">value_and_grad</span><span class="ansi-blue-intense-fg ansi-bold">(*args, **kwargs)</span>
<span class="ansi-green-fg">     21</span> def value_and_grad(*args, **kwargs):
<span class="ansi-green-fg">     22</span>     &#34;&#34;&#34;Return an error when using automatic differentiation with numpy.&#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">---&gt; 23</span>     raise RuntimeError(
<span class="ansi-green-fg">     24</span>         &#34;Automatic differentiation is not supported with numpy backend. &#34;
<span class="ansi-green-fg">     25</span>         &#34;Use autograd, pytorch or tensorflow backend instead.\n&#34;
<span class="ansi-green-fg">     26</span>         &#34;Change backend via the command &#34;
<span class="ansi-green-fg">     27</span>         &#34;export GEOMSTATS_BACKEND=autograd in a terminal.&#34;
<span class="ansi-green-fg">     28</span>     )

<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>: Automatic differentiation is not supported with numpy backend. Use autograd, pytorch or tensorflow backend instead.
Change backend via the command export GEOMSTATS_BACKEND=autograd in a terminal.
</pre></div></div>
</div>
<p>Above, the percentages represent the proportion of the total resources that have been allocated to the renovation of each road: they are visible if greater than 1%.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_size</span><span class="p">,</span> <span class="n">original_time</span> <span class="o">=</span> <span class="n">original_SP</span>
<span class="n">new_size</span><span class="p">,</span> <span class="n">new_time</span> <span class="o">=</span> <span class="n">new_SP</span>

<span class="n">relative_time_reduction</span> <span class="o">=</span> <span class="p">(</span><span class="n">original_time</span> <span class="o">-</span> <span class="n">new_time</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_time</span>

<span class="n">original_variance</span><span class="p">,</span> <span class="n">new_variance</span> <span class="o">=</span> <span class="n">original_time</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">original_size</span><span class="p">,</span> <span class="n">new_time</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">new_size</span>
<span class="n">relative_variance_reduction</span> <span class="o">=</span> <span class="p">(</span><span class="n">original_variance</span> <span class="o">-</span> <span class="n">new_variance</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_variance</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean expected congestion time has been reduced by as much as </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">relative_time_reduction</span><span class="o">*</span><span class="mi">100</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2"> % in Sao Paulo :)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance in congestion time has been reduced by as much as </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">relative_variance_reduction</span><span class="o">*</span><span class="mi">100</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2"> % in Sao Paulo :)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Conclusion">
<h1>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this heading">#</a></h1>
<p>We have managed to substantially reduce the mean expected congestion time in SP by as much as 25%, not at great expense of the expected jam sizes! We also happen to have halved the variance of the mean congestion time, rendering long traffic jams rarer. This is a great success!</p>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Computing with triangular shapes in Kendall framework</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../contributing/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Contributing Guide</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Optimization of Sao Paulo traffic
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#1.-Introduction-and-Motivation">
   1. Introduction and Motivation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#2.-Dataset-description">
   2. Dataset description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#3.-Mathematical-modeling">
   3. Mathematical modeling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#3.1.1.-Hypotheses">
     3.1.1. Hypotheses
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#3.1.2.-Model">
     3.1.2. Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#3.2.-Mathematical-representation-of-renovation-efforts">
       3.2. Mathematical representation of renovation efforts
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#3.2.1.-Hypotheses">
     3.2.1. Hypotheses
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#3.2.2.-Model">
     3.2.2. Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#3.3.-Optimization-problem">
       3.3. Optimization problem
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#Remark">
         Remark
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#4.-Dataset-processing">
   4. Dataset processing
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#5.-Solving-the-problem-at-hand">
   5. Solving the problem at hand
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Conclusion">
   Conclusion
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/notebooks/18_real_world_applications__sao_paulo_traffic_optimization.ipynb.txt">
        <i class="fas fa-file-alt"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022-2023, Geomstats, Inc..<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>