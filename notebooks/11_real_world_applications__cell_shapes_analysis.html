
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Shape Analysis of Cancer Cells &#8212; Geomstats latest documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="geomstats.github.io/notebooks/11_real_world_applications__cell_shapes_analysis.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hand gesture classification with EMG data using Riemannian metrics" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html" />
    <link rel="prev" title="Shape analysis of curves with the Square Root Velocity metric" href="10_practical_methods__shape_analysis.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Geomstats latest documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../explanation/index.html">
  Explanation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing/index.html">
  Contributing Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../roadmap.html">
  Roadmap
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../governance.html">
  Governance
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gsod.html">
  Google Season of Docs
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../hackathons.html">
  Hackathons
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="03_practical_methods__data_on_manifolds.html">
   Data on Manifolds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_practical_methods__from_vector_spaces_to_manifolds.html">
   From vector spaces to manifolds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_practical_methods__simple_machine_learning_on_tangent_spaces.html">
   Learning on Tangent Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_practical_methods__riemannian_frechet_mean_and_tangent_pca.html">
   Fréchet Mean and Tangent PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_practical_methods__riemannian_kmeans.html">
   K-Means clustering on a Riemannian Manifold
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_practical_methods__information_geometry.html">
   Information geometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_practical_methods__implement_your_own_riemannian_geometry.html">
   Implement your own Riemannian Geometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_practical_methods__shape_analysis.html">
   Shape analysis of curves with the Square Root Velocity metric
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Shape Analysis of Cancer Cells
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html">
   Hand gesture classification with EMG data using Riemannian metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_real_world_applications__graph_embedding_and_clustering_in_hyperbolic_space.html">
   Hyperbolic Embedding of Graphs and Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_real_world_applications__hand_poses_analysis_in_kendall_shape_space.html">
   Classifying hands poses with Kendall shape spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_real_world_applications__optic_nerve_heads_analysis_in_kendall_shape_space.html">
   Computing with shapes of landmarks in Kendall shape spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html">
   Computing with triangular shapes in Kendall framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18_real_world_applications__sao_paulo_traffic_optimization.html">
   Optimization of Sao Paulo traffic
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Shape Analysis of Cancer Cells
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#1.-Introduction-and-Motivation">
   1. Introduction and Motivation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#2.-Dataset-Description">
   2. Dataset Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#3.-Preprocessing">
   3. Preprocessing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points">
     Interpolation: Encoding Discrete Curves With Same Number of Points
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Visualization-of-Interpolated-Dataset-of-Curves">
     Visualization of Interpolated Dataset of Curves
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Remove-duplicate-samples-in-curves">
     Remove duplicate samples in curves
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Alignment">
     Alignment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#4-Data-Analysis">
   4 Data Analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href='#Analyze-Distances-to-the-"Global"-Mean-Shape'>
   Analyze Distances to the “Global” Mean Shape
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Changing-the-Metric-on-the-Space-of-Cell-Shapes">
   Changing the Metric on the Space of Cell Shapes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Hypothesis-Testing-on-Equality-of-Means">
   Hypothesis Testing on Equality of Means
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Visualization-of-the-Mean-of-each-Treatment">
   Visualization of the Mean of each Treatment
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape">
   Distance of the Cell Shapes to their Own Mean Shape
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/notebooks/11_real_world_applications__cell_shapes_analysis.ipynb">notebooks/11_real_world_applications__cell_shapes_analysis.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=notebooks/11_real_world_applications__cell_shapes_analysis.ipynb"><img alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>
  </p>
</div><section id="Shape-Analysis-of-Cancer-Cells">
<h1>Shape Analysis of Cancer Cells<a class="headerlink" href="#Shape-Analysis-of-Cancer-Cells" title="Permalink to this heading">#</a></h1>
<p>Lead author: Nina Miolane.</p>
<p>This notebook studies <em>Osteosarcoma</em> (bone cancer) cells and the impact of drug treatment on their <em>morphological shapes</em>, by analyzing cell images obtained from fluorescence microscopy.</p>
<p>This analysis relies on the <em>elastic metric between discrete curves</em> from Geomstats. We will study to which extent this metric can detect how the cell shape is associated with the response to treatment.</p>
<p>This notebook is adapted from Florent Michel’s submission to the <a class="reference external" href="https://github.com/geomstats/challenge-iclr-2021">ICLR 2021 Computational Geometry and Topology challenge</a>.</p>
<center><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;img src=&quot;figures/cells_image.png&quot; width=600px /&gt;
</pre></div>
</div>
</center><p>Figure 1: Representative images of the cell lines using fluorescence microscopy, studied in this notebook (Image credit : Ashok Prasad). The cells nuclei (blue), the actin cytoskeleton (green) and the lipid membrane (red) of each cell are stained and colored. We only focus on the cell shape in our analysis.</p>
</section>
<section id="1.-Introduction-and-Motivation">
<h1>1. Introduction and Motivation<a class="headerlink" href="#1.-Introduction-and-Motivation" title="Permalink to this heading">#</a></h1>
<p>Biological cells adopt a variety of shapes, determined by multiple processes and biophysical forces under the control of the cell. These shapes can be studied with different quantitative measures that reflect the cellular morphology <a class="reference external" href="#References">(MGCKCKDDRTWSBCC2018)</a>. With the emergence of large-scale biological cell image data, morphological studies have many applications. For example, measures of irregularity and spreading of cells allow accurate classification and discrimination between
cancer cell lines treated with different drugs <a class="reference external" href="#References">(AXCFP2019)</a>.</p>
<p>As metrics defined on the shape space of curves, the <em>elastic metrics</em> <a class="reference external" href="#References">(SKJJ2010)</a> implemented in Geomstats are a potential tool for analyzing and comparing biological cell shapes. Their associated geodesics and geodesic distances provide a natural framework for optimally matching, deforming, and comparing cell shapes.</p>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>

<span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Using numpy backend
</pre></div></div>
</div>
</section>
</section>
<section id="2.-Dataset-Description">
<h1>2. Dataset Description<a class="headerlink" href="#2.-Dataset-Description" title="Permalink to this heading">#</a></h1>
<p>We study a dataset of mouse <em>Osteosarcoma</em> imaged cells <a class="reference external" href="#References">(AXCFP2019)</a>. The dataset contains two different cancer cell lines : <em>DLM8</em> and <em>DUNN</em>, respectively representing a more agressive and a less agressive cancer. Among these cells, some have also been treated with different single drugs that perturb the cellular cytoskeleton. Overall, we can label each cell according to their cell line (<em>DLM8</em> and <em>DUNN</em>), and also if it is a <em>control</em> cell (no treatment), or has been treated
with one of the following drugs : <em>Jasp</em> (jasplakinolide) and <em>Cytd</em> (cytochalasin D).</p>
<p>Each cell comes from a raw image containing a set of cells, which was thresholded to generate binarized images.</p>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;img src=&quot;figures/binarized_cells.png&quot; width=400px /&gt;
</pre></div>
</div>
</td><p>After binarizing the images, contouring was used to isolate each cell, and to extract their boundaries as a counter-clockwise ordered list of 2D coordinates, which corresponds to the representation of discrete curve in Geomstats. We load these discrete curves into the notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geomstats.datasets.utils</span> <span class="k">as</span> <span class="nn">data_utils</span>

<span class="n">cells</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">treatments</span> <span class="o">=</span> <span class="n">data_utils</span><span class="o">.</span><span class="n">load_cells</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of cells : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total number of cells : 650
</pre></div></div>
</div>
<p>The cells are grouped by treatment class in the dataset : - the <em>control</em> cells, - the cells treated with <em>Cytd</em>, - and the ones treated with <em>Jasp</em>.</p>
<p>Additionally, in each of these classes, there are two cell lines : - the <em>DLM8</em> cells, and - the <em>DUNN</em> ones.</p>
<p>This is shown by displaying the unique elements in the lists <code class="docutils literal notranslate"><span class="pre">treatments</span></code> and <code class="docutils literal notranslate"><span class="pre">lines</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">TREATMENTS</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)</span>
<span class="n">LINES</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LINES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;control&#39; &#39;cytd&#39; &#39;jasp&#39;]
[&#39;dlm8&#39; &#39;dunn&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_idx</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cells</span><span class="p">[</span><span class="n">cell_idx</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cells</span><span class="p">[</span><span class="n">cell_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_14_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_14_0.png" />
</div>
</div>
<p>The size of each class is displayed below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">n_cells_arr</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> :&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">to_keep</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">one_treatment</span> <span class="o">==</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="n">one_line</span> <span class="o">==</span> <span class="n">line</span>
                <span class="k">for</span> <span class="n">one_treatment</span><span class="p">,</span> <span class="n">one_line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">cell_i</span> <span class="k">for</span> <span class="n">cell_i</span><span class="p">,</span> <span class="n">to_keep_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">to_keep</span><span class="p">)</span> <span class="k">if</span> <span class="n">to_keep_i</span>
        <span class="p">]</span>
        <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">nb</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">n_cells_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nb</span>

<span class="n">n_cells_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;dlm8&quot;</span><span class="p">:</span> <span class="n">n_cells_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;dunn&quot;</span><span class="p">:</span> <span class="n">n_cells_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="n">n_cells_df</span> <span class="o">=</span> <span class="n">n_cells_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">n_cells_df</span><span class="p">)</span>
<span class="c1"># display(ds)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
control :
         114 dlm8
         204 dunn
cytd :
         82 dlm8
         93 dunn
jasp :
         62 dlm8
         95 dunn
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dlm8</th>
      <th>dunn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>control</th>
      <td>114.0</td>
      <td>204.0</td>
    </tr>
    <tr>
      <th>cytd</th>
      <td>82.0</td>
      <td>93.0</td>
    </tr>
    <tr>
      <th>jasp</th>
      <td>62.0</td>
      <td>95.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The above code also created a dictionnary <code class="docutils literal notranslate"><span class="pre">ds</span></code>, that contains the cell boundaries data sorted by <code class="docutils literal notranslate"><span class="pre">treatment</span></code> and cell <code class="docutils literal notranslate"><span class="pre">line</span></code>. To access all the cells corresponding to a given treatment and a given cell line, we use the syntax <code class="docutils literal notranslate"><span class="pre">ds[treatment][line]</span></code> as in the following code that computes the number of cells in the cytd-dlm8 class.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;cytd&quot;</span><span class="p">][</span><span class="s2">&quot;dlm8&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
82
</pre></div></div>
</div>
<p>We have organized the cell data into the dictionnary <code class="docutils literal notranslate"><span class="pre">ds</span></code>. Before proceeding to the actual data analysis, we provide an auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply_func_to_ds</span><span class="p">(</span><span class="n">input_ds</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply the input function func to the input dictionnary input_ds.</span>

<span class="sd">    This function goes through the dictionnary structure and applies</span>
<span class="sd">    func to every cell in input_ds[treatment][line].</span>

<span class="sd">    It stores the result in a dictionnary output_ds that is returned</span>
<span class="sd">    to the user.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_ds : dict</span>
<span class="sd">        Input dictionnary, with keys treatment-line.</span>
<span class="sd">    func : callable</span>
<span class="sd">        Function to be applied to the values of the dictionnary, i.e.</span>
<span class="sd">        the cells.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_ds : dict</span>
<span class="sd">        Output dictionnary, with the same keys as input_ds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_ds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
        <span class="n">output_ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
            <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">one_cell</span> <span class="ow">in</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]:</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">one_cell</span><span class="p">))</span>
            <span class="n">output_ds</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_ds</span>
</pre></div>
</div>
</div>
<p>Now we can move on to the actual data analysis, starting with a preprocessing of the cell boundaries.</p>
</section>
<section id="3.-Preprocessing">
<h1>3. Preprocessing<a class="headerlink" href="#3.-Preprocessing" title="Permalink to this heading">#</a></h1>
<section id="Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points">
<h2>Interpolation: Encoding Discrete Curves With Same Number of Points<a class="headerlink" href="#Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points" title="Permalink to this heading">#</a></h2>
<p>As we need discrete curves with the same number of sampled points to compute pairwise distances, the following interpolation is applied to each curve, after setting the number of sampling points.</p>
<p>To set up the number of sampling points, you can edit the following line in the next cell:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">nb_points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interpolate a discrete curve with nb_points from a discrete curve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    interpolation : discrete curve with nb_points points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_length</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">interpolation</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nb_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">incr</span> <span class="o">=</span> <span class="n">old_length</span> <span class="o">/</span> <span class="n">nb_points</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_points</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="n">interpolation</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">curve</span><span class="p">[(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">old_length</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">incr</span>
    <span class="k">return</span> <span class="n">interpolation</span>


<span class="n">N_SAMPLING_POINTS</span> <span class="o">=</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
<p>To illustrate the result of this interpolation, we compare for a randomly chosen cell the original curve with the correponding interpolated one (to visualize another cell, you can simply re-run the code).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_rand</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">))]</span>
<span class="n">cell_interpolation</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">cell_rand</span><span class="p">,</span> <span class="n">N_SAMPLING_POINTS</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell_rand</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cell_rand</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original curve (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cell_rand</span><span class="p">)</span><span class="si">}</span><span class="s2"> points)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell_interpolation</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cell_interpolation</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated curve (</span><span class="si">{</span><span class="n">N_SAMPLING_POINTS</span><span class="si">}</span><span class="s2"> points)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;interpolation.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_25_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_25_0.png" />
</div>
</div>
<p>As the interpolation is working as expected, we use the auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code> to apply the function <code class="docutils literal notranslate"><span class="pre">func=interpolate</span></code> to the dataset <code class="docutils literal notranslate"><span class="pre">ds</span></code>, i.e. the dictionnary containing the cells boundaries.</p>
<p>We obtain a new dictionnary, <code class="docutils literal notranslate"><span class="pre">ds_interp</span></code>, with the interpolated cell boundaries.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_interp</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span>
    <span class="n">input_ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N_SAMPLING_POINTS</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>For each key treatment-control, we check that the number of sampling points is the one expected, i.e. <code class="docutils literal notranslate"><span class="pre">N_SAMPLING_POINTS</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ds_interp</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(204, 200, 2)
</pre></div></div>
</div>
<p>The shape of an array of cells in <code class="docutils literal notranslate"><span class="pre">ds_interp[treatment][cell]</span></code> is therefore: <code class="docutils literal notranslate"><span class="pre">(&quot;number</span> <span class="pre">of</span> <span class="pre">cells</span> <span class="pre">in</span> <span class="pre">treatment-line&quot;,</span> <span class="pre">&quot;number</span> <span class="pre">of</span> <span class="pre">sampling</span> <span class="pre">points&quot;,</span> <span class="pre">2)</span></code>, where 2 refers to the fact that we are considering cell shapes in 2D.</p>
</section>
<section id="Visualization-of-Interpolated-Dataset-of-Curves">
<h2>Visualization of Interpolated Dataset of Curves<a class="headerlink" href="#Visualization-of-Interpolated-Dataset-of-Curves" title="Permalink to this heading">#</a></h2>
<p>We visualize the curves obtained, for a sample of control cells and treated cells (top row shows control, i.e. non-treated cells; bottom rows shows treated cells) across cell lines (left and blue for dlm8 and right and orange for dunn).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cells_to_plot</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">cell_data</span> <span class="o">=</span> <span class="n">ds_interp</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i_to_plot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cells_to_plot</span><span class="p">):</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_cells_to_plot</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;dunn&quot;</span><span class="p">))))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i_to_plot</span> <span class="o">==</span> <span class="n">n_cells_to_plot</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2">   -   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cancer_cell_sample.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_33_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_33_0.png" />
</div>
</div>
<p>Visual inspection of these curves seems to indicate more protusions appearing in treated cells, compared with control ones. This is in agreement with the physiological impact of the drugs, which are known to perturb the internal cytoskeleton connected to the cell membrane. Using the elastic metric, our goal will be to see if we can quantitatively confirm these differences.</p>
</section>
<section id="Remove-duplicate-samples-in-curves">
<h2>Remove duplicate samples in curves<a class="headerlink" href="#Remove-duplicate-samples-in-curves" title="Permalink to this heading">#</a></h2>
<p>During interpolation it is likely that some of the discrete curves in the dataset are downsampled from higher number of discrete data points to lower number of data points. Hence, two sampled data points that are close enough may end up overlapping after interpolation and hence such data points have to be dealt with specifically.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Preprocess curve to ensure that there are no consecutive duplicate points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    curve : discrete curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dist</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dist_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">dist_norm</span> <span class="o">&lt;</span> <span class="n">tol</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="n">curve</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">curve</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">curve</span>
</pre></div>
</div>
</div>
</section>
<section id="Alignment">
<h2>Alignment<a class="headerlink" href="#Alignment" title="Permalink to this heading">#</a></h2>
<p>Our goal is to study the cell boundaries in our dataset, as points in a shape space of closed curves quotiented by translation, scaling, and rotation, so these transformations do not affect our measure of distance between curves.</p>
<p>In practice, we apply functions that were initially designed to center (substract the barycenter), rescale (divide by the Frobenius norm) and then align (find the rotation minimizing the L² distance) two sets of landmarks. These operations will be performed by leveraging the geometry of the so-called Kendall preshape spaces and specifically its method <code class="docutils literal notranslate"><span class="pre">PRESHAPE_SPACE.projection</span></code>, as shown below. Details on Kendall shape spaces can be found in the <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/geomstats/geometry/pre_shape.py">module implementing
them</a> or the notebooks using them.</p>
<p>Additionally, since we are working with closed curves, the starting point associated with the parametrization of the discrete curves is also arbitrary. Thus, we conduct an exhaustive search to find which parametrization produces the best alignment according to the above procedure (i.e. the distance to the base curve is the smallest). This exhaustive search is implemented in the function <code class="docutils literal notranslate"><span class="pre">exhaustive_align</span></code> below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.geometry.pre_shape</span> <span class="kn">import</span> <span class="n">PreShapeSpace</span>

<span class="n">M_AMBIENT</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">PRESHAPE_SPACE</span> <span class="o">=</span> <span class="n">PreShapeSpace</span><span class="p">(</span><span class="n">m_ambient</span><span class="o">=</span><span class="n">M_AMBIENT</span><span class="p">,</span> <span class="n">k_landmarks</span><span class="o">=</span><span class="n">N_SAMPLING_POINTS</span><span class="p">)</span>
<span class="n">PRESHAPE_METRIC</span> <span class="o">=</span> <span class="n">PRESHAPE_SPACE</span><span class="o">.</span><span class="n">embedding_metric</span>


<span class="k">def</span> <span class="nf">exhaustive_align</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">base_curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Align curve to base_curve to minimize the L² distance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    aligned_curve : discrete curve</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nb_sampling</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb_sampling</span><span class="p">)</span>
    <span class="n">base_curve</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_curve</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_sampling</span><span class="p">):</span>
        <span class="n">reparametrized</span> <span class="o">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">%</span> <span class="n">nb_sampling</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_sampling</span><span class="p">)]</span>
        <span class="n">aligned</span> <span class="o">=</span> <span class="n">PRESHAPE_SPACE</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reparametrized</span><span class="p">),</span> <span class="n">base_point</span><span class="o">=</span><span class="n">base_curve</span><span class="p">)</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">PRESHAPE_METRIC</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aligned</span><span class="p">)</span> <span class="o">-</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_curve</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">shift_min</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">reparametrized_min</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">curve</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">shift_min</span><span class="p">)</span> <span class="o">%</span> <span class="n">nb_sampling</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_sampling</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">aligned_curve</span> <span class="o">=</span> <span class="n">PRESHAPE_SPACE</span><span class="o">.</span><span class="n">align</span><span class="p">(</span>
        <span class="n">point</span><span class="o">=</span><span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reparametrized_min</span><span class="p">),</span> <span class="n">base_point</span><span class="o">=</span><span class="n">base_curve</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">aligned_curve</span>
</pre></div>
</div>
</div>
<p>We perform the pre-shape projection and the exhaustive alignment of the cells against the base curve, which is chosen to be the first cell curve of the dataset, called <code class="docutils literal notranslate"><span class="pre">BASE_CURVE</span></code>.</p>
<p>Both the projection and the alignment make use of our auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code>, which finally outputs a dataset of cell curves organized within a dictionnary called <code class="docutils literal notranslate"><span class="pre">ds_align</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_proc</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span><span class="n">ds_interp</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">ds_proj</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span><span class="n">ds_proc</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">PRESHAPE_SPACE</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_proj</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">BASE_CURVE</span> <span class="o">=</span> <span class="n">ds_proj</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of BASE_CURVE:&quot;</span><span class="p">,</span> <span class="n">BASE_CURVE</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">ds_align</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span><span class="n">ds_proj</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">exhaustive_align</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BASE_CURVE</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(204, 200, 2)
Shape of BASE_CURVE: (200, 2)
(204, 200, 2)
</pre></div></div>
</div>
<p>We visually evaluate that methods perform correctly, by plotting the results of the projection and the alignment through the following code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i_rand</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_cells_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">])</span>
<span class="n">unaligned_cell</span> <span class="o">=</span> <span class="n">ds_proj</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">][</span><span class="n">i_rand</span><span class="p">]</span>
<span class="n">aligned_cell</span> <span class="o">=</span> <span class="n">ds_align</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">][</span><span class="n">i_rand</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BASE_CURVE</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">BASE_CURVE</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BASE_CURVE</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">BASE_CURVE</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Reference curve&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">unaligned_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">unaligned_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">unaligned_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">unaligned_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Unaligned curve&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aligned_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aligned_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aligned_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aligned_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Aligned curve&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;alignment.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_42_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_42_0.png" />
</div>
</div>
<p>In the plot above, the red dot shows the start of the parametrization of each curve. The right curve has been rotated from the curve in the middle, to be aligned with the left (reference) curve, which represents the first cell of the dataset. The starting point (in red) of this right curve has been also set to align with the reference.</p>
</section>
</section>
<section id="4-Data-Analysis">
<h1>4 Data Analysis<a class="headerlink" href="#4-Data-Analysis" title="Permalink to this heading">#</a></h1>
<p>Using <em>Geomstats</em>, we can compute geodesics between discrete curves with respect to the elastic metric <a class="reference external" href="#References">(SKJJ2010)</a>. In our data, these geodesics represent trajectories between cell boundaries that minimize an elastic energy, and the length of the geodesic defines a distance between curves. We illustrate such a geodesic between two cells.</p>
<p>This code chooses one control cell from dunn and one control cell from dlm8 (Run the block again to choose other cells).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i_start_rand</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_proj</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">]))</span>
<span class="n">i_end_rand</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_proj</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dlm8&quot;</span><span class="p">]))</span>

<span class="n">cell_start</span> <span class="o">=</span> <span class="n">ds_align</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dunn&quot;</span><span class="p">][</span><span class="n">i_start_rand</span><span class="p">]</span>
<span class="n">cell_end</span> <span class="o">=</span> <span class="n">ds_align</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">][</span><span class="s2">&quot;dlm8&quot;</span><span class="p">][</span><span class="n">i_end_rand</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">i_start_rand</span><span class="p">,</span> <span class="n">i_end_rand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
57 0
</pre></div></div>
</div>
<p>We import the manifold of discrete curves, and the metric on it.</p>
<p>We compute a geodesic between the two curves selected above, and sample points along this geodesic (where a given point represents a cell) at some input <code class="docutils literal notranslate"><span class="pre">times</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.geometry.discrete_curves</span> <span class="kn">import</span> <span class="n">R2</span><span class="p">,</span> <span class="n">DiscreteCurves</span><span class="p">,</span> <span class="n">SRVMetric</span>

<span class="n">CURVES_SPACE</span> <span class="o">=</span> <span class="n">DiscreteCurves</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>
<span class="n">SRV_METRIC</span> <span class="o">=</span> <span class="n">CURVES_SPACE</span><span class="o">.</span><span class="n">srv_metric</span>

<span class="n">geodesic</span> <span class="o">=</span> <span class="n">SRV_METRIC</span><span class="o">.</span><span class="n">geodesic</span><span class="p">(</span><span class="n">initial_curve</span><span class="o">=</span><span class="n">cell_start</span><span class="p">,</span> <span class="n">end_curve</span><span class="o">=</span><span class="n">cell_end</span><span class="p">)</span>

<span class="n">n_times</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">n_times</span><span class="p">)</span>
<span class="n">geod_points</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This code shows the geodesic, which is a trajectory in the space of curves, between the two selected cells.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Geodesic between two cells&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geod_points</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_times</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;geodesic_light_blue.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_49_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_49_0.png" />
</div>
</div>
<p>The following code is a different visualization of the same geodesic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_times</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geod_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">geod_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geod_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">geod_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o-b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Start Cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geod_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">geod_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;o-r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;End Cell&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Geodesic for the Square Root Velocity metric&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;geodesic_blue_red.svg&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_51_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_51_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<p>We want to compute the mean cell shape of the whole dataset. Thus, we first combine all the cell shape data into a single array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_shapes_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">cell_shapes_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>

<span class="n">cell_shapes</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell_shapes_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cell_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(650, 200, 2)
</pre></div></div>
</div>
<p>We compute the mean cell shape by using the SRV metric defined on the space of curves’ shapes. The space of curves’ shape is a manifold: we use the Frechet mean, associated to the SRV metric, to get the mean cell shape.</p>
<p>We only use the first 500 cells of the dataset, for numerical reasons: the FrechetMean is failing upon incorporating shapes from the remainder of the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.learning.frechet_mean</span> <span class="kn">import</span> <span class="n">FrechetMean</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">FrechetMean</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">SRV_METRIC</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
<span class="n">mean</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cell_shapes</span><span class="p">[:</span><span class="mi">500</span><span class="p">])</span>

<span class="n">mean_estimate</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">estimate_</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_estimate</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_estimate</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_57_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_57_0.png" />
</div>
</div>
<p>The mean cell shape does indeed look like a cell shape. We note that there is a discontinuity in the cell because we have modeled the curves’ boundaries as open curves. The space of curves considered here is also the space of (open) discrete curves.</p>
<p>Unfortunately, sometimes there could be Nans in the values of the mean shape. If this is the case, this code removes them manually, and re-interpolate the mean shape.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean_estimate</span><span class="p">)))</span>
<span class="n">mean_estimate_clean</span> <span class="o">=</span> <span class="n">mean_estimate</span><span class="p">[</span><span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mean_estimate</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_estimate_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">mean_estimate_clean</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">mean_estimate_clean</span><span class="p">,</span> <span class="n">N_SAMPLING_POINTS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean_estimate_clean</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_estimate_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
(200, 2)
0
(200, 2)
</pre></div></div>
</div>
<p>We plot the mean cell shape, superimposed on top of the dataset of cells (displayed in light grey underneath).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cell_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_shapes</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">mean_estimate_clean</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_estimate_clean</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean cell&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(650, 200, 2)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_61_1.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_61_1.png" />
</div>
</div>
<p>We see that the scale and alignment of the mean shape is slightly off. This makes sense, as our computations have quotiented out scale and alignment. We correct it manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_estimate_aligned</span> <span class="o">=</span> <span class="mf">1.55</span> <span class="o">*</span> <span class="p">(</span>
    <span class="n">mean_estimate_clean</span> <span class="o">-</span> <span class="n">gs</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_estimate_clean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_shapes</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">mean_estimate_aligned</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_estimate_aligned</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean cell&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_63_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_63_0.png" />
</div>
</div>
<p>We visualize the same plot, but now: - closing the mean shape that becomes a closed curve - plotting underneath the mean shape the distribution of the sampling points of all the curves of the dataset, through a kernel density estimation.</p>
<p>Visualizing the full datasets of 640+ cells takes a long time. Therefore, we also select only 200 cells, randomly, within the dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_estimate_aligned_bis</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">mean_estimate_aligned</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">mean_estimate_aligned</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="n">cells_to_plot</span> <span class="o">=</span> <span class="n">cell_shapes</span><span class="p">[</span><span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell_shapes</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">)]</span>
<span class="n">points_to_plot</span> <span class="o">=</span> <span class="n">cells_to_plot</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">points_to_plot</span><span class="o">.</span><span class="n">T</span><span class="p">)(</span><span class="n">points_to_plot</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">z_norm</span> <span class="o">=</span> <span class="n">z</span> <span class="o">/</span> <span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points_to_plot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points_to_plot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">z_norm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">mean_estimate_aligned_bis</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">mean_estimate_aligned_bis</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean cell&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Global mean shape superimposed on the</span><span class="se">\n</span><span class="s2"> dataset of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;global_mean_shape.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_66_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_66_0.png" />
</div>
</div>
<p>This plot allows to verify that the mean shape that has been computed makes sense.</p>
</section>
<section id="Analyze-Distances-to-the-&quot;Global&quot;-Mean-Shape">
<h1>Analyze Distances to the “Global” Mean Shape<a class="headerlink" href="#Analyze-Distances-to-the-"Global"-Mean-Shape" title="Permalink to this heading">#</a></h1>
<p>We consider each of the subgroups of cells, defined by their treatment and cell line. We wish to study how far each of this group is from the global mean shape. We compute the list of distances to the global mean shape.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists_to_global_mean</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span>
    <span class="n">ds_align</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">SRV_METRIC</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean_estimate_aligned</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">dists_to_global_mean_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">dists_to_global_mean_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">l</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>As an example, the following code shows the 5 first distances of cell shapes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists_to_global_mean_list</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.4933959475000857,
 0.45816034748621776,
 0.3974959197104345,
 0.410320098574152,
 0.3695051182290448]
</pre></div></div>
</div>
<p>We compute a few statistics about this list of distances to the global mean shape, checking: - that there are no NaNs, - what are the values of the min and max distances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dists_to_global_mean_list</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([], dtype=int64),)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_dists</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dists_to_global_mean_list</span><span class="p">)</span>
<span class="n">max_dists</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dists_to_global_mean_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">min_dists</span><span class="p">,</span> <span class="n">max_dists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.3276793621740211 1.26542292118012
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">min_dists</span><span class="p">),</span> <span class="n">gs</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_dists</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We plot the distances to the mean global shape, by splitting them into the three treatment groups.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">distances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">][</span>
                <span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">treatment</span><span class="p">)</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">min_dists</span><span class="p">,</span> <span class="n">max_dists</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Histograms of srv distances (a=1, b=0.5) to global mean cell&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;dist_to_global_mean_per_treatment2.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_79_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_79_0.png" />
</div>
</div>
<p>We observe that each of these distributions seems to be bimodal, which might corresponds to the fact that we have actually two cell lines per treatment. We verify this hypothesis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">min_dists</span><span class="p">,</span> <span class="n">max_dists</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">][</span>
            <span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">line</span>
        <span class="p">)</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Histograms of srv distances (a=1, b=0.5) to global mean cell&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;dist_to_global_mean_per_class2.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_81_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_81_0.png" />
</div>
</div>
<p>For the treatments jasp and cytd, it seems indeed that the bimodality is explained by the two cell lines.</p>
<p>In order to better understand which cells correspond to which distance, on the above plot, we run the following code. This code find a given number of quantiles within the distance’s histogram, and plots the corresponding cell, for each treatment and each cell line.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_quantiles</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">),</span>
    <span class="n">ncols</span><span class="o">=</span><span class="n">n_quantiles</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">dists_list</span> <span class="o">=</span> <span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span>
        <span class="n">dists_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dists_list</span><span class="p">]</span>
        <span class="n">cells_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dists_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dists_list</span><span class="p">)</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dists_list</span><span class="p">)</span>

        <span class="n">zipped_lists</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dists_list</span><span class="p">,</span> <span class="n">cells_list</span><span class="p">)</span>
        <span class="n">sorted_pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zipped_lists</span><span class="p">)</span>

        <span class="n">tuples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_pairs</span><span class="p">)</span>
        <span class="n">sorted_dists_list</span><span class="p">,</span> <span class="n">sorted_cells_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i_quantile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_quantiles</span><span class="p">):</span>
            <span class="n">quantile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="n">i_quantile</span><span class="p">)</span>
            <span class="n">one_cell</span> <span class="o">=</span> <span class="n">sorted_cells_list</span><span class="p">[</span><span class="n">quantile</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i_quantile</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">one_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">one_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0.</span><span class="si">{</span><span class="n">i_quantile</span><span class="si">}</span><span class="s2"> quantile&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="c1"># ax.axis(&quot;off&quot;)</span>
            <span class="c1"># Turn off tick labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i_quantile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quantiles for srv metric (a=1, b=0.5)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;quantiles.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_84_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_84_0.png" />
</div>
</div>
</section>
<section id="Changing-the-Metric-on-the-Space-of-Cell-Shapes">
<h1>Changing the Metric on the Space of Cell Shapes<a class="headerlink" href="#Changing-the-Metric-on-the-Space-of-Cell-Shapes" title="Permalink to this heading">#</a></h1>
<p>What happens if we change the metric on the space of cell shapes? E.g. if we penalize bending more, such that paths (of cell shapes) that bend the boundary of the cells have a longer “length” in th shape space.</p>
<p>We define the elastic metric, as a generalization of the srv metric — with two hyperparameters a and b that penalize bending and stretching. The case a=1 and b=1/2 corresponds to the srv metric we have used until now.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geomstats.geometry.discrete_curves</span> <span class="kn">import</span> <span class="n">ElasticMetric</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ELASTIC_METRIC</span>  <span class="o">=</span> <span class="n">ElasticMetric</span><span class="p">(</span><span class="n">ambient_manifold</span><span class="o">=</span><span class="n">R2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elastic_dists_to_global_mean</span> <span class="o">=</span> <span class="n">apply_func_to_ds</span><span class="p">(</span>
    <span class="n">ds_align</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ELASTIC_METRIC</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean_estimate_aligned</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">elastic_dists_to_global_mean_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">elastic_dists_to_global_mean_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">l</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elastic_min_dists</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">elastic_dists_to_global_mean_list</span><span class="p">)</span>
<span class="n">elastic_max_dists</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">elastic_dists_to_global_mean_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">elastic_min_dists</span><span class="p">,</span> <span class="n">elastic_max_dists</span><span class="p">)</span>
<span class="n">elastic_xx</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">elastic_min_dists</span><span class="p">),</span> <span class="n">gs</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">elastic_max_dists</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8639906351397086 3.09549726364395
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">distances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">][</span>
                <span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">treatment</span><span class="p">)</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elastic_xx</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">elastic_xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">elastic_min_dists</span><span class="p">,</span> <span class="n">elastic_max_dists</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histograms of elastic (a=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">) distances to global mean cell&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_to_global_mean_per_treatment2_a</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">_b</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_89_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_89_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">elastic_min_dists</span><span class="p">,</span> <span class="n">elastic_max_dists</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">][</span>
            <span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">line</span>
        <span class="p">)</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elastic_xx</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">elastic_xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histograms of elastic (a=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">) distances to global mean cell&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist_to_global_mean_per_class2_a</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">_b</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_90_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_90_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_quantiles</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">),</span>
    <span class="n">ncols</span><span class="o">=</span><span class="n">n_quantiles</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">)),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">elastic_dists_list</span> <span class="o">=</span> <span class="n">elastic_dists_to_global_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span>
        <span class="n">elastic_dists_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">elastic_dists_list</span><span class="p">]</span>
        <span class="n">cells_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">elastic_dists_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">elastic_dists_list</span><span class="p">)</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elastic_dists_list</span><span class="p">)</span>

        <span class="n">zipped_lists</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elastic_dists_list</span><span class="p">,</span> <span class="n">cells_list</span><span class="p">)</span>
        <span class="n">sorted_pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zipped_lists</span><span class="p">)</span>

        <span class="n">tuples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_pairs</span><span class="p">)</span>
        <span class="n">sorted_dists_list</span><span class="p">,</span> <span class="n">sorted_cells_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i_quantile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_quantiles</span><span class="p">):</span>
            <span class="n">quantile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="n">i_quantile</span><span class="p">)</span>
            <span class="n">one_cell</span> <span class="o">=</span> <span class="n">sorted_cells_list</span><span class="p">[</span><span class="n">quantile</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i_quantile</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">one_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">one_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0.</span><span class="si">{</span><span class="n">i_quantile</span><span class="si">}</span><span class="s2"> quantile&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="c1"># ax.axis(&quot;off&quot;)</span>
            <span class="c1"># Turn off tick labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i_quantile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quantiles for Elastic Metric (a=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;elastic_quantiles_a</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">_b</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_91_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_91_0.png" />
</div>
</div>
</section>
<section id="Hypothesis-Testing-on-Equality-of-Means">
<h1>Hypothesis Testing on Equality of Means<a class="headerlink" href="#Hypothesis-Testing-on-Equality-of-Means" title="Permalink to this heading">#</a></h1>
<p>The histograms above qualitatively show that the subgroups of treatments and cell lines have different mean distances to the global mean shape: the averages of the histograms above differ.</p>
<p>To evaluate this fact quantitatively, we perform a hypothesis test. Specifically, we test the null hypothesis that two subgroups are at the same distance to the mean global shape.</p>
<p>This is realized through a t-test with unequal variances. We choose a significance level of 0.01. The p-values that are lower than this significance level, after correction for multiple hypothesis testing, correspond to the tests that reject the null hypothesis and thus demonstrate an inequality of means at 0.01.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line_1</span><span class="p">,</span> <span class="n">line_2</span> <span class="o">=</span> <span class="n">LINES</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> --- Test equality of means: </span><span class="si">{</span><span class="n">line_1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">line_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">dists_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">treatment_1</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">dists_1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_1</span><span class="p">][</span><span class="n">line_1</span><span class="p">])</span>
<span class="n">dists_1</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists_1</span><span class="p">)</span>

<span class="n">dists_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">treatment_2</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">dists_2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_2</span><span class="p">][</span><span class="n">line_2</span><span class="p">])</span>
<span class="n">dist_2</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists_2</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">dists_1</span><span class="p">,</span> <span class="n">dists_2</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: dlm8 vs dunn
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-7.119641927083621, pvalue=3.0954021594097804e-12)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="k">for</span> <span class="n">two_treatments</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">treatment_1</span><span class="p">,</span> <span class="n">treatment_2</span> <span class="o">=</span> <span class="n">two_treatments</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> --- Test equality of means: </span><span class="si">{</span><span class="n">treatment_1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">treatment_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dists_1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line_1</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">dists_1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_1</span><span class="p">][</span><span class="n">line_1</span><span class="p">])</span>
    <span class="n">dists_1</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists_1</span><span class="p">)</span>

    <span class="n">dists_2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line_2</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">dists_2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_2</span><span class="p">][</span><span class="n">line_2</span><span class="p">])</span>
    <span class="n">dist_2</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists_2</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">dists_1</span><span class="p">,</span> <span class="n">dists_2</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;!! Correct for multiple hypothesis testing with Bonferroni correction,&quot;</span>
    <span class="sa">f</span><span class="s2">&quot; by multiplying the p-values by </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> &quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control vs cytd
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-18.910331168398844, pvalue=1.594204769317995e-51)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control vs jasp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-9.029282700140127, pvalue=2.0182138940342426e-17)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd vs jasp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=10.293250508487523, pvalue=1.2621209911041894e-21)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
!! Correct for multiple hypothesis testing with Bonferroni correction, by multiplying the p-values by 3
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TREATMENT_LINE_CLASSES</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">t</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TREATMENTS</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">two_classes</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">TREATMENT_LINE_CLASSES</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">class_1</span><span class="p">,</span> <span class="n">class_2</span> <span class="o">=</span> <span class="n">two_classes</span>
    <span class="n">treatment_1</span><span class="p">,</span> <span class="n">line_1</span> <span class="o">=</span> <span class="n">class_1</span>
    <span class="n">treatment_2</span><span class="p">,</span> <span class="n">line_2</span> <span class="o">=</span> <span class="n">class_2</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> --- Test equality of means: </span><span class="si">{</span><span class="n">treatment_1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line_1</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">treatment_2</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line_2</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">display</span><span class="p">(</span>
        <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
            <span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_1</span><span class="p">][</span><span class="n">line_1</span><span class="p">],</span>
            <span class="n">dists_to_global_mean</span><span class="p">[</span><span class="n">treatment_2</span><span class="p">][</span><span class="n">line_2</span><span class="p">],</span>
            <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;!! Correct for multiple hypothesis testing with Bonferroni correction,&quot;</span>
    <span class="sa">f</span><span class="s2">&quot; by multiplying the p-values by </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> &quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-20.314327251473717, pvalue=2.2529389038202823e-49)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs jasp-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-12.505967524150513, pvalue=1.2633229491334757e-28)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=5.024339985563302, pvalue=8.483653891851929e-07)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=1.8913523475476255, pvalue=0.06028562535773457)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-7.880739330613503, pvalue=1.611349858993183e-12)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dunn vs jasp-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=10.620144035734347, pvalue=2.6930383406537948e-20)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dunn vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=25.733072716232908, pvalue=1.2147188349651639e-56)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dunn vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=21.225328407947345, pvalue=1.986807124963289e-47)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dunn vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=6.713758706735647, pvalue=3.997115302750915e-10)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=19.229819430219838, pvalue=6.473316760278354e-47)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=13.82388615870949, pvalue=1.3180986251514235e-27)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-0.45738427664318043, pvalue=0.6482733344379995)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dlm8 vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-2.662042757838704, pvalue=0.00880250081286585)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dlm8 vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-11.070853589195249, pvalue=2.426787682326586e-19)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dlm8 vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-8.932180097318064, pvalue=5.784291930376089e-15)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
!! Correct for multiple hypothesis testing with Bonferroni correction, by multiplying the p-values by 15
</pre></div></div>
</div>
</section>
<section id="Visualization-of-the-Mean-of-each-Treatment">
<h1>Visualization of the Mean of each Treatment<a class="headerlink" href="#Visualization-of-the-Mean-of-each-Treatment" title="Permalink to this heading">#</a></h1>
<p>The mean distances to the global mean shape differ. We also plot the mean shape for each of the subgroup, to get intuition on how the mean shape of each subgroup looks like.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_treatment_cells</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">treatment_cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">treatment_cells</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
    <span class="n">mean_estimator</span> <span class="o">=</span> <span class="n">FrechetMean</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">SRV_METRIC</span><span class="p">)</span>
    <span class="n">mean_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">treatment_cells</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">mean_treatment_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_estimator</span><span class="o">.</span><span class="n">estimate_</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">mean_cell</span> <span class="o">=</span> <span class="n">mean_treatment_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cancer_mean_treatment_cells.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_102_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_102_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_line_cells</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
    <span class="n">line_cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
        <span class="n">line_cells</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
    <span class="n">mean_estimator</span> <span class="o">=</span> <span class="n">FrechetMean</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">SRV_METRIC</span><span class="p">)</span>
    <span class="n">mean_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">line_cells</span><span class="p">[:</span><span class="mi">225</span><span class="p">])</span>
    <span class="n">mean_line_cells</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_estimator</span><span class="o">.</span><span class="n">estimate_</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
    <span class="n">mean_cell</span> <span class="o">=</span> <span class="n">mean_line_cells</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cancer_mean_line_cells.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_104_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_104_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_cells</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">mean_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">mean_estimator</span> <span class="o">=</span> <span class="n">FrechetMean</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">SRV_METRIC</span><span class="p">)</span>
        <span class="n">mean_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">][:</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">mean_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_estimator</span><span class="o">.</span><span class="n">estimate_</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">mean_cell</span> <span class="o">=</span> <span class="n">mean_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">LINES</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mean_cell</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2">   -   </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;cancer_mean_cells.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_106_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_106_0.png" />
</div>
</div>
<p>While the mean shapes of the control groups (for both cell lines) look regular, we observe that: - the mean shape for cytd is the most irregular (for both cell lines) - while the mean shape for jasp is more elongated for dlm8 cell line, and more irregular for dunn cell line.</p>
</section>
<section id="Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape">
<h1>Distance of the Cell Shapes to their Own Mean Shape<a class="headerlink" href="#Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape" title="Permalink to this heading">#</a></h1>
<p>Lastly, we evaluate how each subgroup of cell shapes is distributed around the mean shape of their specific subgroup.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists_to_own_mean</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nan_ids</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">TREATMENTS</span><span class="p">:</span>
    <span class="n">dists_to_own_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">nan_ids</span><span class="p">[</span><span class="n">treatment</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LINES</span><span class="p">:</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i_curve</span><span class="p">,</span> <span class="n">curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_align</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]):</span>
            <span class="n">one_dist</span> <span class="o">=</span> <span class="n">SRV_METRIC</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">mean_cells</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">gs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">one_dist</span><span class="p">):</span>
                <span class="n">dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_dist</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_curve</span><span class="p">)</span>
        <span class="n">dists_to_own_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">dists</span>
        <span class="n">nan_ids</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TREATMENTS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">LINES</span><span class="p">):</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">dists_to_own_mean</span><span class="p">[</span><span class="n">treatment</span><span class="p">][</span><span class="n">line</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">distances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">line</span>
        <span class="p">)</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">kde</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">treatment</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fraction of cells&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Histograms of elastic distances to *own* mean cell&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;dist_to_own_mean.svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_111_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_111_0.png" />
</div>
</div>
<p>Qualitatively, it seems that the control cells and the cells treated with cytd show the most variability in shape. The distributions of distances are more peaked for the cells treated with jasp, which indicates a lower variability in shape. We can hypothesize that the treatment jasp has an effect on the cell’s cytoskeleton, in that it will constrain it, closer to its subgroup’s mean shape.</p>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="10_practical_methods__shape_analysis.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Shape analysis of curves with the Square Root Velocity metric</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Hand gesture classification with EMG data using Riemannian metrics</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022-2023, Geomstats, Inc..<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>