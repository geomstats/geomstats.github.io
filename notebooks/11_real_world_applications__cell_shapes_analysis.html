
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Shape Analysis of Cancer Cells &#8212; Geomstats latest documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/11_real_world_applications__cell_shapes_analysis';</script>
    <link rel="canonical" href="geomstats.github.io/notebooks/11_real_world_applications__cell_shapes_analysis.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hand gesture classification with EMG data using Riemannian metrics" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html" />
    <link rel="prev" title="Align all and Compute for Graphs" href="19_practical_methods__aac.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">Geomstats latest documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../explanation/index.html">
                        Explanation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Reference
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../roadmap.html">
                        Roadmap
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../governance.html">
                        Governance
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../gsod.html">
                        Google Season of Docs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../hackathons.html">
                        Hackathons
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../explanation/index.html">
                        Explanation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Reference
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../roadmap.html">
                        Roadmap
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../governance.html">
                        Governance
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../gsod.html">
                        Google Season of Docs
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../hackathons.html">
                        Hackathons
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="03_practical_methods__data_on_manifolds.html">Data on Manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_practical_methods__from_vector_spaces_to_manifolds.html">From vector spaces to manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_practical_methods__simple_machine_learning_on_tangent_spaces.html">Learning on Tangent Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_practical_methods__riemannian_frechet_mean_and_tangent_pca.html">Fréchet Mean and Tangent PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_practical_methods__riemannian_kmeans.html">K-Means clustering on a Riemannian Manifold</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_practical_methods__information_geometry.html">Information geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_practical_methods__implement_your_own_riemannian_geometry.html">Implement your own Riemannian Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_practical_methods__shape_analysis.html">Shape analysis of curves with the Square Root Velocity metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="19_practical_methods__aac.html">Align all and Compute for Graphs</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Shape Analysis of Cancer Cells</a></li>









<li class="toctree-l1"><a class="reference internal" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html">Hand gesture classification with EMG data using Riemannian metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_real_world_applications__graph_embedding_and_clustering_in_hyperbolic_space.html">Hyperbolic Embedding of Graphs and Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_real_world_applications__hand_poses_analysis_in_kendall_shape_space.html">Classifying hands poses with Kendall shape spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_real_world_applications__optic_nerve_heads_analysis_in_kendall_shape_space.html">Computing with shapes of landmarks in Kendall shape spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_real_world_applications__visualizations_in_kendall_shape_spaces.html">Computing with triangular shapes in Kendall framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="18_real_world_applications__sao_paulo_traffic_optimization.html">Optimization of Sao Paulo traffic</a></li>






</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/notebooks/11_real_world_applications__cell_shapes_analysis.ipynb">notebooks/11_real_world_applications__cell_shapes_analysis.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=notebooks/11_real_world_applications__cell_shapes_analysis.ipynb"><img alt="Binder badge"
    src="https://mybinder.org/badge_logo.svg"
    style="vertical-align:text-bottom"></a>
  </p>
</div><section id="Shape-Analysis-of-Cancer-Cells">
<h1>Shape Analysis of Cancer Cells<a class="headerlink" href="#Shape-Analysis-of-Cancer-Cells" title="Permalink to this heading">#</a></h1>
<p>Lead author: Nina Miolane.</p>
<p>This notebook studies <em>Osteosarcoma</em> (bone cancer) cells and the impact of drug treatment on their <em>morphological shapes</em>, by analyzing cell images obtained from fluorescence microscopy.</p>
<p>This analysis relies on the <em>elastic metric between discrete curves</em> from Geomstats. We will study to which extent this metric can detect how the cell shape is associated with the response to treatment.</p>
<p>This notebook is adapted from Florent Michel’s submission to the <a class="reference external" href="https://github.com/geomstats/challenge-iclr-2021">ICLR 2021 Computational Geometry and Topology challenge</a>.</p>
<center><p><img alt="ec7ac57aa44349e9abb5ebd1625894b1" class="no-scaled-link" src="../_images/cells_image.png" style="width: 600px;" /></p>
</center><p>Figure 1: Representative images of the cell lines using fluorescence microscopy, studied in this notebook (Image credit : Ashok Prasad). The cells nuclei (blue), the actin cytoskeleton (green) and the lipid membrane (red) of each cell are stained and colored. We only focus on the cell shape in our analysis.</p>
</section>
<section id="1.-Introduction-and-Motivation">
<h1>1. Introduction and Motivation<a class="headerlink" href="#1.-Introduction-and-Motivation" title="Permalink to this heading">#</a></h1>
<p>Biological cells adopt a variety of shapes, determined by multiple processes and biophysical forces under the control of the cell. These shapes can be studied with different quantitative measures that reflect the cellular morphology <a class="reference external" href="#References">(MGCKCKDDRTWSBCC2018)</a>. With the emergence of large-scale biological cell image data, morphological studies have many applications. For example, measures of irregularity and spreading of cells allow accurate classification and discrimination between
cancer cell lines treated with different drugs <a class="reference external" href="#References">(AXCFP2019)</a>.</p>
<p>As metrics defined on the shape space of curves, the <em>elastic metrics</em> <a class="reference external" href="#References">(SKJJ2010)</a> implemented in Geomstats are a potential tool for analyzing and comparing biological cell shapes. Their associated geodesics and geodesic distances provide a natural framework for optimally matching, deforming, and comparing cell shapes.</p>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import os
import subprocess

geomstats_gitroot_path = subprocess.check_output(
    [&quot;git&quot;, &quot;rev-parse&quot;, &quot;--show-toplevel&quot;], universal_newlines=True
)

os.chdir(geomstats_gitroot_path[:-1])

print(&quot;Working directory: &quot;, os.getcwd())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Working directory:  /home/lgomespe/Repos/github/geomstats
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import warnings

warnings.filterwarnings(&quot;ignore&quot;)

import matplotlib.pyplot as plt

import geomstats.backend as gs

gs.random.seed(2021)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Using numpy backend
</pre></div></div>
</div>
</section>
</section>
<section id="2.-Dataset-Description">
<h1>2. Dataset Description<a class="headerlink" href="#2.-Dataset-Description" title="Permalink to this heading">#</a></h1>
<p>We study a dataset of mouse <em>Osteosarcoma</em> imaged cells <a class="reference external" href="#References">(AXCFP2019)</a>. The dataset contains two different cancer cell lines : <em>DLM8</em> and <em>DUNN</em>, respectively representing a more agressive and a less agressive cancer. Among these cells, some have also been treated with different single drugs that perturb the cellular cytoskeleton. Overall, we can label each cell according to their cell line (<em>DLM8</em> and <em>DUNN</em>), and also if it is a <em>control</em> cell (no treatment), or has been treated
with one of the following drugs : <em>Jasp</em> (jasplakinolide) and <em>Cytd</em> (cytochalasin D).</p>
<p>Each cell comes from a raw image containing a set of cells, which was thresholded to generate binarized images.</p>
<td><p><img alt="1da5dfa703d74fff9d53fdd977019def" class="no-scaled-link" src="../_images/binarized_cells.png" style="width: 400px;" /></p>
</td><p>After binarizing the images, contouring was used to isolate each cell, and to extract their boundaries as a counter-clockwise ordered list of 2D coordinates, which corresponds to the representation of discrete curve in Geomstats. We load these discrete curves into the notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import geomstats.datasets.utils as data_utils

cells, lines, treatments = data_utils.load_cells()
print(f&quot;Total number of cells : {len(cells)}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total number of cells : 650
</pre></div></div>
</div>
<p>The cells are grouped by treatment class in the dataset : - the <em>control</em> cells, - the cells treated with <em>Cytd</em>, - and the ones treated with <em>Jasp</em>.</p>
<p>Additionally, in each of these classes, there are two cell lines : - the <em>DLM8</em> cells, and - the <em>DUNN</em> ones.</p>
<p>This is shown by displaying the unique elements in the lists <code class="docutils literal notranslate"><span class="pre">treatments</span></code> and <code class="docutils literal notranslate"><span class="pre">lines</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd

TREATMENTS = gs.unique(treatments)
print(TREATMENTS)
LINES = gs.unique(lines)
print(LINES)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;control&#39; &#39;cytd&#39; &#39;jasp&#39;]
[&#39;dlm8&#39; &#39;dunn&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cell_idx = 1
plt.plot(cells[cell_idx][:, 0], cells[cell_idx][:, 1], &quot;blue&quot;)
plt.plot(cells[cell_idx][0, 0], cells[cell_idx][0, 1], &quot;blue&quot;, marker=&quot;o&quot;);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_15_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_15_0.png" />
</div>
</div>
<p>The size of each class is displayed below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds = {}

n_cells_arr = gs.zeros((3, 2))

for i, treatment in enumerate(TREATMENTS):
    print(f&quot;{treatment} :&quot;)
    ds[treatment] = {}
    for j, line in enumerate(LINES):
        to_keep = gs.array(
            [
                one_treatment == treatment and one_line == line
                for one_treatment, one_line in zip(treatments, lines)
            ]
        )
        ds[treatment][line] = [
            cell_i for cell_i, to_keep_i in zip(cells, to_keep) if to_keep_i
        ]
        nb = len(ds[treatment][line])
        print(f&quot;\t {nb} {line}&quot;)
        n_cells_arr[i, j] = nb

n_cells_df = pd.DataFrame({&quot;dlm8&quot;: n_cells_arr[:, 0], &quot;dunn&quot;: n_cells_arr[:, 1]})
n_cells_df = n_cells_df.set_index(TREATMENTS)

display(n_cells_df)
# display(ds)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
control :
         114 dlm8
         204 dunn
cytd :
         82 dlm8
         93 dunn
jasp :
         62 dlm8
         95 dunn
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dlm8</th>
      <th>dunn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>control</th>
      <td>114.0</td>
      <td>204.0</td>
    </tr>
    <tr>
      <th>cytd</th>
      <td>82.0</td>
      <td>93.0</td>
    </tr>
    <tr>
      <th>jasp</th>
      <td>62.0</td>
      <td>95.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The above code also created a dictionnary <code class="docutils literal notranslate"><span class="pre">ds</span></code>, that contains the cell boundaries data sorted by <code class="docutils literal notranslate"><span class="pre">treatment</span></code> and cell <code class="docutils literal notranslate"><span class="pre">line</span></code>. To access all the cells corresponding to a given treatment and a given cell line, we use the syntax <code class="docutils literal notranslate"><span class="pre">ds[treatment][line]</span></code> as in the following code that computes the number of cells in the cytd-dlm8 class.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>len(ds[&quot;cytd&quot;][&quot;dlm8&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
82
</pre></div></div>
</div>
<p>We have organized the cell data into the dictionnary <code class="docutils literal notranslate"><span class="pre">ds</span></code>. Before proceeding to the actual data analysis, we provide an auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def apply_func_to_ds(input_ds, func):
    &quot;&quot;&quot;Apply the input function func to the input dictionnary input_ds.

    This function goes through the dictionnary structure and applies
    func to every cell in input_ds[treatment][line].

    It stores the result in a dictionnary output_ds that is returned
    to the user.

    Parameters
    ----------
    input_ds : dict
        Input dictionnary, with keys treatment-line.
    func : callable
        Function to be applied to the values of the dictionnary, i.e.
        the cells.

    Returns
    -------
    output_ds : dict
        Output dictionnary, with the same keys as input_ds.
    &quot;&quot;&quot;
    output_ds = {}
    for treatment in TREATMENTS:
        output_ds[treatment] = {}
        for line in LINES:
            output_list = []
            for one_cell in input_ds[treatment][line]:
                output_list.append(func(one_cell))
            output_ds[treatment][line] = gs.array(output_list)
    return output_ds
</pre></div>
</div>
</div>
<p>Now we can move on to the actual data analysis, starting with a preprocessing of the cell boundaries.</p>
</section>
<section id="3.-Preprocessing">
<h1>3. Preprocessing<a class="headerlink" href="#3.-Preprocessing" title="Permalink to this heading">#</a></h1>
<section id="Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points">
<h2>Interpolation: Encoding Discrete Curves With Same Number of Points<a class="headerlink" href="#Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points" title="Permalink to this heading">#</a></h2>
<p>As we need discrete curves with the same number of sampled points to compute pairwise distances, the following interpolation is applied to each curve, after setting the number of sampling points.</p>
<p>To set up the number of sampling points, you can edit the following line in the next cell:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def interpolate(curve, nb_points):
    &quot;&quot;&quot;Interpolate a discrete curve with nb_points from a discrete curve.

    Returns
    -------
    interpolation : discrete curve with nb_points points
    &quot;&quot;&quot;
    old_length = curve.shape[0]
    interpolation = gs.zeros((nb_points, 2))
    incr = old_length / nb_points
    pos = 0
    for i in range(nb_points):
        index = int(gs.floor(pos))
        interpolation[i] = curve[index] + (pos - index) * (
            curve[(index + 1) % old_length] - curve[index]
        )
        pos += incr
    return interpolation


k_sampling_points = 200
</pre></div>
</div>
</div>
<p>To illustrate the result of this interpolation, we compare for a randomly chosen cell the original curve with the correponding interpolated one (to visualize another cell, you can simply re-run the code).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cell_rand = cells[gs.random.randint(len(cells))]
cell_interpolation = interpolate(cell_rand, k_sampling_points)

fig = plt.figure(figsize=(15, 5))

fig.add_subplot(121)
plt.plot(cell_rand[:, 0], cell_rand[:, 1])
plt.axis(&quot;equal&quot;)
plt.title(f&quot;Original curve ({len(cell_rand)} points)&quot;)
plt.axis(&quot;off&quot;)

fig.add_subplot(122)
plt.plot(cell_interpolation[:, 0], cell_interpolation[:, 1])
plt.axis(&quot;equal&quot;)
plt.title(f&quot;Interpolated curve ({k_sampling_points} points)&quot;)
plt.axis(&quot;off&quot;)

plt.savefig(&quot;interpolation.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_26_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_26_0.png" />
</div>
</div>
<p>As the interpolation is working as expected, we use the auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code> to apply the function <code class="docutils literal notranslate"><span class="pre">func=interpolate</span></code> to the dataset <code class="docutils literal notranslate"><span class="pre">ds</span></code>, i.e. the dictionnary containing the cells boundaries.</p>
<p>We obtain a new dictionnary, <code class="docutils literal notranslate"><span class="pre">ds_interp</span></code>, with the interpolated cell boundaries.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds_interp = apply_func_to_ds(
    input_ds=ds, func=lambda x: interpolate(x, k_sampling_points)
)
</pre></div>
</div>
</div>
<p>For each key treatment-control, we check that the number of sampling points is the one expected, i.e. <code class="docutils literal notranslate"><span class="pre">k_sampling_points</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(ds_interp[&quot;control&quot;][&quot;dunn&quot;].shape)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(204, 200, 2)
</pre></div></div>
</div>
<p>The shape of an array of cells in <code class="docutils literal notranslate"><span class="pre">ds_interp[treatment][cell]</span></code> is therefore: <code class="docutils literal notranslate"><span class="pre">(&quot;number</span> <span class="pre">of</span> <span class="pre">cells</span> <span class="pre">in</span> <span class="pre">treatment-line&quot;,</span> <span class="pre">&quot;number</span> <span class="pre">of</span> <span class="pre">sampling</span> <span class="pre">points&quot;,</span> <span class="pre">2)</span></code>, where 2 refers to the fact that we are considering cell shapes in 2D.</p>
</section>
<section id="Visualization-of-Interpolated-Dataset-of-Curves">
<h2>Visualization of Interpolated Dataset of Curves<a class="headerlink" href="#Visualization-of-Interpolated-Dataset-of-Curves" title="Permalink to this heading">#</a></h2>
<p>We visualize the curves obtained, for a sample of control cells and treated cells (top row shows control, i.e. non-treated cells; bottom rows shows treated cells) across cell lines (left and blue for dlm8 and right and orange for dunn).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n_cells_to_plot = 10

fig = plt.figure(figsize=(16, 6))
count = 1
for treatment in TREATMENTS:
    for line in LINES:
        cell_data = ds_interp[treatment][line]
        for i_to_plot in range(n_cells_to_plot):
            cell = gs.random.choice(cell_data)
            fig.add_subplot(3, 2 * n_cells_to_plot, count)
            count += 1
            plt.plot(cell[:, 0], cell[:, 1], color=&quot;C&quot; + str(int((line == &quot;dunn&quot;))))
            plt.axis(&quot;equal&quot;)
            plt.axis(&quot;off&quot;)
            if i_to_plot == n_cells_to_plot // 2:
                plt.title(f&quot;{treatment}   -   {line}&quot;, fontsize=20)
plt.savefig(&quot;cancer_cell_sample.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_34_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_34_0.png" />
</div>
</div>
<p>Visual inspection of these curves seems to indicate more protusions appearing in treated cells, compared with control ones. This is in agreement with the physiological impact of the drugs, which are known to perturb the internal cytoskeleton connected to the cell membrane. Using the elastic metric, our goal will be to see if we can quantitatively confirm these differences.</p>
</section>
<section id="Remove-duplicate-samples-in-curves">
<h2>Remove duplicate samples in curves<a class="headerlink" href="#Remove-duplicate-samples-in-curves" title="Permalink to this heading">#</a></h2>
<p>During interpolation it is likely that some of the discrete curves in the dataset are downsampled from higher number of discrete data points to lower number of data points. Hence, two sampled data points that are close enough may end up overlapping after interpolation and hence such data points have to be dealt with specifically.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np

def preprocess(curve, tol=1e-10):
    &quot;&quot;&quot;Preprocess curve to ensure that there are no consecutive duplicate points.

    Returns
    -------
    curve : discrete curve
    &quot;&quot;&quot;

    dist = curve[1:] - curve[:-1]
    dist_norm = np.sqrt(np.sum(np.square(dist), axis=1))

    if np.any( dist_norm &lt; tol ):
        for i in range(len(curve)-1):
            if np.sqrt(np.sum(np.square(curve[i+1] - curve[i]), axis=0)) &lt; tol:
                curve[i+1] = (curve[i] + curve[i+2]) / 2

    return curve
</pre></div>
</div>
</div>
</section>
<section id="Alignment">
<h2>Alignment<a class="headerlink" href="#Alignment" title="Permalink to this heading">#</a></h2>
<p>Our goal is to study the cell boundaries in our dataset, as points in a shape space of closed curves quotiented by translation, scaling, and rotation, so these transformations do not affect our measure of distance between curves.</p>
<p>In practice, we apply functions that were initially designed to center (substract the barycenter), rescale (divide by the Frobenius norm) and then align (find the rotation minimizing the L² distance) two sets of landmarks. These operations will be performed by leveraging the geometry of the so-called Kendall preshape spaces and specifically its method <code class="docutils literal notranslate"><span class="pre">PRESHAPE_SPACE.projection</span></code>, as shown below. Details on Kendall shape spaces can be found in the <a class="reference external" href="https://github.com/geomstats/geomstats/blob/master/geomstats/geometry/pre_shape.py">module implementing
them</a> or the notebooks using them.</p>
<p>Additionally, since we are working with closed curves, the starting point associated with the parametrization of the discrete curves is also arbitrary. Thus, we conduct an exhaustive search to find which parametrization produces the best alignment according to the above procedure (i.e. the distance to the base curve is the smallest). This exhaustive search is implemented in the function <code class="docutils literal notranslate"><span class="pre">exhaustive_align</span></code> below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from geomstats.geometry.pre_shape import PreShapeSpace

M_AMBIENT = 2

PRESHAPE_SPACE = PreShapeSpace(m_ambient=M_AMBIENT, k_landmarks=k_sampling_points)
PRESHAPE_METRIC = PRESHAPE_SPACE.embedding_space.metric


def exhaustive_align(curve, base_curve):
    &quot;&quot;&quot;Align curve to base_curve to minimize the L² distance.

    Returns
    -------
    aligned_curve : discrete curve
    &quot;&quot;&quot;
    nb_sampling = len(curve)
    distances = gs.zeros(nb_sampling)
    base_curve = gs.array(base_curve)
    for shift in range(nb_sampling):
        reparametrized = [curve[(i + shift) % nb_sampling] for i in range(nb_sampling)]
        aligned = PRESHAPE_SPACE.align(point=gs.array(reparametrized), base_point=base_curve)
        distances[shift] = PRESHAPE_METRIC.norm(
            gs.array(aligned) - gs.array(base_curve)
        )
    shift_min = gs.argmin(distances)
    reparametrized_min = [
        curve[(i + shift_min) % nb_sampling] for i in range(nb_sampling)
    ]
    aligned_curve = PRESHAPE_SPACE.align(
        point=gs.array(reparametrized_min), base_point=base_curve
    )
    return aligned_curve
</pre></div>
</div>
</div>
<p>We perform the pre-shape projection and the exhaustive alignment of the cells against the base curve, which is chosen to be the first cell curve of the dataset, called <code class="docutils literal notranslate"><span class="pre">BASE_CURVE</span></code>.</p>
<p>Both the projection and the alignment make use of our auxiliary function <code class="docutils literal notranslate"><span class="pre">apply_func_to_ds</span></code>, which finally outputs a dataset of cell curves organized within a dictionnary called <code class="docutils literal notranslate"><span class="pre">ds_align</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds_proc = apply_func_to_ds(ds_interp, func=lambda x: preprocess(x))

ds_proj = apply_func_to_ds(ds_proc, func=PRESHAPE_SPACE.projection)
print(ds_proj[&quot;control&quot;][&quot;dunn&quot;].shape)

BASE_CURVE = ds_proj[&quot;control&quot;][&quot;dunn&quot;][0]
print(&quot;Shape of BASE_CURVE:&quot;, BASE_CURVE.shape)

ds_align = apply_func_to_ds(ds_proj, func=lambda x: exhaustive_align(x, BASE_CURVE))
print(ds_align[&quot;control&quot;][&quot;dunn&quot;].shape)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(204, 200, 2)
Shape of BASE_CURVE: (200, 2)
(204, 200, 2)
</pre></div></div>
</div>
<p>We visually evaluate that methods perform correctly, by plotting the results of the projection and the alignment through the following code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>i_rand = gs.random.randint(n_cells_df.loc[&quot;control&quot;][&quot;dunn&quot;])
unaligned_cell = ds_proj[&quot;control&quot;][&quot;dunn&quot;][i_rand]
aligned_cell = ds_align[&quot;control&quot;][&quot;dunn&quot;][i_rand]

fig = plt.figure(figsize=(15, 5))

fig.add_subplot(131)
plt.plot(BASE_CURVE[:, 0], BASE_CURVE[:, 1])
plt.plot(BASE_CURVE[0, 0], BASE_CURVE[0, 1], &quot;ro&quot;)
plt.axis(&quot;equal&quot;)
plt.title(&quot;Reference curve&quot;)

fig.add_subplot(132)
plt.plot(unaligned_cell[:, 0], unaligned_cell[:, 1])
plt.plot(unaligned_cell[0, 0], unaligned_cell[0, 1], &quot;ro&quot;)
plt.axis(&quot;equal&quot;)
plt.title(&quot;Unaligned curve&quot;)

fig.add_subplot(133)
plt.plot(aligned_cell[:, 0], aligned_cell[:, 1])
plt.plot(aligned_cell[0, 0], aligned_cell[0, 1], &quot;ro&quot;)
plt.axis(&quot;equal&quot;)
plt.title(&quot;Aligned curve&quot;)

plt.savefig(&quot;alignment.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_43_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_43_0.png" />
</div>
</div>
<p>In the plot above, the red dot shows the start of the parametrization of each curve. The right curve has been rotated from the curve in the middle, to be aligned with the left (reference) curve, which represents the first cell of the dataset. The starting point (in red) of this right curve has been also set to align with the reference.</p>
</section>
</section>
<section id="4-Data-Analysis">
<h1>4 Data Analysis<a class="headerlink" href="#4-Data-Analysis" title="Permalink to this heading">#</a></h1>
<p>Using <em>Geomstats</em>, we can compute geodesics between discrete curves with respect to the elastic metric <a class="reference external" href="#References">(SKJJ2010)</a>. In our data, these geodesics represent trajectories between cell boundaries that minimize an elastic energy, and the length of the geodesic defines a distance between curves. We illustrate such a geodesic between two cells.</p>
<p>This code chooses one control cell from dunn and one control cell from dlm8 (Run the block again to choose other cells).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>i_start_rand = gs.random.randint(len(ds_proj[&quot;control&quot;][&quot;dunn&quot;]))
i_end_rand = gs.random.randint(len(ds_proj[&quot;control&quot;][&quot;dlm8&quot;]))

cell_start = ds_align[&quot;control&quot;][&quot;dunn&quot;][i_start_rand]
cell_end = ds_align[&quot;control&quot;][&quot;dlm8&quot;][i_end_rand]

print(i_start_rand, i_end_rand)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
57 0
</pre></div></div>
</div>
<p>We import the manifold of discrete curves, and the metric on it.</p>
<p>We compute a geodesic between the two curves selected above, and sample points along this geodesic (where a given point represents a cell) at some input <code class="docutils literal notranslate"><span class="pre">times</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from geomstats.geometry.discrete_curves import R2, DiscreteCurves, SRVMetric

CURVES_SPACE = DiscreteCurves(R2)
SRV_METRIC = CURVES_SPACE.srv_metric

geodesic = SRV_METRIC.geodesic(initial_point=cell_start, end_point=cell_end)

n_times = 30
times = gs.linspace(0.0, 1.0, n_times)
geod_points = geodesic(times)
</pre></div>
</div>
</div>
<p>This code shows the geodesic, which is a trajectory in the space of curves, between the two selected cells.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(10, 2))
plt.title(&quot;Geodesic between two cells&quot;)
plt.axis(&quot;off&quot;)

for i, curve in enumerate(geod_points):
    fig.add_subplot(2, n_times // 2, i + 1)
    plt.plot(curve[:, 0], curve[:, 1])
    plt.axis(&quot;equal&quot;)
    plt.axis(&quot;off&quot;)
plt.savefig(&quot;geodesic_light_blue.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_50_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_50_0.png" />
</div>
</div>
<p>The following code is a different visualization of the same geodesic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(12, 12))
for i in range(1, n_times - 1):
    plt.plot(geod_points[i, :, 0], geod_points[i, :, 1], &quot;o-&quot;, color=&quot;lightgrey&quot;)
plt.plot(geod_points[0, :, 0], geod_points[0, :, 1], &quot;o-b&quot;, label=&quot;Start Cell&quot;)
plt.plot(geod_points[-1, :, 0], geod_points[-1, :, 1], &quot;o-r&quot;, label=&quot;End Cell&quot;)

plt.title(&quot;Geodesic for the Square Root Velocity metric&quot;)
plt.legend()
plt.show()
plt.savefig(&quot;geodesic_blue_red.svg&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_52_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_52_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<p>We want to compute the mean cell shape of the whole dataset. Thus, we first combine all the cell shape data into a single array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cell_shapes_list = []
for treatment in TREATMENTS:
    for line in LINES:
        cell_shapes_list.extend(ds_align[treatment][line])

cell_shapes = gs.array(cell_shapes_list)
print(cell_shapes.shape)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(650, 200, 2)
</pre></div></div>
</div>
<p>We compute the mean cell shape by using the SRV metric defined on the space of curves’ shapes. The space of curves’ shape is a manifold: we use the Frechet mean, associated to the SRV metric, to get the mean cell shape.</p>
<p>We only use the first 500 cells of the dataset, for numerical reasons: the FrechetMean is failing upon incorporating shapes from the remainder of the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from geomstats.learning.frechet_mean import FrechetMean

mean = FrechetMean(metric=SRV_METRIC, method=&quot;default&quot;)
mean.fit(cell_shapes[:500])

mean_estimate = mean.estimate_

plt.plot(mean_estimate[:, 0], mean_estimate[:, 1], &quot;black&quot;);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_58_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_58_0.png" />
</div>
</div>
<p>The mean cell shape does indeed look like a cell shape. We note that there is a discontinuity in the cell because we have modeled the curves’ boundaries as open curves. The space of curves considered here is also the space of (open) discrete curves.</p>
<p>Unfortunately, sometimes there could be Nans in the values of the mean shape. If this is the case, this code removes them manually, and re-interpolate the mean shape.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(gs.sum(gs.isnan(mean_estimate)))
mean_estimate_clean = mean_estimate[~gs.isnan(gs.sum(mean_estimate, axis=1)), :]
print(mean_estimate_clean.shape)
mean_estimate_clean = interpolate(mean_estimate_clean, k_sampling_points)
print(gs.sum(gs.isnan(mean_estimate_clean)))
print(mean_estimate_clean.shape)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
(200, 2)
0
(200, 2)
</pre></div></div>
</div>
<p>We plot the mean cell shape, superimposed on top of the dataset of cells (displayed in light grey underneath).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(cell_shapes.shape)
for cell in cell_shapes:
    plt.plot(cell[:, 0], cell[:, 1], &quot;lightgrey&quot;, alpha=0.2)

plt.plot(
    mean_estimate_clean[:, 0], mean_estimate_clean[:, 1], &quot;black&quot;, label=&quot;Mean cell&quot;
)
plt.legend(fontsize=12);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(650, 200, 2)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_62_1.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_62_1.png" />
</div>
</div>
<p>We see that the scale and alignment of the mean shape is slightly off. This makes sense, as our computations have quotiented out scale and alignment. We correct it manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mean_estimate_aligned = 1.55 * (
    mean_estimate_clean - gs.mean(mean_estimate_clean, axis=0)
)

for cell in cell_shapes:
    plt.plot(cell[:, 0], cell[:, 1], &quot;lightgrey&quot;, alpha=0.2)

plt.plot(
    mean_estimate_aligned[:, 0], mean_estimate_aligned[:, 1], &quot;black&quot;, label=&quot;Mean cell&quot;
)
plt.legend(fontsize=12);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_64_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_64_0.png" />
</div>
</div>
<p>We visualize the same plot, but now: - closing the mean shape that becomes a closed curve - plotting underneath the mean shape the distribution of the sampling points of all the curves of the dataset, through a kernel density estimation.</p>
<p>Visualizing the full datasets of 640+ cells takes a long time. Therefore, we also select only 200 cells, randomly, within the dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mean_estimate_aligned_bis = gs.vstack(
    [mean_estimate_aligned[4:], mean_estimate_aligned[-1]]
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from scipy.stats import gaussian_kde

cells_to_plot = cell_shapes[gs.random.randint(len(cell_shapes), size=200)]
points_to_plot = cells_to_plot.reshape(-1, 2)

z = gaussian_kde(points_to_plot.T)(points_to_plot.T)
z_norm = z / z.max()

plt.scatter(points_to_plot[:, 0], points_to_plot[:, 1], alpha=0.2, c=z_norm, s=10)
plt.plot(
    mean_estimate_aligned_bis[:, 0],
    mean_estimate_aligned_bis[:, 1],
    &quot;black&quot;,
    label=&quot;Mean cell&quot;,
)
plt.legend(fontsize=12)
plt.title(&quot;Global mean shape superimposed on the\n dataset of cells&quot;, fontsize=14)

plt.savefig(&quot;global_mean_shape.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_67_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_67_0.png" />
</div>
</div>
<p>This plot allows to verify that the mean shape that has been computed makes sense.</p>
</section>
<section id="Analyze-Distances-to-the-“Global”-Mean-Shape">
<h1>Analyze Distances to the “Global” Mean Shape<a class="headerlink" href="#Analyze-Distances-to-the-“Global”-Mean-Shape" title="Permalink to this heading">#</a></h1>
<p>We consider each of the subgroups of cells, defined by their treatment and cell line. We wish to study how far each of this group is from the global mean shape. We compute the list of distances to the global mean shape.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dists_to_global_mean = apply_func_to_ds(
    ds_align, func=lambda x: SRV_METRIC.dist(x, mean_estimate_aligned)
)

dists_to_global_mean_list = []
for t in TREATMENTS:
    for l in LINES:
        dists_to_global_mean_list.extend(dists_to_global_mean[t][l])
</pre></div>
</div>
</div>
<p>As an example, the following code shows the 5 first distances of cell shapes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dists_to_global_mean_list[:5]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.4933959475000857,
 0.45816034748621776,
 0.3974959197104345,
 0.410320098574152,
 0.3695051182290448]
</pre></div></div>
</div>
<p>We compute a few statistics about this list of distances to the global mean shape, checking: - that there are no NaNs, - what are the values of the min and max distances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gs.where(gs.isnan(dists_to_global_mean_list))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([], dtype=int64),)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>min_dists = min(dists_to_global_mean_list)
max_dists = max(dists_to_global_mean_list)
print(min_dists, max_dists)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.3276793621740211 1.26542292118012
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>xx = gs.linspace(gs.floor(min_dists), gs.ceil(max_dists), 100)
</pre></div>
</div>
</div>
<p>We plot the distances to the mean global shape, by splitting them into the three treatment groups.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from scipy import stats
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(1, sharex=True, sharey=True, tight_layout=True, figsize=(8, 4))

for i, treatment in enumerate(TREATMENTS):
    distances = []
    for j, line in enumerate(LINES):
        distances.extend(
            dists_to_global_mean[treatment][line][
                ~gs.isnan(dists_to_global_mean[treatment][line])
            ]
        )
    color = &quot;C&quot; + str(2 + i)
    axs.hist(distances, bins=20, alpha=0.4, density=True, color=color, label=treatment)
    kde = stats.gaussian_kde(distances)
    axs.plot(xx, kde(xx), color=color)
    axs.set_xlim((min_dists, max_dists))
    axs.legend(fontsize=12)

    axs.set_title(f&quot;{treatment} cells&quot;, fontsize=14)
    axs.set_ylabel(&quot;Fraction of cells&quot;, fontsize=14)


fig.suptitle(&quot;Histograms of srv distances (a=1, b=0.5) to global mean cell&quot;, fontsize=20)
plt.savefig(&quot;dist_to_global_mean_per_treatment2.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_80_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_80_0.png" />
</div>
</div>
<p>We observe that each of these distributions seems to be bimodal, which might corresponds to the fact that we have actually two cell lines per treatment. We verify this hypothesis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(3, sharex=True, sharey=True, tight_layout=True, figsize=(8, 8))

axs[0].set_xlim((min_dists, max_dists))
for i, treatment in enumerate(TREATMENTS):
    for j, line in enumerate(LINES):
        distances = dists_to_global_mean[treatment][line][
            ~gs.isnan(dists_to_global_mean[treatment][line])
        ]
        color = f&quot;C{j}&quot;
        axs[i].hist(
            distances, bins=20, alpha=0.4, density=True, color=color, label=line
        )
        kde = stats.gaussian_kde(distances)
        axs[i].plot(xx, kde(xx), color=color)

    axs[i].set_title(f&quot;{treatment} cells&quot;, fontsize=14)
    axs[i].set_ylabel(&quot;Fraction of cells&quot;, fontsize=14)
    axs[i].legend(fontsize=12)

fig.suptitle(&quot;Histograms of srv distances (a=1, b=0.5) to global mean cell&quot;, fontsize=20)
plt.savefig(&quot;dist_to_global_mean_per_class2.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_82_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_82_0.png" />
</div>
</div>
<p>For the treatments jasp and cytd, it seems indeed that the bimodality is explained by the two cell lines.</p>
<p>In order to better understand which cells correspond to which distance, on the above plot, we run the following code. This code find a given number of quantiles within the distance’s histogram, and plots the corresponding cell, for each treatment and each cell line.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n_quantiles = 10
fig, axes = plt.subplots(
    nrows=len(TREATMENTS) * len(LINES),
    ncols=n_quantiles,
    figsize=(20, 2 * len(LINES) * len(TREATMENTS)),
)

for i, treatment in enumerate(TREATMENTS):
    for j, line in enumerate(LINES):
        dists_list = dists_to_global_mean[treatment][line]
        dists_list = [d + 0.0001 * gs.random.rand(1)[0] for d in dists_list]
        cells_list = list(ds_align[treatment][line])
        assert len(dists_list) == len(dists_list)
        n_cells = len(dists_list)

        zipped_lists = zip(dists_list, cells_list)
        sorted_pairs = sorted(zipped_lists)

        tuples = zip(*sorted_pairs)
        sorted_dists_list, sorted_cells_list = [list(t) for t in tuples]
        for i_quantile in range(n_quantiles):
            quantile = int(0.1 * n_cells * i_quantile)
            one_cell = sorted_cells_list[quantile]
            ax = axes[2 * i + j, i_quantile]
            ax.plot(one_cell[:, 0], one_cell[:, 1], c=f&quot;C{j}&quot;)
            ax.set_title(f&quot;0.{i_quantile} quantile&quot;, fontsize=14)
            # ax.axis(&quot;off&quot;)
            # Turn off tick labels
            ax.set_yticklabels([])
            ax.set_xticklabels([])
            ax.set_xticks([])
            ax.set_yticks([])
            ax.spines[&quot;top&quot;].set_visible(False)
            ax.spines[&quot;right&quot;].set_visible(False)
            ax.spines[&quot;bottom&quot;].set_visible(False)
            ax.spines[&quot;left&quot;].set_visible(False)
            if i_quantile == 0:
                ax.set_ylabel(f&quot;{treatment}-{line}&quot;, rotation=90, fontsize=18)
plt.tight_layout()
plt.suptitle(f&quot;Quantiles for srv metric (a=1, b=0.5)&quot;, y=-0.01, fontsize=24)
plt.savefig(&quot;quantiles.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_85_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_85_0.png" />
</div>
</div>
</section>
<section id="Changing-the-Metric-on-the-Space-of-Cell-Shapes">
<h1>Changing the Metric on the Space of Cell Shapes<a class="headerlink" href="#Changing-the-Metric-on-the-Space-of-Cell-Shapes" title="Permalink to this heading">#</a></h1>
<p>What happens if we change the metric on the space of cell shapes? E.g. if we penalize bending more, such that paths (of cell shapes) that bend the boundary of the cells have a longer “length” in th shape space.</p>
<p>We define the elastic metric, as a generalization of the srv metric — with two hyperparameters a and b that penalize bending and stretching. The case a=1 and b=1/2 corresponds to the srv metric we have used until now.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from geomstats.geometry.discrete_curves import ElasticMetric

a = 3
b = 1
ELASTIC_METRIC  = ElasticMetric(ambient_manifold=R2, a=a, b=b)
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>elastic_dists_to_global_mean = apply_func_to_ds(
    ds_align, func=lambda x: ELASTIC_METRIC.dist(x, mean_estimate_aligned)
)

elastic_dists_to_global_mean_list = []
for t in TREATMENTS:
    for l in LINES:
        elastic_dists_to_global_mean_list.extend(elastic_dists_to_global_mean[t][l])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>elastic_min_dists = min(elastic_dists_to_global_mean_list)
elastic_max_dists = max(elastic_dists_to_global_mean_list)
print(elastic_min_dists, elastic_max_dists)
elastic_xx = gs.linspace(gs.floor(elastic_min_dists), gs.ceil(elastic_max_dists), 100)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8639906351397086 3.09549726364395
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(1, sharex=True, sharey=True, tight_layout=True, figsize=(8, 4))

for i, treatment in enumerate(TREATMENTS):
    distances = []
    for j, line in enumerate(LINES):
        distances.extend(
            elastic_dists_to_global_mean[treatment][line][
                ~gs.isnan(elastic_dists_to_global_mean[treatment][line])
            ]
        )
    color = &quot;C&quot; + str(2 + i)
    axs.hist(distances, bins=20, alpha=0.4, density=True, color=color, label=treatment)
    kde = stats.gaussian_kde(distances)
    axs.plot(elastic_xx, kde(elastic_xx), color=color)
    axs.set_xlim((elastic_min_dists, elastic_max_dists))
    axs.legend(fontsize=12)

    axs.set_title(f&quot;{treatment} cells&quot;, fontsize=14)
    axs.set_ylabel(&quot;Fraction of cells&quot;, fontsize=14)


fig.suptitle(f&quot;Histograms of elastic (a={a}, b={b}) distances to global mean cell&quot;, fontsize=20)
plt.savefig(f&quot;dist_to_global_mean_per_treatment2_a{a}_b{b}.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_90_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_90_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(3, sharex=True, sharey=True, tight_layout=True, figsize=(8, 8))

axs[0].set_xlim((elastic_min_dists, elastic_max_dists))
for i, treatment in enumerate(TREATMENTS):
    for j, line in enumerate(LINES):
        distances = elastic_dists_to_global_mean[treatment][line][
            ~gs.isnan(elastic_dists_to_global_mean[treatment][line])
        ]
        color = f&quot;C{j}&quot;
        axs[i].hist(
            distances, bins=20, alpha=0.4, density=True, color=color, label=line
        )
        kde = stats.gaussian_kde(distances)
        axs[i].plot(elastic_xx, kde(elastic_xx), color=color)

    axs[i].set_title(f&quot;{treatment} cells&quot;, fontsize=14)
    axs[i].set_ylabel(&quot;Fraction of cells&quot;, fontsize=14)
    axs[i].legend(fontsize=12)

fig.suptitle(f&quot;Histograms of elastic (a={a}, b={b}) distances to global mean cell&quot;, fontsize=20)
plt.savefig(f&quot;dist_to_global_mean_per_class2_a{a}_b{b}.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_91_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_91_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># n_quantiles = 10
fig, axes = plt.subplots(
    nrows=len(TREATMENTS) * len(LINES),
    ncols=n_quantiles,
    figsize=(20, 2 * len(LINES) * len(TREATMENTS)),
)

for i, treatment in enumerate(TREATMENTS):
    for j, line in enumerate(LINES):
        elastic_dists_list = elastic_dists_to_global_mean[treatment][line]
        elastic_dists_list = [d + 0.0001 * gs.random.rand(1)[0] for d in elastic_dists_list]
        cells_list = list(ds_align[treatment][line])
        assert len(elastic_dists_list) == len(elastic_dists_list)
        n_cells = len(elastic_dists_list)

        zipped_lists = zip(elastic_dists_list, cells_list)
        sorted_pairs = sorted(zipped_lists)

        tuples = zip(*sorted_pairs)
        sorted_dists_list, sorted_cells_list = [list(t) for t in tuples]
        for i_quantile in range(n_quantiles):
            quantile = int(0.1 * n_cells * i_quantile)
            one_cell = sorted_cells_list[quantile]
            ax = axes[2 * i + j, i_quantile]
            ax.plot(one_cell[:, 0], one_cell[:, 1], c=f&quot;C{j}&quot;)
            ax.set_title(f&quot;0.{i_quantile} quantile&quot;, fontsize=14)
            # ax.axis(&quot;off&quot;)
            # Turn off tick labels
            ax.set_yticklabels([])
            ax.set_xticklabels([])
            ax.set_xticks([])
            ax.set_yticks([])
            ax.spines[&quot;top&quot;].set_visible(False)
            ax.spines[&quot;right&quot;].set_visible(False)
            ax.spines[&quot;bottom&quot;].set_visible(False)
            ax.spines[&quot;left&quot;].set_visible(False)
            if i_quantile == 0:
                ax.set_ylabel(f&quot;{treatment}-{line}&quot;, rotation=90, fontsize=18)
plt.tight_layout()
plt.suptitle(f&quot;Quantiles for Elastic Metric (a={a}, b={b})&quot;, y=-0.01, fontsize=24)
plt.savefig(f&quot;elastic_quantiles_a{a}_b{b}.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_92_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_92_0.png" />
</div>
</div>
</section>
<section id="Hypothesis-Testing-on-Equality-of-Means">
<h1>Hypothesis Testing on Equality of Means<a class="headerlink" href="#Hypothesis-Testing-on-Equality-of-Means" title="Permalink to this heading">#</a></h1>
<p>The histograms above qualitatively show that the subgroups of treatments and cell lines have different mean distances to the global mean shape: the averages of the histograms above differ.</p>
<p>To evaluate this fact quantitatively, we perform a hypothesis test. Specifically, we test the null hypothesis that two subgroups are at the same distance to the mean global shape.</p>
<p>This is realized through a t-test with unequal variances. We choose a significance level of 0.01. The p-values that are lower than this significance level, after correction for multiple hypothesis testing, correspond to the tests that reject the null hypothesis and thus demonstrate an inequality of means at 0.01.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import scipy
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>line_1, line_2 = LINES

print(f&quot;\n --- Test equality of means: {line_1} vs {line_2}&quot;)
dists_1 = []
for treatment_1 in TREATMENTS:
    dists_1.extend(dists_to_global_mean[treatment_1][line_1])
dists_1 = gs.array(dists_1)

dists_2 = []
for treatment_2 in TREATMENTS:
    dists_2.extend(dists_to_global_mean[treatment_2][line_2])
dist_2 = gs.array(dists_2)

display(scipy.stats.ttest_ind(dists_1, dists_2, equal_var=False))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: dlm8 vs dunn
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-7.119641927083621, pvalue=3.0954021594097804e-12)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>count = 0

from itertools import combinations

for two_treatments in combinations(TREATMENTS, 2):
    treatment_1, treatment_2 = two_treatments

    print(f&quot;\n --- Test equality of means: {treatment_1} vs {treatment_2}&quot;)
    dists_1 = []
    for line_1 in LINES:
        dists_1.extend(dists_to_global_mean[treatment_1][line_1])
    dists_1 = gs.array(dists_1)

    dists_2 = []
    for line_2 in LINES:
        dists_2.extend(dists_to_global_mean[treatment_2][line_2])
    dist_2 = gs.array(dists_2)

    display(scipy.stats.ttest_ind(dists_1, dists_2, equal_var=False))
    count += 1
print(
    f&quot;!! Correct for multiple hypothesis testing with Bonferroni correction,&quot;
    f&quot; by multiplying the p-values by {count} &quot;
)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control vs cytd
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-18.910331168398844, pvalue=1.594204769317995e-51)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control vs jasp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-9.029282700140127, pvalue=2.0182138940342426e-17)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd vs jasp
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=10.293250508487523, pvalue=1.2621209911041894e-21)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
!! Correct for multiple hypothesis testing with Bonferroni correction, by multiplying the p-values by 3
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>TREATMENT_LINE_CLASSES = set([(t, l) for t in TREATMENTS for l in LINES])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>count = 0

for two_classes in combinations(TREATMENT_LINE_CLASSES, 2):
    class_1, class_2 = two_classes
    treatment_1, line_1 = class_1
    treatment_2, line_2 = class_2
    print(
        f&quot;\n --- Test equality of means: {treatment_1}-{line_1} vs {treatment_2}-{line_2}&quot;
    )
    display(
        scipy.stats.ttest_ind(
            dists_to_global_mean[treatment_1][line_1],
            dists_to_global_mean[treatment_2][line_2],
            equal_var=False,
        )
    )
    count += 1
print(
    f&quot;!! Correct for multiple hypothesis testing with Bonferroni correction,&quot;
    f&quot; by multiplying the p-values by {count} &quot;
)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs control-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=12.505967524150513, pvalue=1.2633229491334757e-28)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-0.45738427664318043, pvalue=0.6482733344379995)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=13.82388615870949, pvalue=1.3180986251514235e-27)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=19.229819430219838, pvalue=6.473316760278354e-47)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dunn vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-10.620144035734347, pvalue=2.6930383406537948e-20)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs cytd-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-7.880739330613503, pvalue=1.611349858993183e-12)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=1.8913523475476255, pvalue=0.06028562535773457)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=5.024339985563302, pvalue=8.483653891851929e-07)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dunn vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-20.314327251473717, pvalue=2.2529389038202823e-49)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dlm8 vs jasp-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=8.932180097318064, pvalue=5.784291930376089e-15)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dlm8 vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=11.070853589195249, pvalue=2.426787682326586e-19)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: cytd-dlm8 vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-6.713758706735647, pvalue=3.997115302750915e-10)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dlm8 vs control-dlm8
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=2.662042757838704, pvalue=0.00880250081286585)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: jasp-dlm8 vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-21.225328407947345, pvalue=1.986807124963289e-47)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 --- Test equality of means: control-dlm8 vs cytd-dunn
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ttest_indResult(statistic=-25.733072716232908, pvalue=1.2147188349651639e-56)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
!! Correct for multiple hypothesis testing with Bonferroni correction, by multiplying the p-values by 15
</pre></div></div>
</div>
</section>
<section id="Visualization-of-the-Mean-of-each-Treatment">
<h1>Visualization of the Mean of each Treatment<a class="headerlink" href="#Visualization-of-the-Mean-of-each-Treatment" title="Permalink to this heading">#</a></h1>
<p>The mean distances to the global mean shape differ. We also plot the mean shape for each of the subgroup, to get intuition on how the mean shape of each subgroup looks like.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mean_treatment_cells = {}
for treatment in TREATMENTS:
    treatment_cells = []
    for line in LINES:
        treatment_cells.extend(ds_align[treatment][line])
    mean_estimator = FrechetMean(metric=SRV_METRIC)
    mean_estimator.fit(treatment_cells[:30])
    mean_treatment_cells[treatment] = mean_estimator.estimate_
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(8, 4))
count = 1
for treatment in TREATMENTS:
    mean_cell = mean_treatment_cells[treatment]
    fig.add_subplot(1, len(TREATMENTS), count)
    count += 1
    plt.plot(mean_cell[:, 0], mean_cell[:, 1], color=f&quot;C2&quot;)
    plt.axis(&quot;equal&quot;)
    plt.axis(&quot;off&quot;)
    plt.title(f&quot;Mean {treatment}&quot;, fontsize=20)
plt.savefig(&quot;cancer_mean_treatment_cells.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_103_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_103_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mean_line_cells = {}
for line in LINES:
    line_cells = []
    for treatment in TREATMENTS:
        line_cells.extend(ds_align[treatment][line])
    mean_estimator = FrechetMean(metric=SRV_METRIC)
    mean_estimator.fit(line_cells[:225])
    mean_line_cells[line] = mean_estimator.estimate_
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(8, 4))
count = 1
for line in LINES:
    mean_cell = mean_line_cells[line]
    fig.add_subplot(1, len(LINES), count)
    count += 1
    plt.plot(mean_cell[:, 0], mean_cell[:, 1], color=f&quot;C1&quot;)
    plt.axis(&quot;equal&quot;)
    plt.axis(&quot;off&quot;)
    plt.title(f&quot;Mean {line}&quot;, fontsize=20)
plt.savefig(&quot;cancer_mean_line_cells.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_105_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_105_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mean_cells = {}
for treatment in TREATMENTS:
    mean_cells[treatment] = {}
    for line in LINES:
        mean_estimator = FrechetMean(metric=SRV_METRIC)
        mean_estimator.fit(ds_align[treatment][line][:20])
        mean_cells[treatment][line] = mean_estimator.estimate_
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(16, 6))
count = 1
for treatment in TREATMENTS:
    for j, line in enumerate(LINES):
        mean_cell = mean_cells[treatment][line]
        fig.add_subplot(len(TREATMENTS), len(LINES), count)
        count += 1
        plt.plot(mean_cell[:, 0], mean_cell[:, 1], color=f&quot;C{j}&quot;)
        plt.axis(&quot;equal&quot;)
        plt.axis(&quot;off&quot;)
        plt.title(f&quot;{treatment}   -   {line}&quot;, fontsize=20)
plt.savefig(&quot;cancer_mean_cells.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_107_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_107_0.png" />
</div>
</div>
<p>While the mean shapes of the control groups (for both cell lines) look regular, we observe that: - the mean shape for cytd is the most irregular (for both cell lines) - while the mean shape for jasp is more elongated for dlm8 cell line, and more irregular for dunn cell line.</p>
</section>
<section id="Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape">
<h1>Distance of the Cell Shapes to their Own Mean Shape<a class="headerlink" href="#Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape" title="Permalink to this heading">#</a></h1>
<p>Lastly, we evaluate how each subgroup of cell shapes is distributed around the mean shape of their specific subgroup.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dists_to_own_mean = {}
nan_ids = {}
for treatment in TREATMENTS:
    dists_to_own_mean[treatment] = {}
    nan_ids[treatment] = {}
    for line in LINES:
        dists = []
        ids = []
        for i_curve, curve in enumerate(ds_align[treatment][line]):
            one_dist = SRV_METRIC.dist(curve, mean_cells[treatment][line])
            if ~gs.isnan(one_dist):
                dists.append(one_dist)
            else:
                ids.append(i_curve)
        dists_to_own_mean[treatment][line] = dists
        nan_ids[treatment][line] = ids
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, axs = plt.subplots(3, sharex=True, sharey=True, tight_layout=True, figsize=(8, 8))

for i, treatment in enumerate(TREATMENTS):
    for j, line in enumerate(LINES):
        distances = dists_to_own_mean[treatment][line]
        color = f&quot;C{j}&quot;
        axs[i].hist(
            distances, bins=20, alpha=0.4, density=True, color=color, label=line
        )
        kde = stats.gaussian_kde(distances)
        axs[i].plot(xx, kde(xx), color=color)

    axs[i].set_title(f&quot;{treatment} cells&quot;, fontsize=14)
    axs[i].set_ylabel(&quot;Fraction of cells&quot;, fontsize=14)
    axs[i].legend(fontsize=12)

fig.suptitle(&quot;Histograms of elastic distances to *own* mean cell&quot;, fontsize=20)
plt.savefig(&quot;dist_to_own_mean.svg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_112_0.png" src="../_images/notebooks_11_real_world_applications__cell_shapes_analysis_112_0.png" />
</div>
</div>
<p>Qualitatively, it seems that the control cells and the cells treated with cytd show the most variability in shape. The distributions of distances are more peaked for the cells treated with jasp, which indicates a lower variability in shape. We can hypothesize that the treatment jasp has an effect on the cell’s cytoskeleton, in that it will constrain it, closer to its subgroup’s mean shape.</p>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="19_practical_methods__aac.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Align all and Compute for Graphs</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="12_real_world_applications__emg_sign_classification_in_spd_manifold.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Hand gesture classification with EMG data using Riemannian metrics</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Shape Analysis of Cancer Cells
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#1.-Introduction-and-Motivation">
   1. Introduction and Motivation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#2.-Dataset-Description">
   2. Dataset Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#3.-Preprocessing">
   3. Preprocessing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Interpolation:-Encoding-Discrete-Curves-With-Same-Number-of-Points">
     Interpolation: Encoding Discrete Curves With Same Number of Points
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Visualization-of-Interpolated-Dataset-of-Curves">
     Visualization of Interpolated Dataset of Curves
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Remove-duplicate-samples-in-curves">
     Remove duplicate samples in curves
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Alignment">
     Alignment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#4-Data-Analysis">
   4 Data Analysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Analyze-Distances-to-the-“Global”-Mean-Shape">
   Analyze Distances to the “Global” Mean Shape
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Changing-the-Metric-on-the-Space-of-Cell-Shapes">
   Changing the Metric on the Space of Cell Shapes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Hypothesis-Testing-on-Equality-of-Means">
   Hypothesis Testing on Equality of Means
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Visualization-of-the-Mean-of-each-Treatment">
   Visualization of the Mean of each Treatment
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Distance-of-the-Cell-Shapes-to-their-Own-Mean-Shape">
   Distance of the Cell Shapes to their Own Mean Shape
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/notebooks/11_real_world_applications__cell_shapes_analysis.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022-2023, Geomstats, Inc..<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>