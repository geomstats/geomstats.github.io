

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tutorial: Hand gesture classification with EMG data using Riemannian metrics &mdash; Geomstats latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="geomstats.github.io/notebooks/usecase_emg_sign_classification_in_spd_manifold.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial: Hyperbolic Embedding of Graphs and Clustering" href="usecase_graph_embedding_and_clustering_in_hyperbolic_space.html" />
    <link rel="prev" title="Tutorial: Information geometry" href="06_information_geometry.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Geomstats
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../first-steps.html">First steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_data_on_manifolds.html">Tutorial: Data on Manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_from_vector_spaces_to_manifolds.html">Tutorial: From vector spaces to manifolds</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_simple_machine_learning_on_tangent_spaces.html">Tutorial: Learning on Tangent Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_riemannian_frechet_mean_and_tangent_pca.html">Tutorial: Fréchet Mean and Tangent PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_riemannian_kmeans.html">Tutorial: K-Means clustering on a Riemannian Manifold</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_information_geometry.html">Tutorial: Information geometry</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Hand gesture classification with EMG data using Riemannian metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Context">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-Data">The Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Preprocessing-into-covariance-matrices">Preprocessing into covariance matrices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Covariances-plot-of-the-euclidean-average">Covariances plot of the euclidean average</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Covariances-plot-of-the-Frechet-Mean-of-the-affine-invariant-metric">Covariances plot of the Frechet Mean of the affine invariant metric</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Sign-Classification">Sign Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#A.-Test-on-the-same-session-and-user-as-Training/Calibration">A. Test on the same session and user as Training/Calibration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#A.0.-Using-Logistic-Regression-on-the-vectorized-Matrix-(Euclidean-Method)">A.0. Using Logistic Regression on the vectorized Matrix (Euclidean Method)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#A.1.-Using-DNN-on-the-vectorized-Matrix-(Euclidean-Method)">A.1. Using DNN on the vectorized Matrix (Euclidean Method)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#A.2.-Using-Tangent-space-projection-+-Logistic-Regression">A.2. Using Tangent space projection + Logistic Regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#A.3.-Using-Tangent-space-projection-+-DNN">A.3. Using Tangent space projection + DNN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#A.4.-Using-Euclidean-MDM">A.4. Using Euclidean MDM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#A.5.-Using-MDM-with-a-Riemannian-metric">A.5. Using MDM with a Riemannian metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Summary-plots">Summary plots</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usecase_graph_embedding_and_clustering_in_hyperbolic_space.html">Tutorial: Hyperbolic Embedding of Graphs and Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecase_optic_nerve_heads_analysis_in_kendall_shape_space.html">Tutorial: Computing with shapes of landmarks in Kendall shape spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecase_hand_poses_analysis_in_kendall_shape_space.html">Tutorial: Classifying hands poses with Kendall shape spaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Geomstats</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial: Hand gesture classification with EMG data using Riemannian metrics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notebooks/usecase_emg_sign_classification_in_spd_manifold.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
  <p>Notebook source code:
    <a class="reference external"
    href="https://github.com/geomstats/geomstats/blob/master/\
        notebooks/usecase_emg_sign_classification_in_spd_manifold.ipynb">notebooks/usecase_emg_sign_classification_in_spd_manifold.ipynb</a>
    <br>Run it yourself on binder
    <a href="https://mybinder.org/v2/gh/geomstats/geomstats/master?filepath=\
                        notebooks/usecase_emg_sign_classification_in_spd_manifold.ipynb"><img alt="Binder badge" \
                        src="https://mybinder.org/badge_logo.svg" \
                        style="vertical-align:text-bottom"></a>
  </p>
</div><div class="section" id="Tutorial:-Hand-gesture-classification-with-EMG-data-using-Riemannian-metrics">
<h1>Tutorial: Hand gesture classification with EMG data using Riemannian metrics<a class="headerlink" href="#Tutorial:-Hand-gesture-classification-with-EMG-data-using-Riemannian-metrics" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we are using EMG time series collected by 8 electrodes placed on the arm skin. We are going to show how to - Process these kind of signal into covariance matrices that we can manipulate with geomstats tools. - How to apply ML algorithms on this data to classify four different hand gestures present in the data (Rock, Paper, Scissors, Ok). - How do the different methods (using Riemanian metrics, projecting on tangent space, Euclidean metric) compare to each other.</p>
<p><img alt="6162c8b6894444668e10700a6c8809b8" src="../_images/paper_rock_scissors.png" /></p>
<div class="section" id="Context">
<h2>Context<a class="headerlink" href="#Context" title="Permalink to this headline">¶</a></h2>
<p>The data are acquired from somOS-interface: an sEMG armband that allows you to interact via bluetooth with an Android smartphone (you can contact Marius Guerard (<a class="reference external" href="mailto:marius&#46;guerard&#37;&#52;&#48;gmail&#46;com">marius<span>&#46;</span>guerard<span>&#64;</span>gmail<span>&#46;</span>com</a>) or Renaud Renault (<a class="reference external" href="mailto:renaud&#46;armand&#46;renault&#37;&#52;&#48;gmail&#46;com">renaud<span>&#46;</span>armand<span>&#46;</span>renault<span>&#64;</span>gmail<span>&#46;</span>com</a>) for more info on how to make this kind of armband yourself).</p>
<p>An example of application is to record static signs that are linked with different actions (moving a cursor and clicking, sign recognition for command based personal assistants, …). In these experiments, we want to evaluate the difference in performance (measured as the accuracy of sign recognition) between three different real life situations where we change the conditions of training (when user record signs or “calibrate” the device) and testing (when the app guess what sign the user is
doing):</p>
<ul class="simple">
<li><ol class="arabic simple">
<li><p>What is the accuracy when doing sign recognition right after training?</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>What is the accuracy when calibrating, removing and replacing the armband at the same position and then testing?</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>What is the accuracy when calibrating, removing the armband and giving it to someone else that is testing it without calibration?</p></li>
</ol>
</li>
</ul>
<p>To simulate these situations, we record data from two different users (rr and mg) and in two different sessions (s1 or s2). The user put the bracelet before every session and remove it after every session.</p>
<p>Quick description of the data: - Each row corresponds to one acquisition, there is an acquisition every ~4 ms for 8 electrodes which correspond to a 250Hz acquisition rate. - The time column is in ms. - The columns c0 to c7 correspond to the electrical value recorded at each of the 8 electrodes (arbitrary unit). - The label correspond to the sign being recorded by the user at this time point (‘rest’, ‘rock’, ‘paper’, ‘scissors’, or ‘ok). ‘rest’ correspond to a rested arm. - the exp identify the
user (rr and mg) and the session (s1 or s2)</p>
<p>Note: Another interesting use case, not explored in this notebook, would be to test what is the accruacy when calibrating, removing the armband and giving it to someone else that is calibrating it on its own arm before testing it. The idea being that transfer learning might help getting better results (or faster calibration) than calibrating on one user.</p>
</div>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<p>Before starting this tutorial, we set the working directory to be the root of the geomstats repository. In order to have the code working on your machine, you need to change this path to the path of your geomstats repository.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">geomstats_gitroot_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="s1">&#39;--show-toplevel&#39;</span><span class="p">],</span>
    <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">geomstats_gitroot_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Working directory: &#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="kn">import</span> <span class="nn">geomstats.backend</span> <span class="k">as</span> <span class="nn">gs</span>

<span class="n">gs</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Working directory:  /home/marius/proj/geomstats
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Using numpy backend
</pre></div></div>
</div>
</div>
<div class="section" id="Parameters">
<h2>Parameters<a class="headerlink" href="#Parameters" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">N_ELECTRODES</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">N_SIGNS</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-Data">
<h2>The Data<a class="headerlink" href="#The-Data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">geomstats.datasets.utils</span> <span class="k">as</span> <span class="nn">data_utils</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data_utils</span><span class="o">.</span><span class="n">load_emg</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>c0</th>
      <th>c1</th>
      <th>c2</th>
      <th>c3</th>
      <th>c4</th>
      <th>c5</th>
      <th>c6</th>
      <th>c7</th>
      <th>label</th>
      <th>exp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>23</td>
      <td>127</td>
      <td>123</td>
      <td>128</td>
      <td>134</td>
      <td>125</td>
      <td>128</td>
      <td>130</td>
      <td>124</td>
      <td>rest</td>
      <td>mg_s1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>28</td>
      <td>126</td>
      <td>130</td>
      <td>128</td>
      <td>119</td>
      <td>129</td>
      <td>128</td>
      <td>126</td>
      <td>133</td>
      <td>rest</td>
      <td>mg_s1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>129</td>
      <td>130</td>
      <td>127</td>
      <td>125</td>
      <td>129</td>
      <td>129</td>
      <td>127</td>
      <td>130</td>
      <td>rest</td>
      <td>mg_s1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36</td>
      <td>127</td>
      <td>128</td>
      <td>126</td>
      <td>123</td>
      <td>128</td>
      <td>127</td>
      <td>125</td>
      <td>131</td>
      <td>rest</td>
      <td>mg_s1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>127</td>
      <td>128</td>
      <td>129</td>
      <td>124</td>
      <td>127</td>
      <td>129</td>
      <td>127</td>
      <td>128</td>
      <td>rest</td>
      <td>mg_s1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">N_SIGNS</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rock&#39;</span><span class="p">,</span> <span class="s1">&#39;scissors&#39;</span><span class="p">,</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_list</span><span class="p">):</span>
    <span class="n">sign_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="n">label_i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_ELECTRODES</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sign_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">electrode</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">label_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_12_0.png" src="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_12_0.png" />
</div>
</div>
<p>We are removing the sign ‘rest’ for the rest of the analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="Preprocessing-into-covariance-matrices">
<h3>Preprocessing into covariance matrices<a class="headerlink" href="#Preprocessing-into-covariance-matrices" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1">### Parameters.</span>
<span class="n">N_STEPS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">LABEL_MAP</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rock&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;scissors&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;paper&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">MARGIN</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<p>Unpacking data into arrays for batching</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">),</span>
    <span class="s1">&#39;raw_data&#39;</span><span class="p">:</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;c</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_ELECTRODES</span><span class="p">)]]),</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">),</span>
    <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">gs</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">exp</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">geomstats.datasets.prepare_emg_data</span> <span class="kn">import</span> <span class="n">TimeSeriesCovariance</span>

<span class="n">cov_data</span> <span class="o">=</span> <span class="n">TimeSeriesCovariance</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">N_STEPS</span><span class="p">,</span> <span class="n">N_ELECTRODES</span><span class="p">,</span> <span class="n">LABEL_MAP</span><span class="p">,</span> <span class="n">MARGIN</span><span class="p">)</span>
<span class="n">cov_data</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We check that these matrics belong to the space of SPD matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">geomstats.geometry.spd_matrices</span> <span class="k">as</span> <span class="nn">spd</span>

<span class="n">manifold</span> <span class="o">=</span> <span class="n">spd</span><span class="o">.</span><span class="n">SPDMatrices</span><span class="p">(</span><span class="n">N_ELECTRODES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gs</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">manifold</span><span class="o">.</span><span class="n">belongs</span><span class="p">(</span><span class="n">cov_data</span><span class="o">.</span><span class="n">covs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> Out [11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="section" id="Covariances-plot-of-the-euclidean-average">
<h4>Covariances plot of the euclidean average<a class="headerlink" href="#Covariances-plot-of-the-euclidean-average" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label_i</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">label_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">label_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="o">==</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sign_cov_mat</span> <span class="o">=</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">covs</span><span class="p">[</span><span class="n">label_ids</span><span class="p">]</span>
    <span class="n">mean_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sign_cov_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_cov</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">label_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_24_0.png" src="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_24_0.png" />
</div>
</div>
<p>Looking at the euclidean average of the spd matrices for each sign, does not show a striking difference between 3 of our signs (scissors, paper, and ok). Minimum Distance to Mean (MDM) algorithm will probably performed poorly if using euclidean mean here.</p>
</div>
<div class="section" id="Covariances-plot-of-the-Frechet-Mean-of-the-affine-invariant-metric">
<h4>Covariances plot of the Frechet Mean of the affine invariant metric<a class="headerlink" href="#Covariances-plot-of-the-Frechet-Mean-of-the-affine-invariant-metric" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">geomstats.learning.frechet_mean</span> <span class="kn">import</span> <span class="n">FrechetMean</span>
<span class="kn">from</span> <span class="nn">geomstats.geometry.spd_matrices</span> <span class="kn">import</span> <span class="n">SPDMetricAffine</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">metric_affine</span> <span class="o">=</span> <span class="n">SPDMetricAffine</span><span class="p">(</span><span class="n">N_ELECTRODES</span><span class="p">)</span>
<span class="n">mean_affine</span> <span class="o">=</span> <span class="n">FrechetMean</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric_affine</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="s1">&#39;matrix&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label_i</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">label_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">label_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="o">==</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sign_cov_mat</span> <span class="o">=</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">covs</span><span class="p">[</span><span class="n">label_ids</span><span class="p">]</span>
    <span class="n">mean_affine</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">sign_cov_mat</span><span class="p">)</span>
    <span class="n">mean_cov</span> <span class="o">=</span> <span class="n">mean_affine</span><span class="o">.</span><span class="n">estimate_</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mean_cov</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">label_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_29_0.png" src="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_29_0.png" />
</div>
</div>
<p>We see that the average matrices computed using the affine invariant metric are now more differenciated from each other and can potentially give better results, when using MDM to predict the sign linked to a matrix sample.</p>
</div>
</div>
</div>
<div class="section" id="Sign-Classification">
<h2>Sign Classification<a class="headerlink" href="#Sign-Classification" title="Permalink to this headline">¶</a></h2>
<p>We are now going to train some classifiers on those matrices to see how we can accurately discriminate these 4 hand positions. The baseline accuracy is defined as the accuracy we get by randomly guessing the signs. In our case, the baseline accuracy is 25%.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Hiding the numerous sklearn warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>pip install keras
<span class="o">!</span>pip install tensorflow
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Requirement already satisfied: keras in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (2.3.1)
Requirement already satisfied: numpy&gt;=1.9.1 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (1.19.5)
Requirement already satisfied: keras-applications&gt;=1.0.6 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (1.0.8)
Requirement already satisfied: pyyaml in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (5.3)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (1.1.2)
Requirement already satisfied: scipy&gt;=0.14 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (1.4.1)
Requirement already satisfied: h5py in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (2.10.0)
Requirement already satisfied: six&gt;=1.9.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from keras) (1.12.0)
Requirement already satisfied: tensorflow in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (2.4.1)
Requirement already satisfied: typing-extensions~=3.7.4 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (3.7.4.3)
Requirement already satisfied: google-pasta~=0.2 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (0.2.0)
Requirement already satisfied: flatbuffers~=1.12.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.12)
Requirement already satisfied: wrapt~=1.12.1 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.12.1)
Requirement already satisfied: tensorboard~=2.4 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (2.4.1)
Collecting six~=1.15.0 (from tensorflow)
  Using cached https://files.pythonhosted.org/packages/ee/ff/48bde5c0f013094d729fe4b0316ba2a24774b3ff1c52d924a8a4cb04078a/six-1.15.0-py2.py3-none-any.whl
Requirement already satisfied: keras-preprocessing~=1.1.2 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.1.2)
Requirement already satisfied: absl-py~=0.10 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (0.11.0)
Requirement already satisfied: tensorflow-estimator&lt;2.5.0,&gt;=2.4.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (2.4.0)
Requirement already satisfied: grpcio~=1.32.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.32.0)
Requirement already satisfied: opt-einsum~=3.3.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (3.3.0)
Requirement already satisfied: numpy~=1.19.2 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.19.5)
Requirement already satisfied: wheel~=0.35 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (0.36.2)
Requirement already satisfied: astunparse~=1.6.3 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.6.3)
Requirement already satisfied: h5py~=2.10.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (2.10.0)
Requirement already satisfied: gast==0.3.3 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (0.3.3)
Requirement already satisfied: protobuf&gt;=3.9.2 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (3.14.0)
Requirement already satisfied: termcolor~=1.1.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorflow) (1.1.0)
Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (2.22.0)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (0.15.4)
Requirement already satisfied: google-auth-oauthlib&lt;0.5,&gt;=0.4.1 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (0.4.1)
Requirement already satisfied: google-auth&lt;2,&gt;=1.6.3 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (1.7.1)
Collecting setuptools&gt;=41.0.0 (from tensorboard~=2.4-&gt;tensorflow)
  Downloading https://files.pythonhosted.org/packages/ae/4d/153a2cfab2ea03d4f4aee45d9badb52426db9e2275edfb4b825c5dc55a10/setuptools-54.1.0-py3-none-any.whl (784kB)
    100% |████████████████████████████████| 788kB 6.1MB/s eta 0:00:01   35% |███████████▎                    | 276kB 4.1MB/s eta 0:00:01
Requirement already satisfied: markdown&gt;=2.6.8 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (3.1.1)
Requirement already satisfied: tensorboard-plugin-wit&gt;=1.6.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow) (1.8.0)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow) (1.25.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow) (2020.6.20)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow) (2.8)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow) (3.0.4)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard~=2.4-&gt;tensorflow) (1.3.0)
Requirement already satisfied: cachetools&lt;3.2,&gt;=2.0.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from google-auth&lt;2,&gt;=1.6.3-&gt;tensorboard~=2.4-&gt;tensorflow) (3.1.1)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from google-auth&lt;2,&gt;=1.6.3-&gt;tensorboard~=2.4-&gt;tensorflow) (0.2.7)
Requirement already satisfied: rsa&lt;4.1,&gt;=3.1.4 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from google-auth&lt;2,&gt;=1.6.3-&gt;tensorboard~=2.4-&gt;tensorflow) (4.0)
Requirement already satisfied: oauthlib&gt;=3.0.0 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard~=2.4-&gt;tensorflow) (3.1.0)
Requirement already satisfied: pyasn1&lt;0.5.0,&gt;=0.4.6 in /home/marius/miniconda3/envs/stats/lib/python3.7/site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&lt;2,&gt;=1.6.3-&gt;tensorboard~=2.4-&gt;tensorflow) (0.4.8)
<span class="ansi-red-fg">astroid 2.2.5 requires typed-ast&gt;=1.3.0; implementation_name == &#34;cpython&#34;, which is not installed.</span>
Installing collected packages: six, setuptools
  Found existing installation: six 1.12.0
    Uninstalling six-1.12.0:
      Successfully uninstalled six-1.12.0
  Found existing installation: setuptools 40.8.0
    Uninstalling setuptools-40.8.0:
      Successfully uninstalled setuptools-40.8.0
Successfully installed setuptools-54.1.0 six-1.15.0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">keras.wrappers.scikit_learn</span> <span class="kn">import</span> <span class="n">KerasClassifier</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</pre></div>
</div>
</div>
<p>N_EPOCHS is the number of epochs on which to train the DNN. Recommended is ~100</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">N_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_FEATURES</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N_ELECTRODES</span> <span class="o">*</span> <span class="p">(</span><span class="n">N_ELECTRODES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="A.-Test-on-the-same-session-and-user-as-Training/Calibration">
<h3>A. Test on the same session and user as Training/Calibration<a class="headerlink" href="#A.-Test-on-the-same-session-and-user-as-Training/Calibration" title="Permalink to this headline">¶</a></h3>
<p>In this first part we are training our model on the same session that we are testing it on. In real life, it corresponds to a user calibrating his armband right before using it. To do this, we are splitting every session in k-folds, training on <span class="math notranslate nohighlight">\((k-1)\)</span> fold to test on the <span class="math notranslate nohighlight">\(k^{th}\)</span> last fold.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">ExpResults</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class handling the score collection and plotting among the different experiments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exps</span> <span class="o">=</span> <span class="n">exps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Compute the index corresponding to each session only once at initialization.</span>
        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exp_ids</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exps</span><span class="o">==</span><span class="n">exp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the results from the cross validated pipeline.</span>

<span class="sd">        For the model &#39;pipeline&#39;, it will add the cross validated results of every session in the model_name</span>
<span class="sd">        entry of self.results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_name : str</span>
<span class="sd">            Name of the pipeline/model that we are adding results from.</span>
<span class="sd">        model : sklearn.pipeline.Pipeline</span>
<span class="sd">            sklearn pipeline that we are evaluating.</span>
<span class="sd">        X : array</span>
<span class="sd">            data that we are ingesting in the pipeline.</span>
<span class="sd">        y : array</span>
<span class="sd">            labels corresponding to the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fit_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;score_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;test_score&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;train_score&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_ids</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span>
            <span class="n">exp_result</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">ids</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">ids</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exp_result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exp_result</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average training score: </span><span class="si">{}</span><span class="s1">, Average test score: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="s1">&#39;train_score&#39;</span><span class="p">]),</span>
                                                                          <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="s1">&#39;test_score&#39;</span><span class="p">])))</span>

    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">err_bar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Acc&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot bar plot comparing the different pipelines&#39; results.</span>

<span class="sd">        Compare the results added previously using the &#39;add_result&#39; method with bar plots.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        title : str</span>
<span class="sd">            Title of the plot.</span>
<span class="sd">        variables : list of array</span>
<span class="sd">            List of the variables to plot (e.g. train_score, test_score,...)</span>
<span class="sd">        err_bar : list of float</span>
<span class="sd">            list of error to use for plotting error bars. If None, std is used by default.</span>
<span class="sd">        save_name : str</span>
<span class="sd">            path to save the plot. If None, plot is not saved.</span>
<span class="sd">        xlabel : str</span>
<span class="sd">            Label of the x-axis.</span>
<span class="sd">        ylabel : str</span>
<span class="sd">            Label of the y-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">### Some defaults parameters.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>

        <span class="c1">### Reshaping the results for plotting.</span>
        <span class="n">x_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">list_vec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">list_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">variable</span><span class="p">]</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">x_labels</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
        <span class="n">rand_m1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1">### Plots parameters.</span>
        <span class="n">label_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_labels</span><span class="p">))</span>
        <span class="n">center_bar</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_vec</span><span class="p">))]</span>

        <span class="c1">### Plots values.</span>
        <span class="n">avg_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">list_vec</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">err_bar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">err_bar</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">list_vec</span><span class="p">]</span>

        <span class="c1">### Plotting the data.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_vec</span><span class="p">):</span>
            <span class="n">label_i</span> <span class="o">=</span> <span class="n">variable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (n = </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">))</span>
            <span class="n">rects</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">label_loc</span> <span class="o">+</span> <span class="n">center_bar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">avg_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_i</span><span class="p">,</span>
                           <span class="n">yerr</span><span class="o">=</span><span class="n">err_bar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_loc</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="n">center_bar</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">rand_m1</span><span class="p">(</span><span class="n">vec</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">vec</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="c1"># Add some text for labels, title and custom x-axis tick labels, etc.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">label_loc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="c1">### Saving the figure with a timestamp as a name.</span>
        <span class="k">if</span> <span class="n">save_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_name</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">exp_arr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cov_data</span><span class="o">.</span><span class="n">batches</span><span class="p">]</span>
<span class="n">intra_sessions_results</span> <span class="o">=</span> <span class="n">ExpResults</span><span class="p">(</span><span class="n">exp_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="A.0.-Using-Logistic-Regression-on-the-vectorized-Matrix-(Euclidean-Method)">
<h4>A.0. Using Logistic Regression on the vectorized Matrix (Euclidean Method)<a class="headerlink" href="#A.0.-Using-Logistic-Regression-on-the-vectorized-Matrix-(Euclidean-Method)" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;standardize&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;logreg&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">))])</span>

<span class="n">intra_sessions_results</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;logreg_eucl&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">covecs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average training score: 0.9952095673314819, Average test score: 0.8742901644101732
</pre></div></div>
</div>
</div>
<div class="section" id="A.1.-Using-DNN-on-the-vectorized-Matrix-(Euclidean-Method)">
<h4>A.1. Using DNN on the vectorized Matrix (Euclidean Method)<a class="headerlink" href="#A.1.-Using-DNN-on-the-vectorized-Matrix-(Euclidean-Method)" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;initial_weights.hd5&#39;</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="n">N_FEATURES</span><span class="p">,</span> <span class="n">n_signs</span><span class="o">=</span><span class="n">N_SIGNS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to create model, required for using KerasClassifier and wrapp a Keras model inside a</span>
<span class="sd">    scikitlearn form.</span>
<span class="sd">    We added a weight saving/loading to remove the randomness of the weight initialization (for better comparison).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">n_features</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_features</span><span class="p">,)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">n_signs</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">),</span>
<span class="p">])</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;rmsprop&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">save_weights</span><span class="p">(</span><span class="s1">&#39;initial_weights.hd5&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">create_model_covariance</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;initial_weights.hd5&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">create_model</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="n">N_FEATURES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Use the line below to generate the ‘initial_weights.hd5’ file</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">generate_weights</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;standardize&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;dnn&#39;</span><span class="p">,</span> <span class="n">KerasClassifier</span><span class="p">(</span><span class="n">build_fn</span><span class="o">=</span><span class="n">create_model</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">N_EPOCHS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">))])</span>

<span class="n">intra_sessions_results</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;dnn_eucl&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">covecs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average training score: 0.9315860768159231, Average test score: 0.7563349033395449
</pre></div></div>
</div>
</div>
<div class="section" id="A.2.-Using-Tangent-space-projection-+-Logistic-Regression">
<h4>A.2. Using Tangent space projection + Logistic Regression<a class="headerlink" href="#A.2.-Using-Tangent-space-projection-+-Logistic-Regression" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">geomstats.learning.preprocessing</span> <span class="kn">import</span> <span class="n">ToTangentSpace</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;feature_ext&#39;</span><span class="p">,</span> <span class="n">ToTangentSpace</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">metric_affine</span><span class="p">)),</span>
           <span class="p">(</span><span class="s1">&#39;standardize&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;logreg&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">))])</span>

<span class="n">intra_sessions_results</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;logreg_affinvariant_tangent&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">covs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average training score: 0.9979362910724271, Average test score: 0.8770538577108459
</pre></div></div>
</div>
</div>
<div class="section" id="A.3.-Using-Tangent-space-projection-+-DNN">
<h4>A.3. Using Tangent space projection + DNN<a class="headerlink" href="#A.3.-Using-Tangent-space-projection-+-DNN" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;feature_ext&#39;</span><span class="p">,</span> <span class="n">ToTangentSpace</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">metric_affine</span><span class="p">)),</span>
           <span class="p">(</span><span class="s1">&#39;standardize&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;dnn&#39;</span><span class="p">,</span> <span class="n">KerasClassifier</span><span class="p">(</span><span class="n">build_fn</span><span class="o">=</span><span class="n">create_model_covariance</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">N_EPOCHS</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">))])</span>

<span class="n">intra_sessions_results</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;dnn_affinvariant_tangent&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">covs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">cov_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average training score: 0.94588303565979, Average test score: 0.7830353255073229
</pre></div></div>
</div>
</div>
<div class="section" id="A.4.-Using-Euclidean-MDM">
<h4>A.4. Using Euclidean MDM<a class="headerlink" href="#A.4.-Using-Euclidean-MDM" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="A.5.-Using-MDM-with-a-Riemannian-metric">
<h4>A.5. Using MDM with a Riemannian metric<a class="headerlink" href="#A.5.-Using-MDM-with-a-Riemannian-metric" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="Summary-plots">
<h4>Summary plots<a class="headerlink" href="#Summary-plots" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span> In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">intra_sessions_results</span><span class="o">.</span><span class="n">plot_results</span><span class="p">(</span><span class="s1">&#39;intra_sess&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test_score&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_56_0.png" src="../_images/notebooks_usecase_emg_sign_classification_in_spd_manifold_56_0.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="usecase_graph_embedding_and_clustering_in_hyperbolic_space.html" class="btn btn-neutral float-right" title="Tutorial: Hyperbolic Embedding of Graphs and Clustering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="06_information_geometry.html" class="btn btn-neutral float-left" title="Tutorial: Information geometry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2020, Geomstats, Inc..
      <span class="lastupdated">
        Last updated on Mar 31, 2021, 6:43:52 AM.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>